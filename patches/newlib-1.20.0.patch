diff -Nbaur newlib-1.20.0/libgloss/arm/_kill.c newlib-1.20.0-arm/libgloss/arm/_kill.c
--- newlib-1.20.0/libgloss/arm/_kill.c	2007-01-03 16:55:25.000000000 +0000
+++ newlib-1.20.0-arm/libgloss/arm/_kill.c	2012-04-05 16:52:10.000000000 +0100
@@ -1,6 +1,7 @@
 #include <_ansi.h>
 #include <signal.h>
 #include "swi.h"
+#include "arm.h"
 
 int _kill _PARAMS ((int, int));
 
@@ -20,6 +21,10 @@
 			  (void *) ADP_Stopped_ApplicationExit);
     }
 #else
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a0" :: "i" (SWI_Exit));
+#else
   asm ("swi %a0" :: "i" (SWI_Exit));
 #endif
+#endif
 }
diff -Nbaur newlib-1.20.0/libgloss/arm/linux-syscalls0.S newlib-1.20.0-arm/libgloss/arm/linux-syscalls0.S
--- newlib-1.20.0/libgloss/arm/linux-syscalls0.S	2009-10-26 10:00:41.000000000 +0000
+++ newlib-1.20.0-arm/libgloss/arm/linux-syscalls0.S	2012-04-05 16:52:10.000000000 +0100
@@ -7,6 +7,7 @@
  */
 
 #include "linux-syscall.h"
+#include "arm.h"
 
 #if __thumb__
 # define FUNC(name) .type name, %function; .thumb_func; name:
@@ -19,6 +20,26 @@
 #define GLOBAL(name) .global name; FUNC(name)
 #define SIZE(name) .size name, .-name
 
+#ifdef THUMB_V7M_V6M
+
+# define SYSCALL4(name) \
+	GLOBAL(_ ## name); \
+	bkpt #SYS_ ## name; \
+	b _set_errno; \
+	SIZE(_ ## name)
+
+# define SYSCALL6(name) \
+	GLOBAL(_ ## name); \
+	push { r4 - r5 }; \
+	ldr r4, [sp, #8]; \
+	ldr r5, [sp, #12]; \
+	bkpt #SYS_ ## name; \
+	pop { r4 - r5 }; \
+	b _set_errno; \
+	SIZE(_ ## name)
+
+#else
+
 # define SYSCALL4(name) \
 	GLOBAL(_ ## name); \
 	swi #SYS_ ## name; \
@@ -34,6 +55,7 @@
 	pop { r4 - r5 }; \
 	b _set_errno; \
 	SIZE(_ ## name)
+#endif
 
 #define SYSCALL0(name) SYSCALL3(name)
 #define SYSCALL3(name) SYSCALL4(name)
diff -Nbaur newlib-1.20.0/libgloss/arm/redboot-syscalls.c newlib-1.20.0-arm/libgloss/arm/redboot-syscalls.c
--- newlib-1.20.0/libgloss/arm/redboot-syscalls.c	2008-01-03 22:38:30.000000000 +0000
+++ newlib-1.20.0-arm/libgloss/arm/redboot-syscalls.c	2012-04-05 16:52:10.000000000 +0100
@@ -20,13 +20,18 @@
 #include <sys/times.h>
 #include <errno.h>
 #include "syscall.h"
+#include "arm.h"
 
 // Use "naked" attribute to suppress C prologue/epilogue
 static int __attribute__ ((naked)) __syscall(int func_no, ...)
 {
     asm ("mov	r12, lr\n");
 #ifdef __thumb__
+#ifdef THUMB_V7M_V6M
+    asm ("bkpt 0x18\n");
+#else
     asm ("swi 0x18\n");
+#endif
 #else
     asm ("swi 0x180001\n");
 #endif
diff -Nbaur newlib-1.20.0/libgloss/arm/syscalls.c newlib-1.20.0-arm/libgloss/arm/syscalls.c
--- newlib-1.20.0/libgloss/arm/syscalls.c	2010-08-27 12:55:36.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/arm/syscalls.c	2012-04-05 16:52:10.000000000 +0100
@@ -16,6 +16,7 @@
 #include <unistd.h>
 #include <sys/wait.h>
 #include "swi.h"
+#include "arm.h"
 
 /* Forward prototypes.  */
 int     _system     _PARAMS ((const char *));
@@ -168,24 +169,45 @@
   const char * name;
 
   name = ":tt";
+#ifdef __ARM_ARCH_6M__
+  asm ("mov r0,%2; mov r1, #0; bkpt %a1; mov %0, r0"
+       : "=r"(fh)
+       : "i" (SWI_Open),"r"(name)
+       : "r0","r1");
+#else
   asm ("mov r0,%2; mov r1, #0; swi %a1; mov %0, r0"
        : "=r"(fh)
        : "i" (SWI_Open),"r"(name)
        : "r0","r1");
+#endif
   monitor_stdin = fh;
 
   name = ":tt";
+#ifdef __ARM_ARCH_6M__
+  asm ("mov r0,%2; mov r1, #4; bkpt %a1; mov %0, r0"
+       : "=r"(fh)
+       : "i" (SWI_Open),"r"(name)
+       : "r0","r1");
+#else
   asm ("mov r0,%2; mov r1, #4; swi %a1; mov %0, r0"
        : "=r"(fh)
        : "i" (SWI_Open),"r"(name)
        : "r0","r1");
+#endif
   monitor_stdout = fh;
 
   name = ":tt";
+#ifdef __ARM_ARCH_6M__
+  asm ("mov r0,%2; mov r1, #8; bkpt %a1; mov %0, r0"
+       : "=r"(fh)
+       : "i" (SWI_Open),"r"(name)
+       : "r0","r1");
+#else
   asm ("mov r0,%2; mov r1, #8; swi %a1; mov %0, r0"
        : "=r"(fh)
        : "i" (SWI_Open),"r"(name)
        : "r0","r1");
+#endif
   monitor_stderr = fh;
 #endif
 
@@ -211,7 +233,11 @@
   return do_AngelSWI (AngelSWI_Reason_Errno, NULL);
 #else
   register r0 asm("r0");
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a1" : "=r"(r0) : "i" (SWI_GetErrno));
+#else
   asm ("swi %a1" : "=r"(r0) : "i" (SWI_GetErrno));
+#endif
   return r0;
 #endif
 }
@@ -257,9 +283,15 @@
   r0 = fh;
   r1 = (int)ptr;
   r2 = len;
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a4"
+       : "=r" (r0)
+       : "0"(r0), "r"(r1), "r"(r2), "i"(SWI_Read));
+#else
   asm ("swi %a4"
        : "=r" (r0)
        : "0"(r0), "r"(r1), "r"(r2), "i"(SWI_Read));
+#endif
   return checkerror (r0);
 #endif
 }
@@ -353,10 +385,17 @@
 #else
   if (dir == SEEK_END)
     {
+#ifdef __ARM_ARCH_6M__
+      asm ("mov r0, %2; bkpt %a1; mov %0, r0"
+	   : "=r" (res)
+	   : "i" (SWI_Flen), "r" (pfd->handle)
+	   : "r0");
+#else
       asm ("mov r0, %2; swi %a1; mov %0, r0"
 	   : "=r" (res)
 	   : "i" (SWI_Flen), "r" (pfd->handle)
 	   : "r0");
+#endif
       checkerror (res);
       if (res == -1)
         return -1;
@@ -364,10 +403,17 @@
     }
 
   /* This code only does absolute seeks.  */
+#ifdef __ARM_ARCH_6M__
+  asm ("mov r0, %2; mov r1, %3; bkpt %a1; mov %0, r0"
+       : "=r" (res)
+       : "i" (SWI_Seek), "r" (pfd->handle), "r" (ptr)
+       : "r0", "r1");
+#else
   asm ("mov r0, %2; mov r1, %3; swi %a1; mov %0, r0"
        : "=r" (res)
        : "i" (SWI_Seek), "r" (pfd->handle), "r" (ptr)
        : "r0", "r1");
+#endif
   checkerror (res);
 #endif
   /* At this point ptr is the current file position. */
@@ -410,9 +456,15 @@
   r0 = fh;
   r1 = (int)ptr;
   r2 = len;
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a4"
+       : "=r" (r0)
+       : "0"(r0), "r"(r1), "r"(r2), "i"(SWI_Write));
+#else
   asm ("swi %a4"
        : "=r" (r0)
        : "0"(r0), "r"(r1), "r"(r2), "i"(SWI_Write));
+#endif
   return checkerror (r0);
 #endif
 }
@@ -510,11 +562,18 @@
   fh = do_AngelSWI (AngelSWI_Reason_Open, block);
   
 #else
+#ifdef __ARM_ARCH_6M__
+  asm ("mov r0,%2; mov r1, %3; bkpt %a1; mov %0, r0"
+       : "=r"(fh)
+       : "i" (SWI_Open),"r"(path),"r"(aflags)
+       : "r0","r1");
+#else
   asm ("mov r0,%2; mov r1, %3; swi %a1; mov %0, r0"
        : "=r"(fh)
        : "i" (SWI_Open),"r"(path),"r"(aflags)
        : "r0","r1");
 #endif
+#endif
   
   /* Return a user file descriptor or an error. */
   if (fh >= 0)
@@ -542,9 +601,15 @@
 #else
   register r0 asm("r0");
   r0 = fh;
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a2" 
+       : "=r"(r0) 
+       : "0"(r0), "i" (SWI_Close));
+#else
   asm ("swi %a2" 
        : "=r"(r0) 
        : "0"(r0), "i" (SWI_Close));
+#endif
   return checkerror (r0);
 #endif
 }
@@ -640,10 +705,17 @@
 #ifdef ARM_RDI_MONITOR
   res = checkerror (do_AngelSWI (AngelSWI_Reason_FLen, &pfd->handle));
 #else
+#ifdef __ARM_ARCH_6M__
+  asm ("mov r0, %2; bkpt %a1; mov %0, r0"
+       : "=r" (res)
+       : "i" (SWI_Flen), "r" (pfd->handle)
+       : "r0");
+#else
   asm ("mov r0, %2; swi %a1; mov %0, r0"
        : "=r" (res)
        : "i" (SWI_Flen), "r" (pfd->handle)
        : "r0");
+#endif
   checkerror (res);
 #endif
   if (res == -1)
@@ -695,9 +767,15 @@
 #else
   register r0 asm("r0");
   r0 = (int)path;
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a2" 
+       : "=r"(r0)
+       : "0"(r0), "i" (SWI_Remove));
+#else
   asm ("swi %a2" 
        : "=r"(r0)
        : "0"(r0), "i" (SWI_Remove));
+#endif
   res = r0;
 #endif
   if (res == -1) 
@@ -717,7 +795,11 @@
 #else
       {
         int value;
+#ifdef __ARM_ARCH_6M__
+        asm ("bkpt %a1; mov %0, r0" : "=r" (value): "i" (SWI_Time) : "r0");
+#else
         asm ("swi %a1; mov %0, r0" : "=r" (value): "i" (SWI_Time) : "r0");
+#endif
         tp->tv_sec = value;
       }
 #endif
@@ -743,8 +825,12 @@
 #ifdef ARM_RDI_MONITOR
   timeval = do_AngelSWI (AngelSWI_Reason_Clock,NULL);
 #else
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a1; mov %0, r0" : "=r" (timeval): "i" (SWI_Clock) : "r0");
+#else
   asm ("swi %a1; mov %0, r0" : "=r" (timeval): "i" (SWI_Clock) : "r0");
 #endif
+#endif
   return timeval;
 }
 
@@ -784,9 +870,15 @@
 #else
   register r0 asm("r0");
   r0 = pfd->handle;
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a2" 
+       : "=r" (r0)
+       : "0"(r0), "i" (SWI_CLI));
+#else
   asm ("swi %a2"
        : "=r" (r0)
        : "0"(r0), "i" (SWI_IsTTY));
+#endif
   tty = r0;
 #endif
 
@@ -825,9 +917,15 @@
 #else
   register r0 asm("r0");
   r0 = (int)s;
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a2" 
+       : "=r" (r0)
+       : "0"(r0), "i" (SWI_CLI));
+#else
   asm ("swi %a2" 
        : "=r" (r0)
        : "0"(r0), "i" (SWI_CLI));
+#endif
   return checkerror (r0);
 #endif
 }
@@ -847,9 +945,15 @@
   register r1 asm("r1");
   r0 = (int)oldpath;
   r1 = (int)newpath;
+#ifdef __ARM_ARCH_6M__
+  asm ("bkpt %a3" 
+       : "=r" (r0)
+       : "0" (r0), "r" (r1), "i" (SWI_Rename));
+#else
   asm ("swi %a3" 
        : "=r" (r0)
        : "0" (r0), "r" (r1), "i" (SWI_Rename));
+#endif
   return checkerror (r0);
 #endif
 }
diff -Nbaur newlib-1.20.0/libgloss/configure newlib-1.20.0-arm/libgloss/configure
--- newlib-1.20.0/libgloss/configure	2011-12-15 22:58:40.000000000 +0000
+++ newlib-1.20.0-arm/libgloss/configure	2012-04-05 16:52:10.000000000 +0100
@@ -1800,6 +1800,7 @@
 
 
 
+
 if test "${enable_shared}" = "yes" ; then
     echo "Shared libraries not supported for cross compiling, ignored"
 fi
@@ -2545,6 +2546,8 @@
 
 fi
 
+subdirs="$subdirs libsysbase"
+
 DEPDIR="${am__leading_dot}deps"
 
 ac_config_commands="$ac_config_commands depfiles"
diff -Nbaur newlib-1.20.0/libgloss/configure.in newlib-1.20.0-arm/libgloss/configure.in
--- newlib-1.20.0/libgloss/configure.in	2011-12-15 22:58:40.000000000 +0000
+++ newlib-1.20.0-arm/libgloss/configure.in	2012-04-05 16:52:10.000000000 +0100
@@ -2,6 +2,7 @@
 AC_PREREQ(2.59)
 AC_INIT([libgloss],[LIBGLOSS_VERSION])
 AC_CONFIG_SRCDIR([libnosys])
+AC_CONFIG_SRCDIR([libsysbase])
 
 if test "${enable_shared}" = "yes" ; then
     echo "Shared libraries not supported for cross compiling, ignored"
@@ -156,6 +157,7 @@
 if test "${config_libnosys}" = "true"; then
   AC_CONFIG_SUBDIRS([libnosys])
 fi
+AC_CONFIG_SUBDIRS(libsysbase)
 
 LIB_AC_PROG_CC
 AS=${AS-as}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/abort.c newlib-1.20.0-arm/libgloss/libsysbase/abort.c
--- newlib-1.20.0/libgloss/libsysbase/abort.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/abort.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,8 @@
+#include <stdlib.h>
+#include <unistd.h>
+
+void abort(void) {
+  write (2, "Abort called.\n", sizeof("Abort called.\n")-1);
+  _exit (1);
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/acconfig.h newlib-1.20.0-arm/libgloss/libsysbase/acconfig.h
--- newlib-1.20.0/libgloss/libsysbase/acconfig.h	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/acconfig.h	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,29 @@
+/* Name of package.  */
+#undef PACKAGE
+
+/* Version of package.  */
+#undef VERSION
+
+/* Missing syscall names */
+#undef MISSING_SYSCALL_NAMES
+
+/* Reentrant syscalls */
+#undef REENTRANT_SYSCALLS_PROVIDED
+
+/* Using ELF format */
+#undef HAVE_ELF
+
+/* Using GNU LD */
+#undef HAVE_GNU_LD
+
+/* .previous directive allowed */
+#undef HAVE_ASM_PREVIOUS_DIRECTIVE
+
+/* .pushsection/.popsection directives allowed */
+#undef HAVE_ASM_POPSECTION_DIRECTIVE
+
+/* support for section attributes */
+#undef HAVE_SECTION_ATTRIBUTES
+
+/* symbol prefix */
+#undef __SYMBOL_PREFIX
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/aclocal.m4 newlib-1.20.0-arm/libgloss/libsysbase/aclocal.m4
--- newlib-1.20.0/libgloss/libsysbase/aclocal.m4	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/aclocal.m4	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,344 @@
+# generated automatically by aclocal 1.9.5 -*- Autoconf -*-
+
+# Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2002, 2003, 2004,
+# 2005  Free Software Foundation, Inc.
+# This file is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# This program is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY, to the extent permitted by law; without
+# even the implied warranty of MERCHANTABILITY or FITNESS FOR A
+# PARTICULAR PURPOSE.
+
+# AM_CONDITIONAL                                            -*- Autoconf -*-
+
+# Copyright (C) 1997, 2000, 2001, 2003, 2004, 2005
+# Free Software Foundation, Inc.
+#
+# This file is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# serial 7
+
+# AM_CONDITIONAL(NAME, SHELL-CONDITION)
+# -------------------------------------
+# Define a conditional.
+AC_DEFUN([AM_CONDITIONAL],
+[AC_PREREQ(2.52)dnl
+ ifelse([$1], [TRUE],  [AC_FATAL([$0: invalid condition: $1])],
+	[$1], [FALSE], [AC_FATAL([$0: invalid condition: $1])])dnl
+AC_SUBST([$1_TRUE])
+AC_SUBST([$1_FALSE])
+if $2; then
+  $1_TRUE=
+  $1_FALSE='#'
+else
+  $1_TRUE='#'
+  $1_FALSE=
+fi
+AC_CONFIG_COMMANDS_PRE(
+[if test -z "${$1_TRUE}" && test -z "${$1_FALSE}"; then
+  AC_MSG_ERROR([[conditional "$1" was never defined.
+Usually this means the macro was only invoked conditionally.]])
+fi])])
+
+
+# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005
+# Free Software Foundation, Inc.
+#
+# This file is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# serial 8
+
+# There are a few dirty hacks below to avoid letting `AC_PROG_CC' be
+# written in clear, in which case automake, when reading aclocal.m4,
+# will think it sees a *use*, and therefore will trigger all it's
+# C support machinery.  Also note that it means that autoscan, seeing
+# CC etc. in the Makefile, will ask for an AC_PROG_CC use...
+
+
+# _AM_DEPENDENCIES(NAME)
+# ----------------------
+# See how the compiler implements dependency checking.
+# NAME is "CC", "CXX", "GCJ", or "OBJC".
+# We try a few techniques and use that to set a single cache variable.
+#
+# We don't AC_REQUIRE the corresponding AC_PROG_CC since the latter was
+# modified to invoke _AM_DEPENDENCIES(CC); we would have a circular
+# dependency, and given that the user is not expected to run this macro,
+# just rely on AC_PROG_CC.
+AC_DEFUN([_AM_DEPENDENCIES],
+[AC_REQUIRE([AM_SET_DEPDIR])dnl
+AC_REQUIRE([AM_OUTPUT_DEPENDENCY_COMMANDS])dnl
+AC_REQUIRE([AM_MAKE_INCLUDE])dnl
+AC_REQUIRE([AM_DEP_TRACK])dnl
+
+ifelse([$1], CC,   [depcc="$CC"   am_compiler_list=],
+       [$1], CXX,  [depcc="$CXX"  am_compiler_list=],
+       [$1], OBJC, [depcc="$OBJC" am_compiler_list='gcc3 gcc'],
+       [$1], GCJ,  [depcc="$GCJ"  am_compiler_list='gcc3 gcc'],
+                   [depcc="$$1"   am_compiler_list=])
+
+AC_CACHE_CHECK([dependency style of $depcc],
+               [am_cv_$1_dependencies_compiler_type],
+[if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
+  # We make a subdir and do the tests there.  Otherwise we can end up
+  # making bogus files that we don't know about and never remove.  For
+  # instance it was reported that on HP-UX the gcc test will end up
+  # making a dummy file named `D' -- because `-MD' means `put the output
+  # in D'.
+  mkdir conftest.dir
+  # Copy depcomp to subdir because otherwise we won't find it if we're
+  # using a relative directory.
+  cp "$am_depcomp" conftest.dir
+  cd conftest.dir
+  # We will build objects and dependencies in a subdirectory because
+  # it helps to detect inapplicable dependency modes.  For instance
+  # both Tru64's cc and ICC support -MD to output dependencies as a
+  # side effect of compilation, but ICC will put the dependencies in
+  # the current directory while Tru64 will put them in the object
+  # directory.
+  mkdir sub
+
+  am_cv_$1_dependencies_compiler_type=none
+  if test "$am_compiler_list" = ""; then
+     am_compiler_list=`sed -n ['s/^#*\([a-zA-Z0-9]*\))$/\1/p'] < ./depcomp`
+  fi
+  for depmode in $am_compiler_list; do
+    # Setup a source with many dependencies, because some compilers
+    # like to wrap large dependency lists on column 80 (with \), and
+    # we should not choose a depcomp mode which is confused by this.
+    #
+    # We need to recreate these files for each test, as the compiler may
+    # overwrite some of them when testing with obscure command lines.
+    # This happens at least with the AIX C compiler.
+    : > sub/conftest.c
+    for i in 1 2 3 4 5 6; do
+      echo '#include "conftst'$i'.h"' >> sub/conftest.c
+      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
+      # Solaris 8's {/usr,}/bin/sh.
+      touch sub/conftst$i.h
+    done
+    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
+
+    case $depmode in
+    nosideeffect)
+      # after this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested
+      if test "x$enable_dependency_tracking" = xyes; then
+	continue
+      else
+	break
+      fi
+      ;;
+    none) break ;;
+    esac
+    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # mode.  It turns out that the SunPro C++ compiler does not properly
+    # handle `-M -o', and we need to detect this.
+    if depmode=$depmode \
+       source=sub/conftest.c object=sub/conftest.${OBJEXT-o} \
+       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
+       $SHELL ./depcomp $depcc -c -o sub/conftest.${OBJEXT-o} sub/conftest.c \
+         >/dev/null 2>conftest.err &&
+       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep sub/conftest.${OBJEXT-o} sub/conftest.Po > /dev/null 2>&1 &&
+       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
+      # icc doesn't choke on unknown options, it will just issue warnings
+      # or remarks (even with -Werror).  So we grep stderr for any message
+      # that says an option was ignored or not supported.
+      # When given -MP, icc 7.0 and 7.1 complain thusly:
+      #   icc: Command line warning: ignoring option '-M'; no argument required
+      # The diagnosis changed in icc 8.0:
+      #   icc: Command line remark: option '-MP' not supported
+      if (grep 'ignoring option' conftest.err ||
+          grep 'not supported' conftest.err) >/dev/null 2>&1; then :; else
+        am_cv_$1_dependencies_compiler_type=$depmode
+        break
+      fi
+    fi
+  done
+
+  cd ..
+  rm -rf conftest.dir
+else
+  am_cv_$1_dependencies_compiler_type=none
+fi
+])
+AC_SUBST([$1DEPMODE], [depmode=$am_cv_$1_dependencies_compiler_type])
+AM_CONDITIONAL([am__fastdep$1], [
+  test "x$enable_dependency_tracking" != xno \
+  && test "$am_cv_$1_dependencies_compiler_type" = gcc3])
+])
+
+
+# AM_SET_DEPDIR
+# -------------
+# Choose a directory name for dependency files.
+# This macro is AC_REQUIREd in _AM_DEPENDENCIES
+AC_DEFUN([AM_SET_DEPDIR],
+[AC_REQUIRE([AM_SET_LEADING_DOT])dnl
+AC_SUBST([DEPDIR], ["${am__leading_dot}deps"])dnl
+])
+
+
+# AM_DEP_TRACK
+# ------------
+AC_DEFUN([AM_DEP_TRACK],
+[AC_ARG_ENABLE(dependency-tracking,
+[  --disable-dependency-tracking  speeds up one-time build
+  --enable-dependency-tracking   do not reject slow dependency extractors])
+if test "x$enable_dependency_tracking" != xno; then
+  am_depcomp="$ac_aux_dir/depcomp"
+  AMDEPBACKSLASH='\'
+fi
+AM_CONDITIONAL([AMDEP], [test "x$enable_dependency_tracking" != xno])
+AC_SUBST([AMDEPBACKSLASH])
+])
+
+# Generate code to set up dependency tracking.              -*- Autoconf -*-
+
+# Copyright (C) 1999, 2000, 2001, 2002, 2003, 2004, 2005
+# Free Software Foundation, Inc.
+#
+# This file is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+#serial 3
+
+# _AM_OUTPUT_DEPENDENCY_COMMANDS
+# ------------------------------
+AC_DEFUN([_AM_OUTPUT_DEPENDENCY_COMMANDS],
+[for mf in $CONFIG_FILES; do
+  # Strip MF so we end up with the name of the file.
+  mf=`echo "$mf" | sed -e 's/:.*$//'`
+  # Check whether this is an Automake generated Makefile or not.
+  # We used to match only the files named `Makefile.in', but
+  # some people rename them; so instead we look at the file content.
+  # Grep'ing the first line is not enough: some people post-process
+  # each Makefile.in and add a new line on top of each file to say so.
+  # So let's grep whole file.
+  if grep '^#.*generated by automake' $mf > /dev/null 2>&1; then
+    dirpart=`AS_DIRNAME("$mf")`
+  else
+    continue
+  fi
+  # Extract the definition of DEPDIR, am__include, and am__quote
+  # from the Makefile without running `make'.
+  DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
+  test -z "$DEPDIR" && continue
+  am__include=`sed -n 's/^am__include = //p' < "$mf"`
+  test -z "am__include" && continue
+  am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
+  # When using ansi2knr, U may be empty or an underscore; expand it
+  U=`sed -n 's/^U = //p' < "$mf"`
+  # Find all dependency output files, they are included files with
+  # $(DEPDIR) in their names.  We invoke sed twice because it is the
+  # simplest approach to changing $(DEPDIR) to its actual value in the
+  # expansion.
+  for file in `sed -n "
+    s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
+       sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
+    # Make sure the directory exists.
+    test -f "$dirpart/$file" && continue
+    fdir=`AS_DIRNAME(["$file"])`
+    AS_MKDIR_P([$dirpart/$fdir])
+    # echo "creating $dirpart/$file"
+    echo '# dummy' > "$dirpart/$file"
+  done
+done
+])# _AM_OUTPUT_DEPENDENCY_COMMANDS
+
+
+# AM_OUTPUT_DEPENDENCY_COMMANDS
+# -----------------------------
+# This macro should only be invoked once -- use via AC_REQUIRE.
+#
+# This code is only required when automatic dependency tracking
+# is enabled.  FIXME.  This creates each `.P' file that we will
+# need in order to bootstrap the dependency handling code.
+AC_DEFUN([AM_OUTPUT_DEPENDENCY_COMMANDS],
+[AC_CONFIG_COMMANDS([depfiles],
+     [test x"$AMDEP_TRUE" != x"" || _AM_OUTPUT_DEPENDENCY_COMMANDS],
+     [AMDEP_TRUE="$AMDEP_TRUE" ac_aux_dir="$ac_aux_dir"])
+])
+
+# Copyright (C) 2003, 2005  Free Software Foundation, Inc.
+#
+# This file is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# serial 2
+
+# Check whether the underlying file-system supports filenames
+# with a leading dot.  For instance MS-DOS doesn't.
+AC_DEFUN([AM_SET_LEADING_DOT],
+[rm -rf .tst 2>/dev/null
+mkdir .tst 2>/dev/null
+if test -d .tst; then
+  am__leading_dot=.
+else
+  am__leading_dot=_
+fi
+rmdir .tst 2>/dev/null
+AC_SUBST([am__leading_dot])])
+
+# Check to see how 'make' treats includes.	            -*- Autoconf -*-
+
+# Copyright (C) 2001, 2002, 2003, 2005  Free Software Foundation, Inc.
+#
+# This file is free software; the Free Software Foundation
+# gives unlimited permission to copy and/or distribute it,
+# with or without modifications, as long as this notice is preserved.
+
+# serial 3
+
+# AM_MAKE_INCLUDE()
+# -----------------
+# Check to see how make treats includes.
+AC_DEFUN([AM_MAKE_INCLUDE],
+[am_make=${MAKE-make}
+cat > confinc << 'END'
+am__doit:
+	@echo done
+.PHONY: am__doit
+END
+# If we don't find an include directive, just comment out the code.
+AC_MSG_CHECKING([for style of include used by $am_make])
+am__include="#"
+am__quote=
+_am_result=none
+# First try GNU make style include.
+echo "include confinc" > confmf
+# We grep out `Entering directory' and `Leaving directory'
+# messages which can occur if `w' ends up in MAKEFLAGS.
+# In particular we don't look at `^make:' because GNU make might
+# be invoked under some other name (usually "gmake"), in which
+# case it prints its new name instead of `make'.
+if test "`$am_make -s -f confmf 2> /dev/null | grep -v 'ing directory'`" = "done"; then
+   am__include=include
+   am__quote=
+   _am_result=GNU
+fi
+# Now try BSD make style include.
+if test "$am__include" = "#"; then
+   echo '.include "confinc"' > confmf
+   if test "`$am_make -s -f confmf 2> /dev/null`" = "done"; then
+      am__include=.include
+      am__quote="\""
+      _am_result=BSD
+   fi
+fi
+AC_SUBST([am__include])
+AC_SUBST([am__quote])
+AC_MSG_RESULT([$_am_result])
+rm -f confinc confmf
+])
+
+m4_include([../acinclude.m4])
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/build_argv.c newlib-1.20.0-arm/libgloss/libsysbase/build_argv.c
--- newlib-1.20.0/libgloss/libsysbase/build_argv.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/build_argv.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,31 @@
+struct __argv {
+	int argvMagic;
+	char *commandLine;
+	int length;
+	int argc;
+	char **argv;
+	char **endARGV;
+};
+
+
+void build_argv (struct __argv* argstruct ) {
+
+	char *data = argstruct->commandLine;
+	int len = argstruct->length;
+
+	char** argv = (char**)(((int)data + len + sizeof(char **)) & ~(sizeof(char **)-1));
+	char* end = data + len - 1;
+	int argCount = 0;
+	
+	do {
+		argv[argCount++] = data;			// Add next arg to argv list
+		while (*(data) && data < end) data++;		// Move to next NULL delimiter
+		data++;						// Move to one after the NULL delimiter
+	} while (data < end);
+	
+	*end = '\0';						// Force NULL terminator for last arg
+
+	argstruct->argv = argv;
+	argstruct->argc = argCount;
+	argstruct->endARGV = &argv[argCount];
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/chdir.c newlib-1.20.0-arm/libgloss/libsysbase/chdir.c
--- newlib-1.20.0/libgloss/libsysbase/chdir.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/chdir.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,176 @@
+#include <unistd.h>
+#include <reent.h>
+#include <string.h>
+#include <errno.h>
+#include <sys/iosupport.h>
+
+/* CWD always start with "/" */
+static char _current_working_directory [MAXPATHLEN] = "/";
+
+#define DIRECTORY_SEPARATOR_CHAR '/'
+const char DIRECTORY_SEPARATOR[] = "/";
+const char DIRECTORY_THIS[] = ".";
+const char DIRECTORY_PARENT[] = "..";
+
+int _concatenate_path (struct _reent *r, char *path, const char *extra, int maxLength) {
+	char *pathEnd;
+	int pathLength;
+	const char *extraEnd;
+	int extraSize;
+	
+	pathLength = strnlen (path, maxLength);
+	
+	/* assumes path ends in a directory separator */
+	if (pathLength >= maxLength) {
+		r->_errno = ENAMETOOLONG;
+		return -1;
+	}
+	pathEnd = path + pathLength;
+	if (pathEnd[-1] != DIRECTORY_SEPARATOR_CHAR) {
+		pathEnd[0] = DIRECTORY_SEPARATOR_CHAR;
+		pathEnd += 1;
+	}
+	
+	extraEnd = extra;
+	
+	/* If the extra bit starts with a slash, start at root */
+	if (extra[0] == DIRECTORY_SEPARATOR_CHAR) {
+		pathEnd = strchr (path, DIRECTORY_SEPARATOR_CHAR) + 1;
+		pathEnd[0] = '\0';
+	}
+	do {
+		/* Advance past any separators in extra */
+		while (extra[0] == DIRECTORY_SEPARATOR_CHAR) {
+			extra += 1;
+		}
+		
+		/* Grab the next directory name from extra */
+		extraEnd = strchr (extra, DIRECTORY_SEPARATOR_CHAR); 
+		if (extraEnd == NULL) {
+			extraEnd = strrchr (extra, '\0');
+		} else {
+			extraEnd += 1;
+		}
+		
+		extraSize = (extraEnd - extra);
+		if (extraSize == 0) {
+			break;
+		}
+		
+		if ((strncmp (extra, DIRECTORY_THIS, sizeof(DIRECTORY_THIS) - 1) == 0) 
+			&& ((extra[sizeof(DIRECTORY_THIS)-1] == DIRECTORY_SEPARATOR_CHAR)
+				||(extra[sizeof(DIRECTORY_THIS)-1] == '\0')))
+		{
+			/* Don't copy anything */
+		} else 	if ((strncmp (extra, DIRECTORY_PARENT, sizeof(DIRECTORY_PARENT) - 1) == 0) 
+			&& ((extra[sizeof(DIRECTORY_PARENT)-1] == DIRECTORY_SEPARATOR_CHAR)
+				||(extra[sizeof(DIRECTORY_PARENT)-1] == '\0')))
+		{
+			/* Go up one level of in the path */
+			if (pathEnd[-1] == DIRECTORY_SEPARATOR_CHAR) {
+				// Remove trailing separator
+				pathEnd[-1] = '\0';
+			}
+			pathEnd = strrchr (path, DIRECTORY_SEPARATOR_CHAR);
+			if (pathEnd == NULL) {
+				/* Can't go up any higher, return false */
+				r->_errno = ENOENT;
+				return -1;
+			}
+			pathLength = pathEnd - path;
+			pathEnd += 1;
+		} else {	
+			pathLength += extraSize;
+			if (pathLength >= maxLength) {
+				r->_errno = ENAMETOOLONG;
+				return -1;
+			}
+			/* Copy the next part over */
+			strncpy (pathEnd, extra, extraSize);
+			pathEnd += extraSize;
+		}
+		pathEnd[0] = '\0';
+		extra += extraSize;
+	} while (extraSize != 0);
+	
+	if (pathEnd[-1] != DIRECTORY_SEPARATOR_CHAR) {
+		pathEnd[0] = DIRECTORY_SEPARATOR_CHAR;
+		pathEnd[1] = 0;
+		pathEnd += 1;
+	}
+
+	return 0;
+}
+
+int chdir (const char *path) {
+	struct _reent *r = _REENT;
+
+	int dev;
+	const char *pathPosition;
+	char temp_cwd [MAXPATHLEN];
+	
+	/* Make sure the path is short enough */
+	if (strnlen (path, MAXPATHLEN + 1) >= MAXPATHLEN) {
+		r->_errno = ENAMETOOLONG;
+		return -1;
+	}
+
+	if (strchr (path, ':') != NULL) {
+		strncpy (temp_cwd, path, MAXPATHLEN);
+		/* Move path past device name */
+		path = strchr (path, ':') + 1;
+	} else {
+		strncpy (temp_cwd, _current_working_directory, MAXPATHLEN);
+	}
+	
+	pathPosition = strchr (temp_cwd , ':') + 1;
+		
+	/* Make sure the path starts in the root directory */
+	if (pathPosition[0] != DIRECTORY_SEPARATOR_CHAR) {
+		r->_errno = ENOENT;
+		return -1;
+	}
+	
+	/* Concatenate the path to the CWD */
+	if (_concatenate_path (r, temp_cwd, path, MAXPATHLEN) == -1) {
+		return -1;
+	}
+	
+	/* Get device from path name */
+	dev = FindDevice(temp_cwd);
+	
+	if ((dev < 0) || (devoptab_list[dev]->chdir_r == NULL)) {
+		r->_errno = ENODEV;
+		return -1;
+	} 
+
+	/* Try changing directories on the device */
+	if (devoptab_list[dev]->chdir_r (r, temp_cwd) == -1) {
+		return -1;
+	}
+	
+	/* Since it worked, set the new CWD and default device */
+	setDefaultDevice(dev);
+	strncpy (_current_working_directory, temp_cwd, MAXPATHLEN);
+
+	return 0;
+}
+
+char *getcwd(char *buf, size_t size) {
+
+	struct _reent *r = _REENT;
+
+	if (size == 0) {
+		r->_errno = EINVAL;
+		return NULL;
+	}
+	
+	if ( size < (strnlen (_current_working_directory, MAXPATHLEN) + 1)) {
+		r->_errno = ERANGE;
+		return NULL;
+	}
+
+	strncpy (buf, _current_working_directory, size);
+	
+	return buf;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/chmod.c newlib-1.20.0-arm/libgloss/libsysbase/chmod.c
--- newlib-1.20.0/libgloss/libsysbase/chmod.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/chmod.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,25 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <sys/iosupport.h>
+#include <errno.h>
+
+int chmod(const char *path, mode_t mode) {
+	int	ret,dev;
+	struct _reent *r = _REENT;
+
+	/* Get device from path name */
+	dev = FindDevice(path);
+	
+	if ((dev < 0) || (devoptab_list[dev]->chmod_r == NULL)) {
+		r->_errno = ENODEV;
+		ret = -1;
+	} else {
+		ret = devoptab_list[dev]->chmod_r(r,path,mode);
+	}
+
+	return ret;
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/close.c newlib-1.20.0-arm/libgloss/libsysbase/close.c
--- newlib-1.20.0/libgloss/libsysbase/close.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/close.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,41 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <stdio.h>
+#include <errno.h>
+
+#include "handle_manager.h"
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+int _DEFUN(_close_r,(ptr,fileDesc),
+		   struct _reent *ptr _AND
+           int fileDesc) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+int _DEFUN(_close,(fileDesc),
+           int fileDesc) {
+//---------------------------------------------------------------------------------
+	struct _reent *ptr = _REENT;
+#endif
+	int ret = -1;
+	unsigned int dev = 0;
+	unsigned int fd = -1;
+
+	if(fileDesc!=-1) {
+
+		__handle *handle = __get_handle(fileDesc);
+
+		if ( handle != NULL) {
+			dev = handle->device;
+			fd = (unsigned int)handle->fileStruct;
+
+			if(devoptab_list[dev]->close_r)
+				ret = devoptab_list[dev]->close_r(ptr,fd);
+
+			__release_handle(fileDesc);
+		}
+	}
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/config.h.in newlib-1.20.0-arm/libgloss/libsysbase/config.h.in
--- newlib-1.20.0/libgloss/libsysbase/config.h.in	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/config.h.in	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,25 @@
+/* config.h.in.  Generated automatically from configure.in by autoheader.  */
+
+/* Missing syscall names */
+#undef MISSING_SYSCALL_NAMES
+
+/* Reentrant syscalls */
+#undef REENTRANT_SYSCALLS_PROVIDED
+
+/* Using ELF format */
+#undef HAVE_ELF
+
+/* Using GNU LD */
+#undef HAVE_GNU_LD
+
+/* .previous directive allowed */
+#undef HAVE_ASM_PREVIOUS_DIRECTIVE
+
+/* .pushsection/.popsection directives allowed */
+#undef HAVE_ASM_POPSECTION_DIRECTIVE
+
+/* support for section attributes */
+#undef HAVE_SECTION_ATTRIBUTES
+
+/* symbol prefix */
+#undef __SYMBOL_PREFIX
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/configure newlib-1.20.0-arm/libgloss/libsysbase/configure
--- newlib-1.20.0/libgloss/libsysbase/configure	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/configure	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,3553 @@
+#! /bin/sh
+# Guess values for system-dependent variables and create Makefiles.
+# Generated by GNU Autoconf 2.59.
+#
+# Copyright (C) 2003 Free Software Foundation, Inc.
+# This configure script is free software; the Free Software Foundation
+# gives unlimited permission to copy, distribute and modify it.
+## --------------------- ##
+## M4sh Initialization.  ##
+## --------------------- ##
+
+# Be Bourne compatible
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+  emulate sh
+  NULLCMD=:
+  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+"$@"}'='"$@"'
+elif test -n "${BASH_VERSION+set}" && (set -o posix) >/dev/null 2>&1; then
+  set -o posix
+fi
+DUALCASE=1; export DUALCASE # for MKS sh
+
+# Support unset when possible.
+if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
+  as_unset=unset
+else
+  as_unset=false
+fi
+
+
+# Work around bugs in pre-3.0 UWIN ksh.
+$as_unset ENV MAIL MAILPATH
+PS1='$ '
+PS2='> '
+PS4='+ '
+
+# NLS nuisances.
+for as_var in \
+  LANG LANGUAGE LC_ADDRESS LC_ALL LC_COLLATE LC_CTYPE LC_IDENTIFICATION \
+  LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
+  LC_TELEPHONE LC_TIME
+do
+  if (set +x; test -z "`(eval $as_var=C; export $as_var) 2>&1`"); then
+    eval $as_var=C; export $as_var
+  else
+    $as_unset $as_var
+  fi
+done
+
+# Required to use basename.
+if expr a : '\(a\)' >/dev/null 2>&1; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+if (basename /) >/dev/null 2>&1 && test "X`basename / 2>&1`" = "X/"; then
+  as_basename=basename
+else
+  as_basename=false
+fi
+
+
+# Name of the executable.
+as_me=`$as_basename "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)$' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
+  	  /^X\/\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\/\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+
+
+# PATH needs CR, and LINENO needs CR and PATH.
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
+
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`
+  test "x$as_lineno_1" != "x$as_lineno_2" &&
+  test "x$as_lineno_3"  = "x$as_lineno_2"  || {
+  # Find who we are.  Look in the path if we contain no path at all
+  # relative or not.
+  case $0 in
+    *[\\/]* ) as_myself=$0 ;;
+    *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+done
+
+       ;;
+  esac
+  # We did not find ourselves, most probably we were run as `sh COMMAND'
+  # in which case we are not to be found in the path.
+  if test "x$as_myself" = x; then
+    as_myself=$0
+  fi
+  if test ! -f "$as_myself"; then
+    { echo "$as_me: error: cannot find myself; rerun with an absolute path" >&2
+   { (exit 1); exit 1; }; }
+  fi
+  case $CONFIG_SHELL in
+  '')
+    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for as_base in sh bash ksh sh5; do
+	 case $as_dir in
+	 /*)
+	   if ("$as_dir/$as_base" -c '
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`
+  test "x$as_lineno_1" != "x$as_lineno_2" &&
+  test "x$as_lineno_3"  = "x$as_lineno_2" ') 2>/dev/null; then
+	     $as_unset BASH_ENV || test "${BASH_ENV+set}" != set || { BASH_ENV=; export BASH_ENV; }
+	     $as_unset ENV || test "${ENV+set}" != set || { ENV=; export ENV; }
+	     CONFIG_SHELL=$as_dir/$as_base
+	     export CONFIG_SHELL
+	     exec "$CONFIG_SHELL" "$0" ${1+"$@"}
+	   fi;;
+	 esac
+       done
+done
+;;
+  esac
+
+  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
+  # uniformly replaced by the line number.  The first 'sed' inserts a
+  # line-number line before each line; the second 'sed' does the real
+  # work.  The second script uses 'N' to pair each line-number line
+  # with the numbered line, and appends trailing '-' during
+  # substitution so that $LINENO is not a special case at line end.
+  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
+  # second 'sed' script.  Blame Lee E. McMahon for sed's syntax.  :-)
+  sed '=' <$as_myself |
+    sed '
+      N
+      s,$,-,
+      : loop
+      s,^\(['$as_cr_digits']*\)\(.*\)[$]LINENO\([^'$as_cr_alnum'_]\),\1\2\1\3,
+      t loop
+      s,-$,,
+      s,^['$as_cr_digits']*\n,,
+    ' >$as_me.lineno &&
+  chmod +x $as_me.lineno ||
+    { echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2
+   { (exit 1); exit 1; }; }
+
+  # Don't try to exec as it changes $[0], causing all sort of problems
+  # (the dirname of $[0] is not the place where we might find the
+  # original and so on.  Autoconf is especially sensible to this).
+  . ./$as_me.lineno
+  # Exit status is that of the last command.
+  exit
+}
+
+
+case `echo "testing\c"; echo 1,2,3`,`echo -n testing; echo 1,2,3` in
+  *c*,-n*) ECHO_N= ECHO_C='
+' ECHO_T='	' ;;
+  *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
+  *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
+esac
+
+if expr a : '\(a\)' >/dev/null 2>&1; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+rm -f conf$$ conf$$.exe conf$$.file
+echo >conf$$.file
+if ln -s conf$$.file conf$$ 2>/dev/null; then
+  # We could just check for DJGPP; but this test a) works b) is more generic
+  # and c) will remain valid once DJGPP supports symlinks (DJGPP 2.04).
+  if test -f conf$$.exe; then
+    # Don't use ln at all; we don't have any links
+    as_ln_s='cp -p'
+  else
+    as_ln_s='ln -s'
+  fi
+elif ln conf$$.file conf$$ 2>/dev/null; then
+  as_ln_s=ln
+else
+  as_ln_s='cp -p'
+fi
+rm -f conf$$ conf$$.exe conf$$.file
+
+if mkdir -p . 2>/dev/null; then
+  as_mkdir_p=:
+else
+  test -d ./-p && rmdir ./-p
+  as_mkdir_p=false
+fi
+
+as_executable_p="test -f"
+
+# Sed expression to map a string onto a valid CPP name.
+as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
+
+# Sed expression to map a string onto a valid variable name.
+as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
+
+
+# IFS
+# We need space, tab and new line, in precisely that order.
+as_nl='
+'
+IFS=" 	$as_nl"
+
+# CDPATH.
+$as_unset CDPATH
+
+
+# Name of the host.
+# hostname on some systems (SVR3.2, Linux) returns a bogus exit status,
+# so uname gets run too.
+ac_hostname=`(hostname || uname -n) 2>/dev/null | sed 1q`
+
+exec 6>&1
+
+#
+# Initializations.
+#
+ac_default_prefix=/usr/local
+ac_config_libobj_dir=.
+cross_compiling=no
+subdirs=
+MFLAGS=
+MAKEFLAGS=
+SHELL=${CONFIG_SHELL-/bin/sh}
+
+# Maximum number of lines to put in a shell here document.
+# This variable seems obsolete.  It should probably be removed, and
+# only ac_max_sed_lines should be used.
+: ${ac_max_here_lines=38}
+
+# Identity of this package.
+PACKAGE_NAME=
+PACKAGE_TARNAME=
+PACKAGE_VERSION=
+PACKAGE_STRING=
+PACKAGE_BUGREPORT=
+
+ac_unique_file="close.c"
+ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS build build_cpu build_vendor build_os host host_cpu host_vendor host_os target target_cpu target_vendor target_os INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA CC am__leading_dot DEPDIR am__include am__quote AMDEP_TRUE AMDEP_FALSE AMDEPBACKSLASH CCDEPMODE am__fastdepCC_TRUE am__fastdepCC_FALSE AS AR LD RANLIB ac_ct_RANLIB CCAS CCASFLAGS host_makefile_frag_path LIBOBJS LTLIBOBJS'
+ac_subst_files='host_makefile_frag'
+
+# Initialize some variables set by options.
+ac_init_help=
+ac_init_version=false
+# The variables have the same names as the options, with
+# dashes changed to underlines.
+cache_file=/dev/null
+exec_prefix=NONE
+no_create=
+no_recursion=
+prefix=NONE
+program_prefix=NONE
+program_suffix=NONE
+program_transform_name=s,x,x,
+silent=
+site=
+srcdir=
+verbose=
+x_includes=NONE
+x_libraries=NONE
+
+# Installation directory options.
+# These are left unexpanded so users can "make install exec_prefix=/foo"
+# and all the variables that are supposed to be based on exec_prefix
+# by default will actually change.
+# Use braces instead of parens because sh, perl, etc. also accept them.
+bindir='${exec_prefix}/bin'
+sbindir='${exec_prefix}/sbin'
+libexecdir='${exec_prefix}/libexec'
+datadir='${prefix}/share'
+sysconfdir='${prefix}/etc'
+sharedstatedir='${prefix}/com'
+localstatedir='${prefix}/var'
+libdir='${exec_prefix}/lib'
+includedir='${prefix}/include'
+oldincludedir='/usr/include'
+infodir='${prefix}/info'
+mandir='${prefix}/man'
+
+ac_prev=
+for ac_option
+do
+  # If the previous option needs an argument, assign it.
+  if test -n "$ac_prev"; then
+    eval "$ac_prev=\$ac_option"
+    ac_prev=
+    continue
+  fi
+
+  ac_optarg=`expr "x$ac_option" : 'x[^=]*=\(.*\)'`
+
+  # Accept the important Cygnus configure options, so we can diagnose typos.
+
+  case $ac_option in
+
+  -bindir | --bindir | --bindi | --bind | --bin | --bi)
+    ac_prev=bindir ;;
+  -bindir=* | --bindir=* | --bindi=* | --bind=* | --bin=* | --bi=*)
+    bindir=$ac_optarg ;;
+
+  -build | --build | --buil | --bui | --bu)
+    ac_prev=build_alias ;;
+  -build=* | --build=* | --buil=* | --bui=* | --bu=*)
+    build_alias=$ac_optarg ;;
+
+  -cache-file | --cache-file | --cache-fil | --cache-fi \
+  | --cache-f | --cache- | --cache | --cach | --cac | --ca | --c)
+    ac_prev=cache_file ;;
+  -cache-file=* | --cache-file=* | --cache-fil=* | --cache-fi=* \
+  | --cache-f=* | --cache-=* | --cache=* | --cach=* | --cac=* | --ca=* | --c=*)
+    cache_file=$ac_optarg ;;
+
+  --config-cache | -C)
+    cache_file=config.cache ;;
+
+  -datadir | --datadir | --datadi | --datad | --data | --dat | --da)
+    ac_prev=datadir ;;
+  -datadir=* | --datadir=* | --datadi=* | --datad=* | --data=* | --dat=* \
+  | --da=*)
+    datadir=$ac_optarg ;;
+
+  -disable-* | --disable-*)
+    ac_feature=`expr "x$ac_option" : 'x-*disable-\(.*\)'`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_feature" : ".*[^-_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid feature name: $ac_feature" >&2
+   { (exit 1); exit 1; }; }
+    ac_feature=`echo $ac_feature | sed 's/-/_/g'`
+    eval "enable_$ac_feature=no" ;;
+
+  -enable-* | --enable-*)
+    ac_feature=`expr "x$ac_option" : 'x-*enable-\([^=]*\)'`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_feature" : ".*[^-_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid feature name: $ac_feature" >&2
+   { (exit 1); exit 1; }; }
+    ac_feature=`echo $ac_feature | sed 's/-/_/g'`
+    case $ac_option in
+      *=*) ac_optarg=`echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"`;;
+      *) ac_optarg=yes ;;
+    esac
+    eval "enable_$ac_feature='$ac_optarg'" ;;
+
+  -exec-prefix | --exec_prefix | --exec-prefix | --exec-prefi \
+  | --exec-pref | --exec-pre | --exec-pr | --exec-p | --exec- \
+  | --exec | --exe | --ex)
+    ac_prev=exec_prefix ;;
+  -exec-prefix=* | --exec_prefix=* | --exec-prefix=* | --exec-prefi=* \
+  | --exec-pref=* | --exec-pre=* | --exec-pr=* | --exec-p=* | --exec-=* \
+  | --exec=* | --exe=* | --ex=*)
+    exec_prefix=$ac_optarg ;;
+
+  -gas | --gas | --ga | --g)
+    # Obsolete; use --with-gas.
+    with_gas=yes ;;
+
+  -help | --help | --hel | --he | -h)
+    ac_init_help=long ;;
+  -help=r* | --help=r* | --hel=r* | --he=r* | -hr*)
+    ac_init_help=recursive ;;
+  -help=s* | --help=s* | --hel=s* | --he=s* | -hs*)
+    ac_init_help=short ;;
+
+  -host | --host | --hos | --ho)
+    ac_prev=host_alias ;;
+  -host=* | --host=* | --hos=* | --ho=*)
+    host_alias=$ac_optarg ;;
+
+  -includedir | --includedir | --includedi | --included | --include \
+  | --includ | --inclu | --incl | --inc)
+    ac_prev=includedir ;;
+  -includedir=* | --includedir=* | --includedi=* | --included=* | --include=* \
+  | --includ=* | --inclu=* | --incl=* | --inc=*)
+    includedir=$ac_optarg ;;
+
+  -infodir | --infodir | --infodi | --infod | --info | --inf)
+    ac_prev=infodir ;;
+  -infodir=* | --infodir=* | --infodi=* | --infod=* | --info=* | --inf=*)
+    infodir=$ac_optarg ;;
+
+  -libdir | --libdir | --libdi | --libd)
+    ac_prev=libdir ;;
+  -libdir=* | --libdir=* | --libdi=* | --libd=*)
+    libdir=$ac_optarg ;;
+
+  -libexecdir | --libexecdir | --libexecdi | --libexecd | --libexec \
+  | --libexe | --libex | --libe)
+    ac_prev=libexecdir ;;
+  -libexecdir=* | --libexecdir=* | --libexecdi=* | --libexecd=* | --libexec=* \
+  | --libexe=* | --libex=* | --libe=*)
+    libexecdir=$ac_optarg ;;
+
+  -localstatedir | --localstatedir | --localstatedi | --localstated \
+  | --localstate | --localstat | --localsta | --localst \
+  | --locals | --local | --loca | --loc | --lo)
+    ac_prev=localstatedir ;;
+  -localstatedir=* | --localstatedir=* | --localstatedi=* | --localstated=* \
+  | --localstate=* | --localstat=* | --localsta=* | --localst=* \
+  | --locals=* | --local=* | --loca=* | --loc=* | --lo=*)
+    localstatedir=$ac_optarg ;;
+
+  -mandir | --mandir | --mandi | --mand | --man | --ma | --m)
+    ac_prev=mandir ;;
+  -mandir=* | --mandir=* | --mandi=* | --mand=* | --man=* | --ma=* | --m=*)
+    mandir=$ac_optarg ;;
+
+  -nfp | --nfp | --nf)
+    # Obsolete; use --without-fp.
+    with_fp=no ;;
+
+  -no-create | --no-create | --no-creat | --no-crea | --no-cre \
+  | --no-cr | --no-c | -n)
+    no_create=yes ;;
+
+  -no-recursion | --no-recursion | --no-recursio | --no-recursi \
+  | --no-recurs | --no-recur | --no-recu | --no-rec | --no-re | --no-r)
+    no_recursion=yes ;;
+
+  -oldincludedir | --oldincludedir | --oldincludedi | --oldincluded \
+  | --oldinclude | --oldinclud | --oldinclu | --oldincl | --oldinc \
+  | --oldin | --oldi | --old | --ol | --o)
+    ac_prev=oldincludedir ;;
+  -oldincludedir=* | --oldincludedir=* | --oldincludedi=* | --oldincluded=* \
+  | --oldinclude=* | --oldinclud=* | --oldinclu=* | --oldincl=* | --oldinc=* \
+  | --oldin=* | --oldi=* | --old=* | --ol=* | --o=*)
+    oldincludedir=$ac_optarg ;;
+
+  -prefix | --prefix | --prefi | --pref | --pre | --pr | --p)
+    ac_prev=prefix ;;
+  -prefix=* | --prefix=* | --prefi=* | --pref=* | --pre=* | --pr=* | --p=*)
+    prefix=$ac_optarg ;;
+
+  -program-prefix | --program-prefix | --program-prefi | --program-pref \
+  | --program-pre | --program-pr | --program-p)
+    ac_prev=program_prefix ;;
+  -program-prefix=* | --program-prefix=* | --program-prefi=* \
+  | --program-pref=* | --program-pre=* | --program-pr=* | --program-p=*)
+    program_prefix=$ac_optarg ;;
+
+  -program-suffix | --program-suffix | --program-suffi | --program-suff \
+  | --program-suf | --program-su | --program-s)
+    ac_prev=program_suffix ;;
+  -program-suffix=* | --program-suffix=* | --program-suffi=* \
+  | --program-suff=* | --program-suf=* | --program-su=* | --program-s=*)
+    program_suffix=$ac_optarg ;;
+
+  -program-transform-name | --program-transform-name \
+  | --program-transform-nam | --program-transform-na \
+  | --program-transform-n | --program-transform- \
+  | --program-transform | --program-transfor \
+  | --program-transfo | --program-transf \
+  | --program-trans | --program-tran \
+  | --progr-tra | --program-tr | --program-t)
+    ac_prev=program_transform_name ;;
+  -program-transform-name=* | --program-transform-name=* \
+  | --program-transform-nam=* | --program-transform-na=* \
+  | --program-transform-n=* | --program-transform-=* \
+  | --program-transform=* | --program-transfor=* \
+  | --program-transfo=* | --program-transf=* \
+  | --program-trans=* | --program-tran=* \
+  | --progr-tra=* | --program-tr=* | --program-t=*)
+    program_transform_name=$ac_optarg ;;
+
+  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+  | -silent | --silent | --silen | --sile | --sil)
+    silent=yes ;;
+
+  -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
+    ac_prev=sbindir ;;
+  -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
+  | --sbi=* | --sb=*)
+    sbindir=$ac_optarg ;;
+
+  -sharedstatedir | --sharedstatedir | --sharedstatedi \
+  | --sharedstated | --sharedstate | --sharedstat | --sharedsta \
+  | --sharedst | --shareds | --shared | --share | --shar \
+  | --sha | --sh)
+    ac_prev=sharedstatedir ;;
+  -sharedstatedir=* | --sharedstatedir=* | --sharedstatedi=* \
+  | --sharedstated=* | --sharedstate=* | --sharedstat=* | --sharedsta=* \
+  | --sharedst=* | --shareds=* | --shared=* | --share=* | --shar=* \
+  | --sha=* | --sh=*)
+    sharedstatedir=$ac_optarg ;;
+
+  -site | --site | --sit)
+    ac_prev=site ;;
+  -site=* | --site=* | --sit=*)
+    site=$ac_optarg ;;
+
+  -srcdir | --srcdir | --srcdi | --srcd | --src | --sr)
+    ac_prev=srcdir ;;
+  -srcdir=* | --srcdir=* | --srcdi=* | --srcd=* | --src=* | --sr=*)
+    srcdir=$ac_optarg ;;
+
+  -sysconfdir | --sysconfdir | --sysconfdi | --sysconfd | --sysconf \
+  | --syscon | --sysco | --sysc | --sys | --sy)
+    ac_prev=sysconfdir ;;
+  -sysconfdir=* | --sysconfdir=* | --sysconfdi=* | --sysconfd=* | --sysconf=* \
+  | --syscon=* | --sysco=* | --sysc=* | --sys=* | --sy=*)
+    sysconfdir=$ac_optarg ;;
+
+  -target | --target | --targe | --targ | --tar | --ta | --t)
+    ac_prev=target_alias ;;
+  -target=* | --target=* | --targe=* | --targ=* | --tar=* | --ta=* | --t=*)
+    target_alias=$ac_optarg ;;
+
+  -v | -verbose | --verbose | --verbos | --verbo | --verb)
+    verbose=yes ;;
+
+  -version | --version | --versio | --versi | --vers | -V)
+    ac_init_version=: ;;
+
+  -with-* | --with-*)
+    ac_package=`expr "x$ac_option" : 'x-*with-\([^=]*\)'`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_package" : ".*[^-_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid package name: $ac_package" >&2
+   { (exit 1); exit 1; }; }
+    ac_package=`echo $ac_package| sed 's/-/_/g'`
+    case $ac_option in
+      *=*) ac_optarg=`echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"`;;
+      *) ac_optarg=yes ;;
+    esac
+    eval "with_$ac_package='$ac_optarg'" ;;
+
+  -without-* | --without-*)
+    ac_package=`expr "x$ac_option" : 'x-*without-\(.*\)'`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_package" : ".*[^-_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid package name: $ac_package" >&2
+   { (exit 1); exit 1; }; }
+    ac_package=`echo $ac_package | sed 's/-/_/g'`
+    eval "with_$ac_package=no" ;;
+
+  --x)
+    # Obsolete; use --with-x.
+    with_x=yes ;;
+
+  -x-includes | --x-includes | --x-include | --x-includ | --x-inclu \
+  | --x-incl | --x-inc | --x-in | --x-i)
+    ac_prev=x_includes ;;
+  -x-includes=* | --x-includes=* | --x-include=* | --x-includ=* | --x-inclu=* \
+  | --x-incl=* | --x-inc=* | --x-in=* | --x-i=*)
+    x_includes=$ac_optarg ;;
+
+  -x-libraries | --x-libraries | --x-librarie | --x-librari \
+  | --x-librar | --x-libra | --x-libr | --x-lib | --x-li | --x-l)
+    ac_prev=x_libraries ;;
+  -x-libraries=* | --x-libraries=* | --x-librarie=* | --x-librari=* \
+  | --x-librar=* | --x-libra=* | --x-libr=* | --x-lib=* | --x-li=* | --x-l=*)
+    x_libraries=$ac_optarg ;;
+
+  -*) { echo "$as_me: error: unrecognized option: $ac_option
+Try \`$0 --help' for more information." >&2
+   { (exit 1); exit 1; }; }
+    ;;
+
+  *=*)
+    ac_envvar=`expr "x$ac_option" : 'x\([^=]*\)='`
+    # Reject names that are not valid shell variable names.
+    expr "x$ac_envvar" : ".*[^_$as_cr_alnum]" >/dev/null &&
+      { echo "$as_me: error: invalid variable name: $ac_envvar" >&2
+   { (exit 1); exit 1; }; }
+    ac_optarg=`echo "$ac_optarg" | sed "s/'/'\\\\\\\\''/g"`
+    eval "$ac_envvar='$ac_optarg'"
+    export $ac_envvar ;;
+
+  *)
+    # FIXME: should be removed in autoconf 3.0.
+    echo "$as_me: WARNING: you should use --build, --host, --target" >&2
+    expr "x$ac_option" : ".*[^-._$as_cr_alnum]" >/dev/null &&
+      echo "$as_me: WARNING: invalid host type: $ac_option" >&2
+    : ${build_alias=$ac_option} ${host_alias=$ac_option} ${target_alias=$ac_option}
+    ;;
+
+  esac
+done
+
+if test -n "$ac_prev"; then
+  ac_option=--`echo $ac_prev | sed 's/_/-/g'`
+  { echo "$as_me: error: missing argument to $ac_option" >&2
+   { (exit 1); exit 1; }; }
+fi
+
+# Be sure to have absolute paths.
+for ac_var in exec_prefix prefix
+do
+  eval ac_val=$`echo $ac_var`
+  case $ac_val in
+    [\\/$]* | ?:[\\/]* | NONE | '' ) ;;
+    *)  { echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
+   { (exit 1); exit 1; }; };;
+  esac
+done
+
+# Be sure to have absolute paths.
+for ac_var in bindir sbindir libexecdir datadir sysconfdir sharedstatedir \
+	      localstatedir libdir includedir oldincludedir infodir mandir
+do
+  eval ac_val=$`echo $ac_var`
+  case $ac_val in
+    [\\/$]* | ?:[\\/]* ) ;;
+    *)  { echo "$as_me: error: expected an absolute directory name for --$ac_var: $ac_val" >&2
+   { (exit 1); exit 1; }; };;
+  esac
+done
+
+# There might be people who depend on the old broken behavior: `$host'
+# used to hold the argument of --host etc.
+# FIXME: To remove some day.
+build=$build_alias
+host=$host_alias
+target=$target_alias
+
+# FIXME: To remove some day.
+if test "x$host_alias" != x; then
+  if test "x$build_alias" = x; then
+    cross_compiling=maybe
+    echo "$as_me: WARNING: If you wanted to set the --build type, don't use --host.
+    If a cross compiler is detected then cross compile mode will be used." >&2
+  elif test "x$build_alias" != "x$host_alias"; then
+    cross_compiling=yes
+  fi
+fi
+
+ac_tool_prefix=
+test -n "$host_alias" && ac_tool_prefix=$host_alias-
+
+test "$silent" = yes && exec 6>/dev/null
+
+
+# Find the source files, if location was not specified.
+if test -z "$srcdir"; then
+  ac_srcdir_defaulted=yes
+  # Try the directory containing this script, then its parent.
+  ac_confdir=`(dirname "$0") 2>/dev/null ||
+$as_expr X"$0" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$0" : 'X\(//\)[^/]' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$0" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+  srcdir=$ac_confdir
+  if test ! -r $srcdir/$ac_unique_file; then
+    srcdir=..
+  fi
+else
+  ac_srcdir_defaulted=no
+fi
+if test ! -r $srcdir/$ac_unique_file; then
+  if test "$ac_srcdir_defaulted" = yes; then
+    { echo "$as_me: error: cannot find sources ($ac_unique_file) in $ac_confdir or .." >&2
+   { (exit 1); exit 1; }; }
+  else
+    { echo "$as_me: error: cannot find sources ($ac_unique_file) in $srcdir" >&2
+   { (exit 1); exit 1; }; }
+  fi
+fi
+(cd $srcdir && test -r ./$ac_unique_file) 2>/dev/null ||
+  { echo "$as_me: error: sources are in $srcdir, but \`cd $srcdir' does not work" >&2
+   { (exit 1); exit 1; }; }
+srcdir=`echo "$srcdir" | sed 's%\([^\\/]\)[\\/]*$%\1%'`
+ac_env_build_alias_set=${build_alias+set}
+ac_env_build_alias_value=$build_alias
+ac_cv_env_build_alias_set=${build_alias+set}
+ac_cv_env_build_alias_value=$build_alias
+ac_env_host_alias_set=${host_alias+set}
+ac_env_host_alias_value=$host_alias
+ac_cv_env_host_alias_set=${host_alias+set}
+ac_cv_env_host_alias_value=$host_alias
+ac_env_target_alias_set=${target_alias+set}
+ac_env_target_alias_value=$target_alias
+ac_cv_env_target_alias_set=${target_alias+set}
+ac_cv_env_target_alias_value=$target_alias
+ac_env_CCAS_set=${CCAS+set}
+ac_env_CCAS_value=$CCAS
+ac_cv_env_CCAS_set=${CCAS+set}
+ac_cv_env_CCAS_value=$CCAS
+ac_env_CCASFLAGS_set=${CCASFLAGS+set}
+ac_env_CCASFLAGS_value=$CCASFLAGS
+ac_cv_env_CCASFLAGS_set=${CCASFLAGS+set}
+ac_cv_env_CCASFLAGS_value=$CCASFLAGS
+
+#
+# Report the --help message.
+#
+if test "$ac_init_help" = "long"; then
+  # Omit some internal or obsolete options to make the list less imposing.
+  # This message is too long to be a string in the A/UX 3.1 sh.
+  cat <<_ACEOF
+\`configure' configures this package to adapt to many kinds of systems.
+
+Usage: $0 [OPTION]... [VAR=VALUE]...
+
+To assign environment variables (e.g., CC, CFLAGS...), specify them as
+VAR=VALUE.  See below for descriptions of some of the useful variables.
+
+Defaults for the options are specified in brackets.
+
+Configuration:
+  -h, --help              display this help and exit
+      --help=short        display options specific to this package
+      --help=recursive    display the short help of all the included packages
+  -V, --version           display version information and exit
+  -q, --quiet, --silent   do not print \`checking...' messages
+      --cache-file=FILE   cache test results in FILE [disabled]
+  -C, --config-cache      alias for \`--cache-file=config.cache'
+  -n, --no-create         do not create output files
+      --srcdir=DIR        find the sources in DIR [configure dir or \`..']
+
+_ACEOF
+
+  cat <<_ACEOF
+Installation directories:
+  --prefix=PREFIX         install architecture-independent files in PREFIX
+			  [$ac_default_prefix]
+  --exec-prefix=EPREFIX   install architecture-dependent files in EPREFIX
+			  [PREFIX]
+
+By default, \`make install' will install all the files in
+\`$ac_default_prefix/bin', \`$ac_default_prefix/lib' etc.  You can specify
+an installation prefix other than \`$ac_default_prefix' using \`--prefix',
+for instance \`--prefix=\$HOME'.
+
+For better control, use the options below.
+
+Fine tuning of the installation directories:
+  --bindir=DIR           user executables [EPREFIX/bin]
+  --sbindir=DIR          system admin executables [EPREFIX/sbin]
+  --libexecdir=DIR       program executables [EPREFIX/libexec]
+  --datadir=DIR          read-only architecture-independent data [PREFIX/share]
+  --sysconfdir=DIR       read-only single-machine data [PREFIX/etc]
+  --sharedstatedir=DIR   modifiable architecture-independent data [PREFIX/com]
+  --localstatedir=DIR    modifiable single-machine data [PREFIX/var]
+  --libdir=DIR           object code libraries [EPREFIX/lib]
+  --includedir=DIR       C header files [PREFIX/include]
+  --oldincludedir=DIR    C header files for non-gcc [/usr/include]
+  --infodir=DIR          info documentation [PREFIX/info]
+  --mandir=DIR           man documentation [PREFIX/man]
+_ACEOF
+
+  cat <<\_ACEOF
+
+Program names:
+  --program-prefix=PREFIX            prepend PREFIX to installed program names
+  --program-suffix=SUFFIX            append SUFFIX to installed program names
+  --program-transform-name=PROGRAM   run sed PROGRAM on installed program names
+
+System types:
+  --build=BUILD     configure for building on BUILD [guessed]
+  --host=HOST       cross-compile to build programs to run on HOST [BUILD]
+  --target=TARGET   configure for building compilers for TARGET [HOST]
+_ACEOF
+fi
+
+if test -n "$ac_init_help"; then
+
+  cat <<\_ACEOF
+
+Optional Features:
+  --disable-FEATURE       do not include FEATURE (same as --enable-FEATURE=no)
+  --enable-FEATURE[=ARG]  include FEATURE [ARG=yes]
+  --disable-dependency-tracking  speeds up one-time build
+  --enable-dependency-tracking   do not reject slow dependency extractors
+
+Some influential environment variables:
+  CCAS        assembler compiler command (defaults to CC)
+  CCASFLAGS   assembler compiler flags (defaults to CFLAGS)
+
+Use these variables to override the choices made by `configure' or to help
+it to find libraries and programs with nonstandard names/locations.
+
+_ACEOF
+fi
+
+if test "$ac_init_help" = "recursive"; then
+  # If there are subdirs, report their specific --help.
+  ac_popdir=`pwd`
+  for ac_dir in : $ac_subdirs_all; do test "x$ac_dir" = x: && continue
+    test -d $ac_dir || continue
+    ac_builddir=.
+
+if test "$ac_dir" != .; then
+  ac_dir_suffix=/`echo "$ac_dir" | sed 's,^\.[\\/],,'`
+  # A "../" for each directory in $ac_dir_suffix.
+  ac_top_builddir=`echo "$ac_dir_suffix" | sed 's,/[^\\/]*,../,g'`
+else
+  ac_dir_suffix= ac_top_builddir=
+fi
+
+case $srcdir in
+  .)  # No --srcdir option.  We are building in place.
+    ac_srcdir=.
+    if test -z "$ac_top_builddir"; then
+       ac_top_srcdir=.
+    else
+       ac_top_srcdir=`echo $ac_top_builddir | sed 's,/$,,'`
+    fi ;;
+  [\\/]* | ?:[\\/]* )  # Absolute path.
+    ac_srcdir=$srcdir$ac_dir_suffix;
+    ac_top_srcdir=$srcdir ;;
+  *) # Relative path.
+    ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
+    ac_top_srcdir=$ac_top_builddir$srcdir ;;
+esac
+
+# Do not use `cd foo && pwd` to compute absolute paths, because
+# the directories may not exist.
+case `pwd` in
+.) ac_abs_builddir="$ac_dir";;
+*)
+  case "$ac_dir" in
+  .) ac_abs_builddir=`pwd`;;
+  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
+  *) ac_abs_builddir=`pwd`/"$ac_dir";;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_builddir=${ac_top_builddir}.;;
+*)
+  case ${ac_top_builddir}. in
+  .) ac_abs_top_builddir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
+  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_srcdir=$ac_srcdir;;
+*)
+  case $ac_srcdir in
+  .) ac_abs_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
+  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_srcdir=$ac_top_srcdir;;
+*)
+  case $ac_top_srcdir in
+  .) ac_abs_top_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
+  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
+  esac;;
+esac
+
+    cd $ac_dir
+    # Check for guested configure; otherwise get Cygnus style configure.
+    if test -f $ac_srcdir/configure.gnu; then
+      echo
+      $SHELL $ac_srcdir/configure.gnu  --help=recursive
+    elif test -f $ac_srcdir/configure; then
+      echo
+      $SHELL $ac_srcdir/configure  --help=recursive
+    elif test -f $ac_srcdir/configure.ac ||
+	   test -f $ac_srcdir/configure.in; then
+      echo
+      $ac_configure --help
+    else
+      echo "$as_me: WARNING: no configuration information is in $ac_dir" >&2
+    fi
+    cd $ac_popdir
+  done
+fi
+
+test -n "$ac_init_help" && exit 0
+if $ac_init_version; then
+  cat <<\_ACEOF
+
+Copyright (C) 2003 Free Software Foundation, Inc.
+This configure script is free software; the Free Software Foundation
+gives unlimited permission to copy, distribute and modify it.
+_ACEOF
+  exit 0
+fi
+exec 5>config.log
+cat >&5 <<_ACEOF
+This file contains any messages produced by compilers while
+running configure, to aid debugging if configure makes a mistake.
+
+It was created by $as_me, which was
+generated by GNU Autoconf 2.59.  Invocation command line was
+
+  $ $0 $@
+
+_ACEOF
+{
+cat <<_ASUNAME
+## --------- ##
+## Platform. ##
+## --------- ##
+
+hostname = `(hostname || uname -n) 2>/dev/null | sed 1q`
+uname -m = `(uname -m) 2>/dev/null || echo unknown`
+uname -r = `(uname -r) 2>/dev/null || echo unknown`
+uname -s = `(uname -s) 2>/dev/null || echo unknown`
+uname -v = `(uname -v) 2>/dev/null || echo unknown`
+
+/usr/bin/uname -p = `(/usr/bin/uname -p) 2>/dev/null || echo unknown`
+/bin/uname -X     = `(/bin/uname -X) 2>/dev/null     || echo unknown`
+
+/bin/arch              = `(/bin/arch) 2>/dev/null              || echo unknown`
+/usr/bin/arch -k       = `(/usr/bin/arch -k) 2>/dev/null       || echo unknown`
+/usr/convex/getsysinfo = `(/usr/convex/getsysinfo) 2>/dev/null || echo unknown`
+hostinfo               = `(hostinfo) 2>/dev/null               || echo unknown`
+/bin/machine           = `(/bin/machine) 2>/dev/null           || echo unknown`
+/usr/bin/oslevel       = `(/usr/bin/oslevel) 2>/dev/null       || echo unknown`
+/bin/universe          = `(/bin/universe) 2>/dev/null          || echo unknown`
+
+_ASUNAME
+
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  echo "PATH: $as_dir"
+done
+
+} >&5
+
+cat >&5 <<_ACEOF
+
+
+## ----------- ##
+## Core tests. ##
+## ----------- ##
+
+_ACEOF
+
+
+# Keep a trace of the command line.
+# Strip out --no-create and --no-recursion so they do not pile up.
+# Strip out --silent because we don't want to record it for future runs.
+# Also quote any args containing shell meta-characters.
+# Make two passes to allow for proper duplicate-argument suppression.
+ac_configure_args=
+ac_configure_args0=
+ac_configure_args1=
+ac_sep=
+ac_must_keep_next=false
+for ac_pass in 1 2
+do
+  for ac_arg
+  do
+    case $ac_arg in
+    -no-create | --no-c* | -n | -no-recursion | --no-r*) continue ;;
+    -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+    | -silent | --silent | --silen | --sile | --sil)
+      continue ;;
+    *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?\"\']*)
+      ac_arg=`echo "$ac_arg" | sed "s/'/'\\\\\\\\''/g"` ;;
+    esac
+    case $ac_pass in
+    1) ac_configure_args0="$ac_configure_args0 '$ac_arg'" ;;
+    2)
+      ac_configure_args1="$ac_configure_args1 '$ac_arg'"
+      if test $ac_must_keep_next = true; then
+	ac_must_keep_next=false # Got value, back to normal.
+      else
+	case $ac_arg in
+	  *=* | --config-cache | -C | -disable-* | --disable-* \
+	  | -enable-* | --enable-* | -gas | --g* | -nfp | --nf* \
+	  | -q | -quiet | --q* | -silent | --sil* | -v | -verb* \
+	  | -with-* | --with-* | -without-* | --without-* | --x)
+	    case "$ac_configure_args0 " in
+	      "$ac_configure_args1"*" '$ac_arg' "* ) continue ;;
+	    esac
+	    ;;
+	  -* ) ac_must_keep_next=true ;;
+	esac
+      fi
+      ac_configure_args="$ac_configure_args$ac_sep'$ac_arg'"
+      # Get rid of the leading space.
+      ac_sep=" "
+      ;;
+    esac
+  done
+done
+$as_unset ac_configure_args0 || test "${ac_configure_args0+set}" != set || { ac_configure_args0=; export ac_configure_args0; }
+$as_unset ac_configure_args1 || test "${ac_configure_args1+set}" != set || { ac_configure_args1=; export ac_configure_args1; }
+
+# When interrupted or exit'd, cleanup temporary files, and complete
+# config.log.  We remove comments because anyway the quotes in there
+# would cause problems or look ugly.
+# WARNING: Be sure not to use single quotes in there, as some shells,
+# such as our DU 5.0 friend, will then `close' the trap.
+trap 'exit_status=$?
+  # Save into config.log some information that might help in debugging.
+  {
+    echo
+
+    cat <<\_ASBOX
+## ---------------- ##
+## Cache variables. ##
+## ---------------- ##
+_ASBOX
+    echo
+    # The following way of writing the cache mishandles newlines in values,
+{
+  (set) 2>&1 |
+    case `(ac_space='"'"' '"'"'; set | grep ac_space) 2>&1` in
+    *ac_space=\ *)
+      sed -n \
+	"s/'"'"'/'"'"'\\\\'"'"''"'"'/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='"'"'\\2'"'"'/p"
+      ;;
+    *)
+      sed -n \
+	"s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p"
+      ;;
+    esac;
+}
+    echo
+
+    cat <<\_ASBOX
+## ----------------- ##
+## Output variables. ##
+## ----------------- ##
+_ASBOX
+    echo
+    for ac_var in $ac_subst_vars
+    do
+      eval ac_val=$`echo $ac_var`
+      echo "$ac_var='"'"'$ac_val'"'"'"
+    done | sort
+    echo
+
+    if test -n "$ac_subst_files"; then
+      cat <<\_ASBOX
+## ------------- ##
+## Output files. ##
+## ------------- ##
+_ASBOX
+      echo
+      for ac_var in $ac_subst_files
+      do
+	eval ac_val=$`echo $ac_var`
+	echo "$ac_var='"'"'$ac_val'"'"'"
+      done | sort
+      echo
+    fi
+
+    if test -s confdefs.h; then
+      cat <<\_ASBOX
+## ----------- ##
+## confdefs.h. ##
+## ----------- ##
+_ASBOX
+      echo
+      sed "/^$/d" confdefs.h | sort
+      echo
+    fi
+    test "$ac_signal" != 0 &&
+      echo "$as_me: caught signal $ac_signal"
+    echo "$as_me: exit $exit_status"
+  } >&5
+  rm -f core *.core &&
+  rm -rf conftest* confdefs* conf$$* $ac_clean_files &&
+    exit $exit_status
+     ' 0
+for ac_signal in 1 2 13 15; do
+  trap 'ac_signal='$ac_signal'; { (exit 1); exit 1; }' $ac_signal
+done
+ac_signal=0
+
+# confdefs.h avoids OS command line length limits that DEFS can exceed.
+rm -rf conftest* confdefs.h
+# AIX cpp loses on an empty file, so make sure it contains at least a newline.
+echo >confdefs.h
+
+# Predefined preprocessor variables.
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_NAME "$PACKAGE_NAME"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_TARNAME "$PACKAGE_TARNAME"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_VERSION "$PACKAGE_VERSION"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_STRING "$PACKAGE_STRING"
+_ACEOF
+
+
+cat >>confdefs.h <<_ACEOF
+#define PACKAGE_BUGREPORT "$PACKAGE_BUGREPORT"
+_ACEOF
+
+
+# Let the site file select an alternate cache file if it wants to.
+# Prefer explicitly selected file to automatically selected ones.
+if test -z "$CONFIG_SITE"; then
+  if test "x$prefix" != xNONE; then
+    CONFIG_SITE="$prefix/share/config.site $prefix/etc/config.site"
+  else
+    CONFIG_SITE="$ac_default_prefix/share/config.site $ac_default_prefix/etc/config.site"
+  fi
+fi
+for ac_site_file in $CONFIG_SITE; do
+  if test -r "$ac_site_file"; then
+    { echo "$as_me:$LINENO: loading site script $ac_site_file" >&5
+echo "$as_me: loading site script $ac_site_file" >&6;}
+    sed 's/^/| /' "$ac_site_file" >&5
+    . "$ac_site_file"
+  fi
+done
+
+if test -r "$cache_file"; then
+  # Some versions of bash will fail to source /dev/null (special
+  # files actually), so we avoid doing that.
+  if test -f "$cache_file"; then
+    { echo "$as_me:$LINENO: loading cache $cache_file" >&5
+echo "$as_me: loading cache $cache_file" >&6;}
+    case $cache_file in
+      [\\/]* | ?:[\\/]* ) . $cache_file;;
+      *)                      . ./$cache_file;;
+    esac
+  fi
+else
+  { echo "$as_me:$LINENO: creating cache $cache_file" >&5
+echo "$as_me: creating cache $cache_file" >&6;}
+  >$cache_file
+fi
+
+# Check that the precious variables saved in the cache have kept the same
+# value.
+ac_cache_corrupted=false
+for ac_var in `(set) 2>&1 |
+	       sed -n 's/^ac_env_\([a-zA-Z_0-9]*\)_set=.*/\1/p'`; do
+  eval ac_old_set=\$ac_cv_env_${ac_var}_set
+  eval ac_new_set=\$ac_env_${ac_var}_set
+  eval ac_old_val="\$ac_cv_env_${ac_var}_value"
+  eval ac_new_val="\$ac_env_${ac_var}_value"
+  case $ac_old_set,$ac_new_set in
+    set,)
+      { echo "$as_me:$LINENO: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&5
+echo "$as_me: error: \`$ac_var' was set to \`$ac_old_val' in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,set)
+      { echo "$as_me:$LINENO: error: \`$ac_var' was not set in the previous run" >&5
+echo "$as_me: error: \`$ac_var' was not set in the previous run" >&2;}
+      ac_cache_corrupted=: ;;
+    ,);;
+    *)
+      if test "x$ac_old_val" != "x$ac_new_val"; then
+	{ echo "$as_me:$LINENO: error: \`$ac_var' has changed since the previous run:" >&5
+echo "$as_me: error: \`$ac_var' has changed since the previous run:" >&2;}
+	{ echo "$as_me:$LINENO:   former value:  $ac_old_val" >&5
+echo "$as_me:   former value:  $ac_old_val" >&2;}
+	{ echo "$as_me:$LINENO:   current value: $ac_new_val" >&5
+echo "$as_me:   current value: $ac_new_val" >&2;}
+	ac_cache_corrupted=:
+      fi;;
+  esac
+  # Pass precious variables to config.status.
+  if test "$ac_new_set" = set; then
+    case $ac_new_val in
+    *" "*|*"	"*|*[\[\]\~\#\$\^\&\*\(\)\{\}\\\|\;\<\>\?\"\']*)
+      ac_arg=$ac_var=`echo "$ac_new_val" | sed "s/'/'\\\\\\\\''/g"` ;;
+    *) ac_arg=$ac_var=$ac_new_val ;;
+    esac
+    case " $ac_configure_args " in
+      *" '$ac_arg' "*) ;; # Avoid dups.  Use of quotes ensures accuracy.
+      *) ac_configure_args="$ac_configure_args '$ac_arg'" ;;
+    esac
+  fi
+done
+if $ac_cache_corrupted; then
+  { echo "$as_me:$LINENO: error: changes in the environment can compromise the build" >&5
+echo "$as_me: error: changes in the environment can compromise the build" >&2;}
+  { { echo "$as_me:$LINENO: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&5
+echo "$as_me: error: run \`make distclean' and/or \`rm $cache_file' and start over" >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+ac_ext=c
+ac_cpp='$CPP $CPPFLAGS'
+ac_compile='$CC -c $CFLAGS $CPPFLAGS conftest.$ac_ext >&5'
+ac_link='$CC -o conftest$ac_exeext $CFLAGS $CPPFLAGS $LDFLAGS conftest.$ac_ext $LIBS >&5'
+ac_compiler_gnu=$ac_cv_c_compiler_gnu
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+
+          ac_config_headers="$ac_config_headers config.h"
+
+
+if test "${enable_shared}" = "yes" ; then
+    echo "Shared libraries not supported for cross compiling, ignored"
+fi
+
+if test "$srcdir" = "." ; then
+  if test "${with_target_subdir}" != "." ; then
+    libgloss_topdir="${srcdir}/${with_multisrctop}../../.."
+  else
+    libgloss_topdir="${srcdir}/${with_multisrctop}../.."
+  fi
+else
+  libgloss_topdir="${srcdir}/../.."
+fi
+ac_aux_dir=
+for ac_dir in $libgloss_topdir $srcdir/$libgloss_topdir; do
+  if test -f $ac_dir/install-sh; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install-sh -c"
+    break
+  elif test -f $ac_dir/install.sh; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/install.sh -c"
+    break
+  elif test -f $ac_dir/shtool; then
+    ac_aux_dir=$ac_dir
+    ac_install_sh="$ac_aux_dir/shtool install -c"
+    break
+  fi
+done
+if test -z "$ac_aux_dir"; then
+  { { echo "$as_me:$LINENO: error: cannot find install-sh or install.sh in $libgloss_topdir $srcdir/$libgloss_topdir" >&5
+echo "$as_me: error: cannot find install-sh or install.sh in $libgloss_topdir $srcdir/$libgloss_topdir" >&2;}
+   { (exit 1); exit 1; }; }
+fi
+ac_config_guess="$SHELL $ac_aux_dir/config.guess"
+ac_config_sub="$SHELL $ac_aux_dir/config.sub"
+ac_configure="$SHELL $ac_aux_dir/configure" # This should be Cygnus configure.
+
+
+# Make sure we can run config.sub.
+$ac_config_sub sun4 >/dev/null 2>&1 ||
+  { { echo "$as_me:$LINENO: error: cannot run $ac_config_sub" >&5
+echo "$as_me: error: cannot run $ac_config_sub" >&2;}
+   { (exit 1); exit 1; }; }
+
+echo "$as_me:$LINENO: checking build system type" >&5
+echo $ECHO_N "checking build system type... $ECHO_C" >&6
+if test "${ac_cv_build+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_build_alias=$build_alias
+test -z "$ac_cv_build_alias" &&
+  ac_cv_build_alias=`$ac_config_guess`
+test -z "$ac_cv_build_alias" &&
+  { { echo "$as_me:$LINENO: error: cannot guess build type; you must specify one" >&5
+echo "$as_me: error: cannot guess build type; you must specify one" >&2;}
+   { (exit 1); exit 1; }; }
+ac_cv_build=`$ac_config_sub $ac_cv_build_alias` ||
+  { { echo "$as_me:$LINENO: error: $ac_config_sub $ac_cv_build_alias failed" >&5
+echo "$as_me: error: $ac_config_sub $ac_cv_build_alias failed" >&2;}
+   { (exit 1); exit 1; }; }
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_build" >&5
+echo "${ECHO_T}$ac_cv_build" >&6
+build=$ac_cv_build
+build_cpu=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
+build_vendor=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
+build_os=`echo $ac_cv_build | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
+
+
+echo "$as_me:$LINENO: checking host system type" >&5
+echo $ECHO_N "checking host system type... $ECHO_C" >&6
+if test "${ac_cv_host+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_host_alias=$host_alias
+test -z "$ac_cv_host_alias" &&
+  ac_cv_host_alias=$ac_cv_build_alias
+ac_cv_host=`$ac_config_sub $ac_cv_host_alias` ||
+  { { echo "$as_me:$LINENO: error: $ac_config_sub $ac_cv_host_alias failed" >&5
+echo "$as_me: error: $ac_config_sub $ac_cv_host_alias failed" >&2;}
+   { (exit 1); exit 1; }; }
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_host" >&5
+echo "${ECHO_T}$ac_cv_host" >&6
+host=$ac_cv_host
+host_cpu=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
+host_vendor=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
+host_os=`echo $ac_cv_host | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
+
+
+echo "$as_me:$LINENO: checking target system type" >&5
+echo $ECHO_N "checking target system type... $ECHO_C" >&6
+if test "${ac_cv_target+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  ac_cv_target_alias=$target_alias
+test "x$ac_cv_target_alias" = "x" &&
+  ac_cv_target_alias=$ac_cv_host_alias
+ac_cv_target=`$ac_config_sub $ac_cv_target_alias` ||
+  { { echo "$as_me:$LINENO: error: $ac_config_sub $ac_cv_target_alias failed" >&5
+echo "$as_me: error: $ac_config_sub $ac_cv_target_alias failed" >&2;}
+   { (exit 1); exit 1; }; }
+
+fi
+echo "$as_me:$LINENO: result: $ac_cv_target" >&5
+echo "${ECHO_T}$ac_cv_target" >&6
+target=$ac_cv_target
+target_cpu=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\1/'`
+target_vendor=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\2/'`
+target_os=`echo $ac_cv_target | sed 's/^\([^-]*\)-\([^-]*\)-\(.*\)$/\3/'`
+
+
+# The aliases save the names the user supplied, while $host etc.
+# will get canonicalized.
+test -n "$target_alias" &&
+  test "$program_prefix$program_suffix$program_transform_name" = \
+    NONENONEs,x,x, &&
+  program_prefix=${target_alias}-
+test "$program_prefix" != NONE &&
+  program_transform_name="s,^,$program_prefix,;$program_transform_name"
+# Use a double $ so make ignores it.
+test "$program_suffix" != NONE &&
+  program_transform_name="s,\$,$program_suffix,;$program_transform_name"
+# Double any \ or $.  echo might interpret backslashes.
+# By default was `s,x,x', remove it if useless.
+cat <<\_ACEOF >conftest.sed
+s/[\\$]/&&/g;s/;s,x,x,$//
+_ACEOF
+program_transform_name=`echo $program_transform_name | sed -f conftest.sed`
+rm conftest.sed
+
+
+# Find a good install program.  We prefer a C program (faster),
+# so one script is as good as another.  But avoid the broken or
+# incompatible versions:
+# SysV /etc/install, /usr/sbin/install
+# SunOS /usr/etc/install
+# IRIX /sbin/install
+# AIX /bin/install
+# AmigaOS /C/install, which installs bootblocks on floppy discs
+# AIX 4 /usr/bin/installbsd, which doesn't work without a -g flag
+# AFS /usr/afsws/bin/install, which mishandles nonexistent args
+# SVR4 /usr/ucb/install, which tries to use the nonexistent group "staff"
+# OS/2's system install, which has a completely different semantic
+# ./install, which can be erroneously created by make from ./install.sh.
+echo "$as_me:$LINENO: checking for a BSD-compatible install" >&5
+echo $ECHO_N "checking for a BSD-compatible install... $ECHO_C" >&6
+if test -z "$INSTALL"; then
+if test "${ac_cv_path_install+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  # Account for people who put trailing slashes in PATH elements.
+case $as_dir/ in
+  ./ | .// | /cC/* | \
+  /etc/* | /usr/sbin/* | /usr/etc/* | /sbin/* | /usr/afsws/bin/* | \
+  ?:\\/os2\\/install\\/* | ?:\\/OS2\\/INSTALL\\/* | \
+  /usr/ucb/* ) ;;
+  *)
+    # OSF1 and SCO ODT 3.0 have their own names for install.
+    # Don't use installbsd from OSF since it installs stuff as root
+    # by default.
+    for ac_prog in ginstall scoinst install; do
+      for ac_exec_ext in '' $ac_executable_extensions; do
+	if $as_executable_p "$as_dir/$ac_prog$ac_exec_ext"; then
+	  if test $ac_prog = install &&
+	    grep dspmsg "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+	    # AIX install.  It has an incompatible calling convention.
+	    :
+	  elif test $ac_prog = install &&
+	    grep pwplus "$as_dir/$ac_prog$ac_exec_ext" >/dev/null 2>&1; then
+	    # program-specific install script used by HP pwplus--don't use.
+	    :
+	  else
+	    ac_cv_path_install="$as_dir/$ac_prog$ac_exec_ext -c"
+	    break 3
+	  fi
+	fi
+      done
+    done
+    ;;
+esac
+done
+
+
+fi
+  if test "${ac_cv_path_install+set}" = set; then
+    INSTALL=$ac_cv_path_install
+  else
+    # As a last resort, use the slow shell script.  We don't cache a
+    # path for INSTALL within a source directory, because that will
+    # break other packages using the cache if that directory is
+    # removed, or if the path is relative.
+    INSTALL=$ac_install_sh
+  fi
+fi
+echo "$as_me:$LINENO: result: $INSTALL" >&5
+echo "${ECHO_T}$INSTALL" >&6
+
+# Use test -z because SunOS4 sh mishandles braces in ${var-val}.
+# It thinks the first close brace ends the variable substitution.
+test -z "$INSTALL_PROGRAM" && INSTALL_PROGRAM='${INSTALL}'
+
+test -z "$INSTALL_SCRIPT" && INSTALL_SCRIPT='${INSTALL}'
+
+test -z "$INSTALL_DATA" && INSTALL_DATA='${INSTALL} -m 644'
+
+
+cat >>confdefs.h <<\_ACEOF
+#define HAVE_GNU_LD 1
+_ACEOF
+
+case "${target}" in
+  *-*-cygwin*)
+	;;
+  a29k-amd-udi)
+	;;
+  arc-*-*)
+	;;
+  arm-*-pe)
+	;;
+  arm-*-*)
+	;;
+  strongarm-*-*)
+	;;
+  cris-*-* | crisv32-*-*)
+	;;
+  d10v*)
+	;;
+  h8300*-*-*)
+	;;
+  h8500-*-*)
+	;;
+  i345686-*-sco*)
+	;;
+  m32r-*-*)
+	;;
+  mn10?00-*-*)
+	;;
+  powerpc-eabi-elf-gekko)
+   cat >>confdefs.h <<\_ACEOF
+#define MISSING_SYSCALL_NAMES 1
+_ACEOF
+
+   cat >>confdefs.h <<\_ACEOF
+#define REENTRANT_SYSCALLS_PROVIDED 1
+_ACEOF
+
+   ;;
+  powerpcle-*-pe)
+	;;
+  sh*-*-*)
+	;;
+  sparc-sun-sunos*)
+	;;
+  sparc64-*-*)
+	;;
+  thumb-*-pe)
+	;;
+  thumb-*-*)
+	;;
+  v850-*-*)
+	;;
+  v850e-*-*)
+	;;
+  v850ea-*-*)
+	;;
+  w65-*-*)
+	;;
+  xstormy16-*-*)
+	;;
+  z8k-*-*)
+	;;
+  *)
+	cat >>confdefs.h <<\_ACEOF
+#define MISSING_SYSCALL_NAMES 1
+_ACEOF
+
+	;;
+esac
+
+case "${target}" in
+  *-*-elf)
+        cat >>confdefs.h <<\_ACEOF
+#define HAVE_ELF 1
+_ACEOF
+
+
+        echo "$as_me:$LINENO: checking for .previous assembler directive" >&5
+echo $ECHO_N "checking for .previous assembler directive... $ECHO_C" >&6
+if test "${libc_cv_asm_previous_directive+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+          libc_cv_asm_previous_directive=no
+        cat > conftest.s <<EOF
+.section foo_section
+.previous
+EOF
+        if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+          libc_cv_asm_previous_directive=yes
+        fi
+        rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_asm_previous_directive" >&5
+echo "${ECHO_T}$libc_cv_asm_previous_directive" >&6
+
+	if test "x${libc_cv_asm_previous_directive}" = "xyes"; then
+          cat >>confdefs.h <<\_ACEOF
+#define HAVE_ASM_PREVIOUS_DIRECTIVE 1
+_ACEOF
+
+	fi
+
+        echo "$as_me:$LINENO: checking for .popsection assembler directive" >&5
+echo $ECHO_N "checking for .popsection assembler directive... $ECHO_C" >&6
+if test "${libc_cv_asm_popsection_directive+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+          libc_cv_asm_popsection_directive=no
+        cat > conftest.s <<EOF
+.pushsection foo_section
+.popsection
+EOF
+        if { ac_try='${CC-cc} -c $CFLAGS conftest.s 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+          libc_cv_asm_popsection_directive=yes
+        fi
+        rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_asm_popsection_directive" >&5
+echo "${ECHO_T}$libc_cv_asm_popsection_directive" >&6
+
+	if test "x${libc_cv_asm_popsection_directive}" = "xyes"; then
+          cat >>confdefs.h <<\_ACEOF
+#define HAVE_ASM_POPSECTION_DIRECTIVE 1
+_ACEOF
+
+	fi
+
+        echo "$as_me:$LINENO: checking for section attributes" >&5
+echo $ECHO_N "checking for section attributes... $ECHO_C" >&6
+if test "${libc_cv_section_attributes+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+          libc_cv_section_attributes=no
+        cat > conftest.c <<EOF
+int secttest __attribute__ ((section (".gnu.warning.secttest"))) = 10;
+int main() {}
+EOF
+        if { ac_try='${CC-cc} -c $CFLAGS conftest.c 1>&5'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+          libc_cv_section_attributes=yes
+        fi
+        rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_cv_section_attributes" >&5
+echo "${ECHO_T}$libc_cv_section_attributes" >&6
+	if test "x${libc_cv_section_attributes}" = "xyes"; then
+          cat >>confdefs.h <<\_ACEOF
+#define HAVE_SECTION_ATTRIBUTES 1
+_ACEOF
+
+	fi
+        ;;
+esac
+
+echo "$as_me:$LINENO: checking for symbol prefix" >&5
+echo $ECHO_N "checking for symbol prefix... $ECHO_C" >&6
+if test "${libc_symbol_prefix+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat > conftest.c <<\EOF
+foo () { }
+EOF
+libc_symbol_prefix=none
+if { ac_try='${CC-cc} -S conftest.c -o - | fgrep "\$foo" > /dev/null'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; };
+then
+  libc_symbol_prefix='$'
+else
+  if { ac_try='${CC-cc} -S conftest.c -o - | fgrep "_foo" > /dev/null'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; };
+  then
+    libc_symbol_prefix=_
+  fi
+fi
+rm -f conftest*
+fi
+echo "$as_me:$LINENO: result: $libc_symbol_prefix" >&5
+echo "${ECHO_T}$libc_symbol_prefix" >&6
+if test $libc_symbol_prefix != none; then
+  cat >>confdefs.h <<_ACEOF
+#define __SYMBOL_PREFIX "$libc_symbol_prefix"
+_ACEOF
+
+else
+  cat >>confdefs.h <<\_ACEOF
+#define __SYMBOL_PREFIX ""
+_ACEOF
+
+fi
+
+rm -rf .tst 2>/dev/null
+mkdir .tst 2>/dev/null
+if test -d .tst; then
+  am__leading_dot=.
+else
+  am__leading_dot=_
+fi
+rmdir .tst 2>/dev/null
+
+DEPDIR="${am__leading_dot}deps"
+
+          ac_config_commands="$ac_config_commands depfiles"
+
+
+am_make=${MAKE-make}
+cat > confinc << 'END'
+am__doit:
+	@echo done
+.PHONY: am__doit
+END
+# If we don't find an include directive, just comment out the code.
+echo "$as_me:$LINENO: checking for style of include used by $am_make" >&5
+echo $ECHO_N "checking for style of include used by $am_make... $ECHO_C" >&6
+am__include="#"
+am__quote=
+_am_result=none
+# First try GNU make style include.
+echo "include confinc" > confmf
+# We grep out `Entering directory' and `Leaving directory'
+# messages which can occur if `w' ends up in MAKEFLAGS.
+# In particular we don't look at `^make:' because GNU make might
+# be invoked under some other name (usually "gmake"), in which
+# case it prints its new name instead of `make'.
+if test "`$am_make -s -f confmf 2> /dev/null | grep -v 'ing directory'`" = "done"; then
+   am__include=include
+   am__quote=
+   _am_result=GNU
+fi
+# Now try BSD make style include.
+if test "$am__include" = "#"; then
+   echo '.include "confinc"' > confmf
+   if test "`$am_make -s -f confmf 2> /dev/null`" = "done"; then
+      am__include=.include
+      am__quote="\""
+      _am_result=BSD
+   fi
+fi
+
+
+echo "$as_me:$LINENO: result: $_am_result" >&5
+echo "${ECHO_T}$_am_result" >&6
+rm -f confinc confmf
+
+# Check whether --enable-dependency-tracking or --disable-dependency-tracking was given.
+if test "${enable_dependency_tracking+set}" = set; then
+  enableval="$enable_dependency_tracking"
+
+fi;
+if test "x$enable_dependency_tracking" != xno; then
+  am_depcomp="$ac_aux_dir/depcomp"
+  AMDEPBACKSLASH='\'
+fi
+
+
+if test "x$enable_dependency_tracking" != xno; then
+  AMDEP_TRUE=
+  AMDEP_FALSE='#'
+else
+  AMDEP_TRUE='#'
+  AMDEP_FALSE=
+fi
+
+
+
+# Extract the first word of "gcc", so it can be a program name with args.
+set dummy gcc; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_CC="gcc"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+
+depcc="$CC"   am_compiler_list=
+
+echo "$as_me:$LINENO: checking dependency style of $depcc" >&5
+echo $ECHO_N "checking dependency style of $depcc... $ECHO_C" >&6
+if test "${am_cv_CC_dependencies_compiler_type+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -z "$AMDEP_TRUE" && test -f "$am_depcomp"; then
+  # We make a subdir and do the tests there.  Otherwise we can end up
+  # making bogus files that we don't know about and never remove.  For
+  # instance it was reported that on HP-UX the gcc test will end up
+  # making a dummy file named `D' -- because `-MD' means `put the output
+  # in D'.
+  mkdir conftest.dir
+  # Copy depcomp to subdir because otherwise we won't find it if we're
+  # using a relative directory.
+  cp "$am_depcomp" conftest.dir
+  cd conftest.dir
+  # We will build objects and dependencies in a subdirectory because
+  # it helps to detect inapplicable dependency modes.  For instance
+  # both Tru64's cc and ICC support -MD to output dependencies as a
+  # side effect of compilation, but ICC will put the dependencies in
+  # the current directory while Tru64 will put them in the object
+  # directory.
+  mkdir sub
+
+  am_cv_CC_dependencies_compiler_type=none
+  if test "$am_compiler_list" = ""; then
+     am_compiler_list=`sed -n 's/^#*\([a-zA-Z0-9]*\))$/\1/p' < ./depcomp`
+  fi
+  for depmode in $am_compiler_list; do
+    # Setup a source with many dependencies, because some compilers
+    # like to wrap large dependency lists on column 80 (with \), and
+    # we should not choose a depcomp mode which is confused by this.
+    #
+    # We need to recreate these files for each test, as the compiler may
+    # overwrite some of them when testing with obscure command lines.
+    # This happens at least with the AIX C compiler.
+    : > sub/conftest.c
+    for i in 1 2 3 4 5 6; do
+      echo '#include "conftst'$i'.h"' >> sub/conftest.c
+      # Using `: > sub/conftst$i.h' creates only sub/conftst1.h with
+      # Solaris 8's {/usr,}/bin/sh.
+      touch sub/conftst$i.h
+    done
+    echo "${am__include} ${am__quote}sub/conftest.Po${am__quote}" > confmf
+
+    case $depmode in
+    nosideeffect)
+      # after this tag, mechanisms are not by side-effect, so they'll
+      # only be used when explicitly requested
+      if test "x$enable_dependency_tracking" = xyes; then
+	continue
+      else
+	break
+      fi
+      ;;
+    none) break ;;
+    esac
+    # We check with `-c' and `-o' for the sake of the "dashmstdout"
+    # mode.  It turns out that the SunPro C++ compiler does not properly
+    # handle `-M -o', and we need to detect this.
+    if depmode=$depmode \
+       source=sub/conftest.c object=sub/conftest.${OBJEXT-o} \
+       depfile=sub/conftest.Po tmpdepfile=sub/conftest.TPo \
+       $SHELL ./depcomp $depcc -c -o sub/conftest.${OBJEXT-o} sub/conftest.c \
+         >/dev/null 2>conftest.err &&
+       grep sub/conftst6.h sub/conftest.Po > /dev/null 2>&1 &&
+       grep sub/conftest.${OBJEXT-o} sub/conftest.Po > /dev/null 2>&1 &&
+       ${MAKE-make} -s -f confmf > /dev/null 2>&1; then
+      # icc doesn't choke on unknown options, it will just issue warnings
+      # or remarks (even with -Werror).  So we grep stderr for any message
+      # that says an option was ignored or not supported.
+      # When given -MP, icc 7.0 and 7.1 complain thusly:
+      #   icc: Command line warning: ignoring option '-M'; no argument required
+      # The diagnosis changed in icc 8.0:
+      #   icc: Command line remark: option '-MP' not supported
+      if (grep 'ignoring option' conftest.err ||
+          grep 'not supported' conftest.err) >/dev/null 2>&1; then :; else
+        am_cv_CC_dependencies_compiler_type=$depmode
+        break
+      fi
+    fi
+  done
+
+  cd ..
+  rm -rf conftest.dir
+else
+  am_cv_CC_dependencies_compiler_type=none
+fi
+
+fi
+echo "$as_me:$LINENO: result: $am_cv_CC_dependencies_compiler_type" >&5
+echo "${ECHO_T}$am_cv_CC_dependencies_compiler_type" >&6
+CCDEPMODE=depmode=$am_cv_CC_dependencies_compiler_type
+
+
+
+if
+  test "x$enable_dependency_tracking" != xno \
+  && test "$am_cv_CC_dependencies_compiler_type" = gcc3; then
+  am__fastdepCC_TRUE=
+  am__fastdepCC_FALSE='#'
+else
+  am__fastdepCC_TRUE='#'
+  am__fastdepCC_FALSE=
+fi
+
+
+if test -z "$CC"; then
+  # Extract the first word of "cc", so it can be a program name with args.
+set dummy cc; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_CC+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$CC"; then
+  ac_cv_prog_CC="$CC" # Let the user override the test.
+else
+  ac_prog_rejected=no
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    if test "$as_dir/$ac_word$ac_exec_ext" = "/usr/ucb/cc"; then
+       ac_prog_rejected=yes
+       continue
+     fi
+    ac_cv_prog_CC="cc"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+if test $ac_prog_rejected = yes; then
+  # We found a bogon in the path, so make sure we never use it.
+  set dummy $ac_cv_prog_CC
+  shift
+  if test $# != 0; then
+    # We chose a different compiler from the bogus one.
+    # However, it has the same basename, so the bogon will be chosen
+    # first if we set CC to just the basename; use the full file name.
+    shift
+    ac_cv_prog_CC="$as_dir/$ac_word${1+' '}$@"
+  fi
+fi
+fi
+fi
+CC=$ac_cv_prog_CC
+if test -n "$CC"; then
+  echo "$as_me:$LINENO: result: $CC" >&5
+echo "${ECHO_T}$CC" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  test -z "$CC" && { { echo "$as_me:$LINENO: error: no acceptable cc found in \$PATH" >&5
+echo "$as_me: error: no acceptable cc found in \$PATH" >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+echo "$as_me:$LINENO: checking whether we are using GNU C" >&5
+echo $ECHO_N "checking whether we are using GNU C... $ECHO_C" >&6
+if test "${ac_cv_c_compiler_gnu+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat > conftest.c <<EOF
+#ifdef __GNUC__
+  yes;
+#endif
+EOF
+if { ac_try='${CC-cc} -E conftest.c'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } | egrep yes >/dev/null 2>&1; then
+  ac_cv_c_compiler_gnu=yes
+else
+  ac_cv_c_compiler_gnu=no
+fi
+fi
+echo "$as_me:$LINENO: result: $ac_cv_c_compiler_gnu" >&5
+echo "${ECHO_T}$ac_cv_c_compiler_gnu" >&6
+
+if test $ac_cv_c_compiler_gnu = yes; then
+  GCC=yes
+  ac_test_CFLAGS="${CFLAGS+set}"
+  ac_save_CFLAGS="$CFLAGS"
+  CFLAGS=
+  ac_test_CFLAGS=${CFLAGS+set}
+ac_save_CFLAGS=$CFLAGS
+CFLAGS="-g"
+echo "$as_me:$LINENO: checking whether $CC accepts -g" >&5
+echo $ECHO_N "checking whether $CC accepts -g... $ECHO_C" >&6
+if test "${ac_cv_prog_cc_g+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  cat >conftest.$ac_ext <<_ACEOF
+/* confdefs.h.  */
+_ACEOF
+cat confdefs.h >>conftest.$ac_ext
+cat >>conftest.$ac_ext <<_ACEOF
+/* end confdefs.h.  */
+
+int
+main ()
+{
+
+  ;
+  return 0;
+}
+_ACEOF
+rm -f conftest.$ac_objext
+if { (eval echo "$as_me:$LINENO: \"$ac_compile\"") >&5
+  (eval $ac_compile) 2>conftest.er1
+  ac_status=$?
+  grep -v '^ *+' conftest.er1 >conftest.err
+  rm -f conftest.er1
+  cat conftest.err >&5
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); } &&
+	 { ac_try='test -z "$ac_c_werror_flag"
+			 || test ! -s conftest.err'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; } &&
+	 { ac_try='test -s conftest.$ac_objext'
+  { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+  (eval $ac_try) 2>&5
+  ac_status=$?
+  echo "$as_me:$LINENO: \$? = $ac_status" >&5
+  (exit $ac_status); }; }; then
+  ac_cv_prog_cc_g=yes
+else
+  echo "$as_me: failed program was:" >&5
+sed 's/^/| /' conftest.$ac_ext >&5
+
+ac_cv_prog_cc_g=no
+fi
+rm -f conftest.err conftest.$ac_objext conftest.$ac_ext
+fi
+echo "$as_me:$LINENO: result: $ac_cv_prog_cc_g" >&5
+echo "${ECHO_T}$ac_cv_prog_cc_g" >&6
+if test "$ac_test_CFLAGS" = set; then
+  CFLAGS=$ac_save_CFLAGS
+elif test $ac_cv_prog_cc_g = yes; then
+  if test "$GCC" = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-g"
+  fi
+else
+  if test "$GCC" = yes; then
+    CFLAGS="-O2"
+  else
+    CFLAGS=
+  fi
+fi
+  if test "$ac_test_CFLAGS" = set; then
+    CFLAGS="$ac_save_CFLAGS"
+  elif test $ac_cv_prog_cc_g = yes; then
+    CFLAGS="-g -O2"
+  else
+    CFLAGS="-O2"
+  fi
+else
+  GCC=
+  test "${CFLAGS+set}" = set || CFLAGS="-g"
+fi
+
+AS=${AS-as}
+
+AR=${AR-ar}
+
+LD=${LD-ld}
+
+if test -n "$ac_tool_prefix"; then
+  # Extract the first word of "${ac_tool_prefix}ranlib", so it can be a program name with args.
+set dummy ${ac_tool_prefix}ranlib; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_RANLIB+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$RANLIB"; then
+  ac_cv_prog_RANLIB="$RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_RANLIB="${ac_tool_prefix}ranlib"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+fi
+fi
+RANLIB=$ac_cv_prog_RANLIB
+if test -n "$RANLIB"; then
+  echo "$as_me:$LINENO: result: $RANLIB" >&5
+echo "${ECHO_T}$RANLIB" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+fi
+if test -z "$ac_cv_prog_RANLIB"; then
+  ac_ct_RANLIB=$RANLIB
+  # Extract the first word of "ranlib", so it can be a program name with args.
+set dummy ranlib; ac_word=$2
+echo "$as_me:$LINENO: checking for $ac_word" >&5
+echo $ECHO_N "checking for $ac_word... $ECHO_C" >&6
+if test "${ac_cv_prog_ac_ct_RANLIB+set}" = set; then
+  echo $ECHO_N "(cached) $ECHO_C" >&6
+else
+  if test -n "$ac_ct_RANLIB"; then
+  ac_cv_prog_ac_ct_RANLIB="$ac_ct_RANLIB" # Let the user override the test.
+else
+as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for ac_exec_ext in '' $ac_executable_extensions; do
+  if $as_executable_p "$as_dir/$ac_word$ac_exec_ext"; then
+    ac_cv_prog_ac_ct_RANLIB="ranlib"
+    echo "$as_me:$LINENO: found $as_dir/$ac_word$ac_exec_ext" >&5
+    break 2
+  fi
+done
+done
+
+  test -z "$ac_cv_prog_ac_ct_RANLIB" && ac_cv_prog_ac_ct_RANLIB=":"
+fi
+fi
+ac_ct_RANLIB=$ac_cv_prog_ac_ct_RANLIB
+if test -n "$ac_ct_RANLIB"; then
+  echo "$as_me:$LINENO: result: $ac_ct_RANLIB" >&5
+echo "${ECHO_T}$ac_ct_RANLIB" >&6
+else
+  echo "$as_me:$LINENO: result: no" >&5
+echo "${ECHO_T}no" >&6
+fi
+
+  RANLIB=$ac_ct_RANLIB
+else
+  RANLIB="$ac_cv_prog_RANLIB"
+fi
+
+# By default we simply use the C compiler to build assembly code.
+
+test "${CCAS+set}" = set || CCAS=$CC
+test "${CCASFLAGS+set}" = set || CCASFLAGS=$CFLAGS
+
+
+
+
+host_makefile_frag=${srcdir}/../config/default.mh
+
+host_makefile_frag_path=$host_makefile_frag
+
+
+
+          ac_config_files="$ac_config_files Makefile"
+
+cat >confcache <<\_ACEOF
+# This file is a shell script that caches the results of configure
+# tests run on this system so they can be shared between configure
+# scripts and configure runs, see configure's option --config-cache.
+# It is not useful on other systems.  If it contains results you don't
+# want to keep, you may remove or edit it.
+#
+# config.status only pays attention to the cache file if you give it
+# the --recheck option to rerun configure.
+#
+# `ac_cv_env_foo' variables (set or unset) will be overridden when
+# loading this file, other *unset* `ac_cv_foo' will be assigned the
+# following values.
+
+_ACEOF
+
+# The following way of writing the cache mishandles newlines in values,
+# but we know of no workaround that is simple, portable, and efficient.
+# So, don't put newlines in cache variables' values.
+# Ultrix sh set writes to stderr and can't be redirected directly,
+# and sets the high bit in the cache file unless we assign to the vars.
+{
+  (set) 2>&1 |
+    case `(ac_space=' '; set | grep ac_space) 2>&1` in
+    *ac_space=\ *)
+      # `set' does not quote correctly, so add quotes (double-quote
+      # substitution turns \\\\ into \\, and sed turns \\ into \).
+      sed -n \
+	"s/'/'\\\\''/g;
+	  s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1='\\2'/p"
+      ;;
+    *)
+      # `set' quotes correctly as required by POSIX, so do not add quotes.
+      sed -n \
+	"s/^\\([_$as_cr_alnum]*_cv_[_$as_cr_alnum]*\\)=\\(.*\\)/\\1=\\2/p"
+      ;;
+    esac;
+} |
+  sed '
+     t clear
+     : clear
+     s/^\([^=]*\)=\(.*[{}].*\)$/test "${\1+set}" = set || &/
+     t end
+     /^ac_cv_env/!s/^\([^=]*\)=\(.*\)$/\1=${\1=\2}/
+     : end' >>confcache
+if diff $cache_file confcache >/dev/null 2>&1; then :; else
+  if test -w $cache_file; then
+    test "x$cache_file" != "x/dev/null" && echo "updating cache $cache_file"
+    cat confcache >$cache_file
+  else
+    echo "not updating unwritable cache $cache_file"
+  fi
+fi
+rm -f confcache
+
+test "x$prefix" = xNONE && prefix=$ac_default_prefix
+# Let make expand exec_prefix.
+test "x$exec_prefix" = xNONE && exec_prefix='${prefix}'
+
+# VPATH may cause trouble with some makes, so we remove $(srcdir),
+# ${srcdir} and @srcdir@ from VPATH if srcdir is ".", strip leading and
+# trailing colons and then remove the whole line if VPATH becomes empty
+# (actually we leave an empty line to preserve line numbers).
+if test "x$srcdir" = x.; then
+  ac_vpsub='/^[	 ]*VPATH[	 ]*=/{
+s/:*\$(srcdir):*/:/;
+s/:*\${srcdir}:*/:/;
+s/:*@srcdir@:*/:/;
+s/^\([^=]*=[	 ]*\):*/\1/;
+s/:*$//;
+s/^[^=]*=[	 ]*$//;
+}'
+fi
+
+DEFS=-DHAVE_CONFIG_H
+
+ac_libobjs=
+ac_ltlibobjs=
+for ac_i in : $LIBOBJS; do test "x$ac_i" = x: && continue
+  # 1. Remove the extension, and $U if already installed.
+  ac_i=`echo "$ac_i" |
+	 sed 's/\$U\././;s/\.o$//;s/\.obj$//'`
+  # 2. Add them.
+  ac_libobjs="$ac_libobjs $ac_i\$U.$ac_objext"
+  ac_ltlibobjs="$ac_ltlibobjs $ac_i"'$U.lo'
+done
+LIBOBJS=$ac_libobjs
+
+LTLIBOBJS=$ac_ltlibobjs
+
+
+if test -z "${AMDEP_TRUE}" && test -z "${AMDEP_FALSE}"; then
+  { { echo "$as_me:$LINENO: error: conditional \"AMDEP\" was never defined.
+Usually this means the macro was only invoked conditionally." >&5
+echo "$as_me: error: conditional \"AMDEP\" was never defined.
+Usually this means the macro was only invoked conditionally." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+if test -z "${am__fastdepCC_TRUE}" && test -z "${am__fastdepCC_FALSE}"; then
+  { { echo "$as_me:$LINENO: error: conditional \"am__fastdepCC\" was never defined.
+Usually this means the macro was only invoked conditionally." >&5
+echo "$as_me: error: conditional \"am__fastdepCC\" was never defined.
+Usually this means the macro was only invoked conditionally." >&2;}
+   { (exit 1); exit 1; }; }
+fi
+
+: ${CONFIG_STATUS=./config.status}
+ac_clean_files_save=$ac_clean_files
+ac_clean_files="$ac_clean_files $CONFIG_STATUS"
+{ echo "$as_me:$LINENO: creating $CONFIG_STATUS" >&5
+echo "$as_me: creating $CONFIG_STATUS" >&6;}
+cat >$CONFIG_STATUS <<_ACEOF
+#! $SHELL
+# Generated by $as_me.
+# Run this file to recreate the current configuration.
+# Compiler output produced by configure, useful for debugging
+# configure, is in config.log if it exists.
+
+debug=false
+ac_cs_recheck=false
+ac_cs_silent=false
+SHELL=\${CONFIG_SHELL-$SHELL}
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+## --------------------- ##
+## M4sh Initialization.  ##
+## --------------------- ##
+
+# Be Bourne compatible
+if test -n "${ZSH_VERSION+set}" && (emulate sh) >/dev/null 2>&1; then
+  emulate sh
+  NULLCMD=:
+  # Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
+  # is contrary to our usage.  Disable this feature.
+  alias -g '${1+"$@"}'='"$@"'
+elif test -n "${BASH_VERSION+set}" && (set -o posix) >/dev/null 2>&1; then
+  set -o posix
+fi
+DUALCASE=1; export DUALCASE # for MKS sh
+
+# Support unset when possible.
+if ( (MAIL=60; unset MAIL) || exit) >/dev/null 2>&1; then
+  as_unset=unset
+else
+  as_unset=false
+fi
+
+
+# Work around bugs in pre-3.0 UWIN ksh.
+$as_unset ENV MAIL MAILPATH
+PS1='$ '
+PS2='> '
+PS4='+ '
+
+# NLS nuisances.
+for as_var in \
+  LANG LANGUAGE LC_ADDRESS LC_ALL LC_COLLATE LC_CTYPE LC_IDENTIFICATION \
+  LC_MEASUREMENT LC_MESSAGES LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER \
+  LC_TELEPHONE LC_TIME
+do
+  if (set +x; test -z "`(eval $as_var=C; export $as_var) 2>&1`"); then
+    eval $as_var=C; export $as_var
+  else
+    $as_unset $as_var
+  fi
+done
+
+# Required to use basename.
+if expr a : '\(a\)' >/dev/null 2>&1; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+if (basename /) >/dev/null 2>&1 && test "X`basename / 2>&1`" = "X/"; then
+  as_basename=basename
+else
+  as_basename=false
+fi
+
+
+# Name of the executable.
+as_me=`$as_basename "$0" ||
+$as_expr X/"$0" : '.*/\([^/][^/]*\)/*$' \| \
+	 X"$0" : 'X\(//\)$' \| \
+	 X"$0" : 'X\(/\)$' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X/"$0" |
+    sed '/^.*\/\([^/][^/]*\)\/*$/{ s//\1/; q; }
+  	  /^X\/\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\/\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+
+
+# PATH needs CR, and LINENO needs CR and PATH.
+# Avoid depending upon Character Ranges.
+as_cr_letters='abcdefghijklmnopqrstuvwxyz'
+as_cr_LETTERS='ABCDEFGHIJKLMNOPQRSTUVWXYZ'
+as_cr_Letters=$as_cr_letters$as_cr_LETTERS
+as_cr_digits='0123456789'
+as_cr_alnum=$as_cr_Letters$as_cr_digits
+
+# The user is always right.
+if test "${PATH_SEPARATOR+set}" != set; then
+  echo "#! /bin/sh" >conf$$.sh
+  echo  "exit 0"   >>conf$$.sh
+  chmod +x conf$$.sh
+  if (PATH="/nonexistent;."; conf$$.sh) >/dev/null 2>&1; then
+    PATH_SEPARATOR=';'
+  else
+    PATH_SEPARATOR=:
+  fi
+  rm -f conf$$.sh
+fi
+
+
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`
+  test "x$as_lineno_1" != "x$as_lineno_2" &&
+  test "x$as_lineno_3"  = "x$as_lineno_2"  || {
+  # Find who we are.  Look in the path if we contain no path at all
+  # relative or not.
+  case $0 in
+    *[\\/]* ) as_myself=$0 ;;
+    *) as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in $PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  test -r "$as_dir/$0" && as_myself=$as_dir/$0 && break
+done
+
+       ;;
+  esac
+  # We did not find ourselves, most probably we were run as `sh COMMAND'
+  # in which case we are not to be found in the path.
+  if test "x$as_myself" = x; then
+    as_myself=$0
+  fi
+  if test ! -f "$as_myself"; then
+    { { echo "$as_me:$LINENO: error: cannot find myself; rerun with an absolute path" >&5
+echo "$as_me: error: cannot find myself; rerun with an absolute path" >&2;}
+   { (exit 1); exit 1; }; }
+  fi
+  case $CONFIG_SHELL in
+  '')
+    as_save_IFS=$IFS; IFS=$PATH_SEPARATOR
+for as_dir in /bin$PATH_SEPARATOR/usr/bin$PATH_SEPARATOR$PATH
+do
+  IFS=$as_save_IFS
+  test -z "$as_dir" && as_dir=.
+  for as_base in sh bash ksh sh5; do
+	 case $as_dir in
+	 /*)
+	   if ("$as_dir/$as_base" -c '
+  as_lineno_1=$LINENO
+  as_lineno_2=$LINENO
+  as_lineno_3=`(expr $as_lineno_1 + 1) 2>/dev/null`
+  test "x$as_lineno_1" != "x$as_lineno_2" &&
+  test "x$as_lineno_3"  = "x$as_lineno_2" ') 2>/dev/null; then
+	     $as_unset BASH_ENV || test "${BASH_ENV+set}" != set || { BASH_ENV=; export BASH_ENV; }
+	     $as_unset ENV || test "${ENV+set}" != set || { ENV=; export ENV; }
+	     CONFIG_SHELL=$as_dir/$as_base
+	     export CONFIG_SHELL
+	     exec "$CONFIG_SHELL" "$0" ${1+"$@"}
+	   fi;;
+	 esac
+       done
+done
+;;
+  esac
+
+  # Create $as_me.lineno as a copy of $as_myself, but with $LINENO
+  # uniformly replaced by the line number.  The first 'sed' inserts a
+  # line-number line before each line; the second 'sed' does the real
+  # work.  The second script uses 'N' to pair each line-number line
+  # with the numbered line, and appends trailing '-' during
+  # substitution so that $LINENO is not a special case at line end.
+  # (Raja R Harinath suggested sed '=', and Paul Eggert wrote the
+  # second 'sed' script.  Blame Lee E. McMahon for sed's syntax.  :-)
+  sed '=' <$as_myself |
+    sed '
+      N
+      s,$,-,
+      : loop
+      s,^\(['$as_cr_digits']*\)\(.*\)[$]LINENO\([^'$as_cr_alnum'_]\),\1\2\1\3,
+      t loop
+      s,-$,,
+      s,^['$as_cr_digits']*\n,,
+    ' >$as_me.lineno &&
+  chmod +x $as_me.lineno ||
+    { { echo "$as_me:$LINENO: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&5
+echo "$as_me: error: cannot create $as_me.lineno; rerun with a POSIX shell" >&2;}
+   { (exit 1); exit 1; }; }
+
+  # Don't try to exec as it changes $[0], causing all sort of problems
+  # (the dirname of $[0] is not the place where we might find the
+  # original and so on.  Autoconf is especially sensible to this).
+  . ./$as_me.lineno
+  # Exit status is that of the last command.
+  exit
+}
+
+
+case `echo "testing\c"; echo 1,2,3`,`echo -n testing; echo 1,2,3` in
+  *c*,-n*) ECHO_N= ECHO_C='
+' ECHO_T='	' ;;
+  *c*,*  ) ECHO_N=-n ECHO_C= ECHO_T= ;;
+  *)       ECHO_N= ECHO_C='\c' ECHO_T= ;;
+esac
+
+if expr a : '\(a\)' >/dev/null 2>&1; then
+  as_expr=expr
+else
+  as_expr=false
+fi
+
+rm -f conf$$ conf$$.exe conf$$.file
+echo >conf$$.file
+if ln -s conf$$.file conf$$ 2>/dev/null; then
+  # We could just check for DJGPP; but this test a) works b) is more generic
+  # and c) will remain valid once DJGPP supports symlinks (DJGPP 2.04).
+  if test -f conf$$.exe; then
+    # Don't use ln at all; we don't have any links
+    as_ln_s='cp -p'
+  else
+    as_ln_s='ln -s'
+  fi
+elif ln conf$$.file conf$$ 2>/dev/null; then
+  as_ln_s=ln
+else
+  as_ln_s='cp -p'
+fi
+rm -f conf$$ conf$$.exe conf$$.file
+
+if mkdir -p . 2>/dev/null; then
+  as_mkdir_p=:
+else
+  test -d ./-p && rmdir ./-p
+  as_mkdir_p=false
+fi
+
+as_executable_p="test -f"
+
+# Sed expression to map a string onto a valid CPP name.
+as_tr_cpp="eval sed 'y%*$as_cr_letters%P$as_cr_LETTERS%;s%[^_$as_cr_alnum]%_%g'"
+
+# Sed expression to map a string onto a valid variable name.
+as_tr_sh="eval sed 'y%*+%pp%;s%[^_$as_cr_alnum]%_%g'"
+
+
+# IFS
+# We need space, tab and new line, in precisely that order.
+as_nl='
+'
+IFS=" 	$as_nl"
+
+# CDPATH.
+$as_unset CDPATH
+
+exec 6>&1
+
+# Open the log real soon, to keep \$[0] and so on meaningful, and to
+# report actual input values of CONFIG_FILES etc. instead of their
+# values after options handling.  Logging --version etc. is OK.
+exec 5>>config.log
+{
+  echo
+  sed 'h;s/./-/g;s/^.../## /;s/...$/ ##/;p;x;p;x' <<_ASBOX
+## Running $as_me. ##
+_ASBOX
+} >&5
+cat >&5 <<_CSEOF
+
+This file was extended by $as_me, which was
+generated by GNU Autoconf 2.59.  Invocation command line was
+
+  CONFIG_FILES    = $CONFIG_FILES
+  CONFIG_HEADERS  = $CONFIG_HEADERS
+  CONFIG_LINKS    = $CONFIG_LINKS
+  CONFIG_COMMANDS = $CONFIG_COMMANDS
+  $ $0 $@
+
+_CSEOF
+echo "on `(hostname || uname -n) 2>/dev/null | sed 1q`" >&5
+echo >&5
+_ACEOF
+
+# Files that config.status was made for.
+if test -n "$ac_config_files"; then
+  echo "config_files=\"$ac_config_files\"" >>$CONFIG_STATUS
+fi
+
+if test -n "$ac_config_headers"; then
+  echo "config_headers=\"$ac_config_headers\"" >>$CONFIG_STATUS
+fi
+
+if test -n "$ac_config_links"; then
+  echo "config_links=\"$ac_config_links\"" >>$CONFIG_STATUS
+fi
+
+if test -n "$ac_config_commands"; then
+  echo "config_commands=\"$ac_config_commands\"" >>$CONFIG_STATUS
+fi
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+
+ac_cs_usage="\
+\`$as_me' instantiates files from templates according to the
+current configuration.
+
+Usage: $0 [OPTIONS] [FILE]...
+
+  -h, --help       print this help, then exit
+  -V, --version    print version number, then exit
+  -q, --quiet      do not print progress messages
+  -d, --debug      don't remove temporary files
+      --recheck    update $as_me by reconfiguring in the same conditions
+  --file=FILE[:TEMPLATE]
+		   instantiate the configuration file FILE
+  --header=FILE[:TEMPLATE]
+		   instantiate the configuration header FILE
+
+Configuration files:
+$config_files
+
+Configuration headers:
+$config_headers
+
+Configuration commands:
+$config_commands
+
+Report bugs to <bug-autoconf@gnu.org>."
+_ACEOF
+
+cat >>$CONFIG_STATUS <<_ACEOF
+ac_cs_version="\\
+config.status
+configured by $0, generated by GNU Autoconf 2.59,
+  with options \\"`echo "$ac_configure_args" | sed 's/[\\""\`\$]/\\\\&/g'`\\"
+
+Copyright (C) 2003 Free Software Foundation, Inc.
+This config.status script is free software; the Free Software Foundation
+gives unlimited permission to copy, distribute and modify it."
+srcdir=$srcdir
+INSTALL="$INSTALL"
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+# If no file are specified by the user, then we need to provide default
+# value.  By we need to know if files were specified by the user.
+ac_need_defaults=:
+while test $# != 0
+do
+  case $1 in
+  --*=*)
+    ac_option=`expr "x$1" : 'x\([^=]*\)='`
+    ac_optarg=`expr "x$1" : 'x[^=]*=\(.*\)'`
+    ac_shift=:
+    ;;
+  -*)
+    ac_option=$1
+    ac_optarg=$2
+    ac_shift=shift
+    ;;
+  *) # This is not an option, so the user has probably given explicit
+     # arguments.
+     ac_option=$1
+     ac_need_defaults=false;;
+  esac
+
+  case $ac_option in
+  # Handling of the options.
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+  -recheck | --recheck | --rechec | --reche | --rech | --rec | --re | --r)
+    ac_cs_recheck=: ;;
+  --version | --vers* | -V )
+    echo "$ac_cs_version"; exit 0 ;;
+  --he | --h)
+    # Conflict between --help and --header
+    { { echo "$as_me:$LINENO: error: ambiguous option: $1
+Try \`$0 --help' for more information." >&5
+echo "$as_me: error: ambiguous option: $1
+Try \`$0 --help' for more information." >&2;}
+   { (exit 1); exit 1; }; };;
+  --help | --hel | -h )
+    echo "$ac_cs_usage"; exit 0 ;;
+  --debug | --d* | -d )
+    debug=: ;;
+  --file | --fil | --fi | --f )
+    $ac_shift
+    CONFIG_FILES="$CONFIG_FILES $ac_optarg"
+    ac_need_defaults=false;;
+  --header | --heade | --head | --hea )
+    $ac_shift
+    CONFIG_HEADERS="$CONFIG_HEADERS $ac_optarg"
+    ac_need_defaults=false;;
+  -q | -quiet | --quiet | --quie | --qui | --qu | --q \
+  | -silent | --silent | --silen | --sile | --sil | --si | --s)
+    ac_cs_silent=: ;;
+
+  # This is an error.
+  -*) { { echo "$as_me:$LINENO: error: unrecognized option: $1
+Try \`$0 --help' for more information." >&5
+echo "$as_me: error: unrecognized option: $1
+Try \`$0 --help' for more information." >&2;}
+   { (exit 1); exit 1; }; } ;;
+
+  *) ac_config_targets="$ac_config_targets $1" ;;
+
+  esac
+  shift
+done
+
+ac_configure_extra_args=
+
+if $ac_cs_silent; then
+  exec 6>/dev/null
+  ac_configure_extra_args="$ac_configure_extra_args --silent"
+fi
+
+_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF
+if \$ac_cs_recheck; then
+  echo "running $SHELL $0 " $ac_configure_args \$ac_configure_extra_args " --no-create --no-recursion" >&6
+  exec $SHELL $0 $ac_configure_args \$ac_configure_extra_args --no-create --no-recursion
+fi
+
+_ACEOF
+
+cat >>$CONFIG_STATUS <<_ACEOF
+#
+# INIT-COMMANDS section.
+#
+
+AMDEP_TRUE="$AMDEP_TRUE" ac_aux_dir="$ac_aux_dir"
+srcdir=${srcdir}
+target=${target}
+with_multisubdir=${with_multisubdir}
+ac_configure_args="${ac_configure_args} --enable-multilib"
+CONFIG_SHELL=${CONFIG_SHELL-/bin/sh}
+libgloss_topdir=${libgloss_topdir}
+
+
+_ACEOF
+
+
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+for ac_config_target in $ac_config_targets
+do
+  case "$ac_config_target" in
+  # Handling of arguments.
+  "Makefile" ) CONFIG_FILES="$CONFIG_FILES Makefile" ;;
+  "depfiles" ) CONFIG_COMMANDS="$CONFIG_COMMANDS depfiles" ;;
+  "config.h" ) CONFIG_HEADERS="$CONFIG_HEADERS config.h" ;;
+  *) { { echo "$as_me:$LINENO: error: invalid argument: $ac_config_target" >&5
+echo "$as_me: error: invalid argument: $ac_config_target" >&2;}
+   { (exit 1); exit 1; }; };;
+  esac
+done
+
+# If the user did not use the arguments to specify the items to instantiate,
+# then the envvar interface is used.  Set only those that are not.
+# We use the long form for the default assignment because of an extremely
+# bizarre bug on SunOS 4.1.3.
+if $ac_need_defaults; then
+  test "${CONFIG_FILES+set}" = set || CONFIG_FILES=$config_files
+  test "${CONFIG_HEADERS+set}" = set || CONFIG_HEADERS=$config_headers
+  test "${CONFIG_COMMANDS+set}" = set || CONFIG_COMMANDS=$config_commands
+fi
+
+# Have a temporary directory for convenience.  Make it in the build tree
+# simply because there is no reason to put it here, and in addition,
+# creating and moving files from /tmp can sometimes cause problems.
+# Create a temporary directory, and hook for its removal unless debugging.
+$debug ||
+{
+  trap 'exit_status=$?; rm -rf $tmp && exit $exit_status' 0
+  trap '{ (exit 1); exit 1; }' 1 2 13 15
+}
+
+# Create a (secure) tmp directory for tmp files.
+
+{
+  tmp=`(umask 077 && mktemp -d -q "./confstatXXXXXX") 2>/dev/null` &&
+  test -n "$tmp" && test -d "$tmp"
+}  ||
+{
+  tmp=./confstat$$-$RANDOM
+  (umask 077 && mkdir $tmp)
+} ||
+{
+   echo "$me: cannot create a temporary directory in ." >&2
+   { (exit 1); exit 1; }
+}
+
+_ACEOF
+
+cat >>$CONFIG_STATUS <<_ACEOF
+
+#
+# CONFIG_FILES section.
+#
+
+# No need to generate the scripts if there are no CONFIG_FILES.
+# This happens for instance when ./config.status config.h
+if test -n "\$CONFIG_FILES"; then
+  # Protect against being on the right side of a sed subst in config.status.
+  sed 's/,@/@@/; s/@,/@@/; s/,;t t\$/@;t t/; /@;t t\$/s/[\\\\&,]/\\\\&/g;
+   s/@@/,@/; s/@@/@,/; s/@;t t\$/,;t t/' >\$tmp/subs.sed <<\\CEOF
+s,@SHELL@,$SHELL,;t t
+s,@PATH_SEPARATOR@,$PATH_SEPARATOR,;t t
+s,@PACKAGE_NAME@,$PACKAGE_NAME,;t t
+s,@PACKAGE_TARNAME@,$PACKAGE_TARNAME,;t t
+s,@PACKAGE_VERSION@,$PACKAGE_VERSION,;t t
+s,@PACKAGE_STRING@,$PACKAGE_STRING,;t t
+s,@PACKAGE_BUGREPORT@,$PACKAGE_BUGREPORT,;t t
+s,@exec_prefix@,$exec_prefix,;t t
+s,@prefix@,$prefix,;t t
+s,@program_transform_name@,$program_transform_name,;t t
+s,@bindir@,$bindir,;t t
+s,@sbindir@,$sbindir,;t t
+s,@libexecdir@,$libexecdir,;t t
+s,@datadir@,$datadir,;t t
+s,@sysconfdir@,$sysconfdir,;t t
+s,@sharedstatedir@,$sharedstatedir,;t t
+s,@localstatedir@,$localstatedir,;t t
+s,@libdir@,$libdir,;t t
+s,@includedir@,$includedir,;t t
+s,@oldincludedir@,$oldincludedir,;t t
+s,@infodir@,$infodir,;t t
+s,@mandir@,$mandir,;t t
+s,@build_alias@,$build_alias,;t t
+s,@host_alias@,$host_alias,;t t
+s,@target_alias@,$target_alias,;t t
+s,@DEFS@,$DEFS,;t t
+s,@ECHO_C@,$ECHO_C,;t t
+s,@ECHO_N@,$ECHO_N,;t t
+s,@ECHO_T@,$ECHO_T,;t t
+s,@LIBS@,$LIBS,;t t
+s,@build@,$build,;t t
+s,@build_cpu@,$build_cpu,;t t
+s,@build_vendor@,$build_vendor,;t t
+s,@build_os@,$build_os,;t t
+s,@host@,$host,;t t
+s,@host_cpu@,$host_cpu,;t t
+s,@host_vendor@,$host_vendor,;t t
+s,@host_os@,$host_os,;t t
+s,@target@,$target,;t t
+s,@target_cpu@,$target_cpu,;t t
+s,@target_vendor@,$target_vendor,;t t
+s,@target_os@,$target_os,;t t
+s,@INSTALL_PROGRAM@,$INSTALL_PROGRAM,;t t
+s,@INSTALL_SCRIPT@,$INSTALL_SCRIPT,;t t
+s,@INSTALL_DATA@,$INSTALL_DATA,;t t
+s,@CC@,$CC,;t t
+s,@am__leading_dot@,$am__leading_dot,;t t
+s,@DEPDIR@,$DEPDIR,;t t
+s,@am__include@,$am__include,;t t
+s,@am__quote@,$am__quote,;t t
+s,@AMDEP_TRUE@,$AMDEP_TRUE,;t t
+s,@AMDEP_FALSE@,$AMDEP_FALSE,;t t
+s,@AMDEPBACKSLASH@,$AMDEPBACKSLASH,;t t
+s,@CCDEPMODE@,$CCDEPMODE,;t t
+s,@am__fastdepCC_TRUE@,$am__fastdepCC_TRUE,;t t
+s,@am__fastdepCC_FALSE@,$am__fastdepCC_FALSE,;t t
+s,@AS@,$AS,;t t
+s,@AR@,$AR,;t t
+s,@LD@,$LD,;t t
+s,@RANLIB@,$RANLIB,;t t
+s,@ac_ct_RANLIB@,$ac_ct_RANLIB,;t t
+s,@CCAS@,$CCAS,;t t
+s,@CCASFLAGS@,$CCASFLAGS,;t t
+s,@host_makefile_frag_path@,$host_makefile_frag_path,;t t
+s,@LIBOBJS@,$LIBOBJS,;t t
+s,@LTLIBOBJS@,$LTLIBOBJS,;t t
+/@host_makefile_frag@/r $host_makefile_frag
+s,@host_makefile_frag@,,;t t
+CEOF
+
+_ACEOF
+
+  cat >>$CONFIG_STATUS <<\_ACEOF
+  # Split the substitutions into bite-sized pieces for seds with
+  # small command number limits, like on Digital OSF/1 and HP-UX.
+  ac_max_sed_lines=48
+  ac_sed_frag=1 # Number of current file.
+  ac_beg=1 # First line for current file.
+  ac_end=$ac_max_sed_lines # Line after last line for current file.
+  ac_more_lines=:
+  ac_sed_cmds=
+  while $ac_more_lines; do
+    if test $ac_beg -gt 1; then
+      sed "1,${ac_beg}d; ${ac_end}q" $tmp/subs.sed >$tmp/subs.frag
+    else
+      sed "${ac_end}q" $tmp/subs.sed >$tmp/subs.frag
+    fi
+    if test ! -s $tmp/subs.frag; then
+      ac_more_lines=false
+    else
+      # The purpose of the label and of the branching condition is to
+      # speed up the sed processing (if there are no `@' at all, there
+      # is no need to browse any of the substitutions).
+      # These are the two extra sed commands mentioned above.
+      (echo ':t
+  /@[a-zA-Z_][a-zA-Z_0-9]*@/!b' && cat $tmp/subs.frag) >$tmp/subs-$ac_sed_frag.sed
+      if test -z "$ac_sed_cmds"; then
+	ac_sed_cmds="sed -f $tmp/subs-$ac_sed_frag.sed"
+      else
+	ac_sed_cmds="$ac_sed_cmds | sed -f $tmp/subs-$ac_sed_frag.sed"
+      fi
+      ac_sed_frag=`expr $ac_sed_frag + 1`
+      ac_beg=$ac_end
+      ac_end=`expr $ac_end + $ac_max_sed_lines`
+    fi
+  done
+  if test -z "$ac_sed_cmds"; then
+    ac_sed_cmds=cat
+  fi
+fi # test -n "$CONFIG_FILES"
+
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+for ac_file in : $CONFIG_FILES; do test "x$ac_file" = x: && continue
+  # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
+  case $ac_file in
+  - | *:- | *:-:* ) # input from stdin
+	cat >$tmp/stdin
+	ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+  *:* ) ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+  * )   ac_file_in=$ac_file.in ;;
+  esac
+
+  # Compute @srcdir@, @top_srcdir@, and @INSTALL@ for subdirectories.
+  ac_dir=`(dirname "$ac_file") 2>/dev/null ||
+$as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$ac_file" : 'X\(//\)[^/]' \| \
+	 X"$ac_file" : 'X\(//\)$' \| \
+	 X"$ac_file" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$ac_file" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+  { if $as_mkdir_p; then
+    mkdir -p "$ac_dir"
+  else
+    as_dir="$ac_dir"
+    as_dirs=
+    while test ! -d "$as_dir"; do
+      as_dirs="$as_dir $as_dirs"
+      as_dir=`(dirname "$as_dir") 2>/dev/null ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    done
+    test ! -n "$as_dirs" || mkdir $as_dirs
+  fi || { { echo "$as_me:$LINENO: error: cannot create directory \"$ac_dir\"" >&5
+echo "$as_me: error: cannot create directory \"$ac_dir\"" >&2;}
+   { (exit 1); exit 1; }; }; }
+
+  ac_builddir=.
+
+if test "$ac_dir" != .; then
+  ac_dir_suffix=/`echo "$ac_dir" | sed 's,^\.[\\/],,'`
+  # A "../" for each directory in $ac_dir_suffix.
+  ac_top_builddir=`echo "$ac_dir_suffix" | sed 's,/[^\\/]*,../,g'`
+else
+  ac_dir_suffix= ac_top_builddir=
+fi
+
+case $srcdir in
+  .)  # No --srcdir option.  We are building in place.
+    ac_srcdir=.
+    if test -z "$ac_top_builddir"; then
+       ac_top_srcdir=.
+    else
+       ac_top_srcdir=`echo $ac_top_builddir | sed 's,/$,,'`
+    fi ;;
+  [\\/]* | ?:[\\/]* )  # Absolute path.
+    ac_srcdir=$srcdir$ac_dir_suffix;
+    ac_top_srcdir=$srcdir ;;
+  *) # Relative path.
+    ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
+    ac_top_srcdir=$ac_top_builddir$srcdir ;;
+esac
+
+# Do not use `cd foo && pwd` to compute absolute paths, because
+# the directories may not exist.
+case `pwd` in
+.) ac_abs_builddir="$ac_dir";;
+*)
+  case "$ac_dir" in
+  .) ac_abs_builddir=`pwd`;;
+  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
+  *) ac_abs_builddir=`pwd`/"$ac_dir";;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_builddir=${ac_top_builddir}.;;
+*)
+  case ${ac_top_builddir}. in
+  .) ac_abs_top_builddir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
+  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_srcdir=$ac_srcdir;;
+*)
+  case $ac_srcdir in
+  .) ac_abs_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
+  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_srcdir=$ac_top_srcdir;;
+*)
+  case $ac_top_srcdir in
+  .) ac_abs_top_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
+  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
+  esac;;
+esac
+
+
+  case $INSTALL in
+  [\\/$]* | ?:[\\/]* ) ac_INSTALL=$INSTALL ;;
+  *) ac_INSTALL=$ac_top_builddir$INSTALL ;;
+  esac
+
+  if test x"$ac_file" != x-; then
+    { echo "$as_me:$LINENO: creating $ac_file" >&5
+echo "$as_me: creating $ac_file" >&6;}
+    rm -f "$ac_file"
+  fi
+  # Let's still pretend it is `configure' which instantiates (i.e., don't
+  # use $as_me), people would be surprised to read:
+  #    /* config.h.  Generated by config.status.  */
+  if test x"$ac_file" = x-; then
+    configure_input=
+  else
+    configure_input="$ac_file.  "
+  fi
+  configure_input=$configure_input"Generated from `echo $ac_file_in |
+				     sed 's,.*/,,'` by configure."
+
+  # First look for the input files in the build tree, otherwise in the
+  # src tree.
+  ac_file_inputs=`IFS=:
+    for f in $ac_file_in; do
+      case $f in
+      -) echo $tmp/stdin ;;
+      [\\/$]*)
+	 # Absolute (can't be DOS-style, as IFS=:)
+	 test -f "$f" || { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+echo "$as_me: error: cannot find input file: $f" >&2;}
+   { (exit 1); exit 1; }; }
+	 echo "$f";;
+      *) # Relative
+	 if test -f "$f"; then
+	   # Build tree
+	   echo "$f"
+	 elif test -f "$srcdir/$f"; then
+	   # Source tree
+	   echo "$srcdir/$f"
+	 else
+	   # /dev/null tree
+	   { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+echo "$as_me: error: cannot find input file: $f" >&2;}
+   { (exit 1); exit 1; }; }
+	 fi;;
+      esac
+    done` || { (exit 1); exit 1; }
+_ACEOF
+cat >>$CONFIG_STATUS <<_ACEOF
+  sed "$ac_vpsub
+$extrasub
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+:t
+/@[a-zA-Z_][a-zA-Z_0-9]*@/!b
+s,@configure_input@,$configure_input,;t t
+s,@srcdir@,$ac_srcdir,;t t
+s,@abs_srcdir@,$ac_abs_srcdir,;t t
+s,@top_srcdir@,$ac_top_srcdir,;t t
+s,@abs_top_srcdir@,$ac_abs_top_srcdir,;t t
+s,@builddir@,$ac_builddir,;t t
+s,@abs_builddir@,$ac_abs_builddir,;t t
+s,@top_builddir@,$ac_top_builddir,;t t
+s,@abs_top_builddir@,$ac_abs_top_builddir,;t t
+s,@INSTALL@,$ac_INSTALL,;t t
+" $ac_file_inputs | (eval "$ac_sed_cmds") >$tmp/out
+  rm -f $tmp/stdin
+  if test x"$ac_file" != x-; then
+    mv $tmp/out $ac_file
+  else
+    cat $tmp/out
+    rm -f $tmp/out
+  fi
+
+  # Run the commands associated with the file.
+  case $ac_file in
+    Makefile ) ac_file=Makefile . ${libgloss_topdir}/config-ml.in ;;
+  esac
+done
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+
+#
+# CONFIG_HEADER section.
+#
+
+# These sed commands are passed to sed as "A NAME B NAME C VALUE D", where
+# NAME is the cpp macro being defined and VALUE is the value it is being given.
+#
+# ac_d sets the value in "#define NAME VALUE" lines.
+ac_dA='s,^\([	 ]*\)#\([	 ]*define[	 ][	 ]*\)'
+ac_dB='[	 ].*$,\1#\2'
+ac_dC=' '
+ac_dD=',;t'
+# ac_u turns "#undef NAME" without trailing blanks into "#define NAME VALUE".
+ac_uA='s,^\([	 ]*\)#\([	 ]*\)undef\([	 ][	 ]*\)'
+ac_uB='$,\1#\2define\3'
+ac_uC=' '
+ac_uD=',;t'
+
+for ac_file in : $CONFIG_HEADERS; do test "x$ac_file" = x: && continue
+  # Support "outfile[:infile[:infile...]]", defaulting infile="outfile.in".
+  case $ac_file in
+  - | *:- | *:-:* ) # input from stdin
+	cat >$tmp/stdin
+	ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+  *:* ) ac_file_in=`echo "$ac_file" | sed 's,[^:]*:,,'`
+	ac_file=`echo "$ac_file" | sed 's,:.*,,'` ;;
+  * )   ac_file_in=$ac_file.in ;;
+  esac
+
+  test x"$ac_file" != x- && { echo "$as_me:$LINENO: creating $ac_file" >&5
+echo "$as_me: creating $ac_file" >&6;}
+
+  # First look for the input files in the build tree, otherwise in the
+  # src tree.
+  ac_file_inputs=`IFS=:
+    for f in $ac_file_in; do
+      case $f in
+      -) echo $tmp/stdin ;;
+      [\\/$]*)
+	 # Absolute (can't be DOS-style, as IFS=:)
+	 test -f "$f" || { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+echo "$as_me: error: cannot find input file: $f" >&2;}
+   { (exit 1); exit 1; }; }
+	 # Do quote $f, to prevent DOS paths from being IFS'd.
+	 echo "$f";;
+      *) # Relative
+	 if test -f "$f"; then
+	   # Build tree
+	   echo "$f"
+	 elif test -f "$srcdir/$f"; then
+	   # Source tree
+	   echo "$srcdir/$f"
+	 else
+	   # /dev/null tree
+	   { { echo "$as_me:$LINENO: error: cannot find input file: $f" >&5
+echo "$as_me: error: cannot find input file: $f" >&2;}
+   { (exit 1); exit 1; }; }
+	 fi;;
+      esac
+    done` || { (exit 1); exit 1; }
+  # Remove the trailing spaces.
+  sed 's/[	 ]*$//' $ac_file_inputs >$tmp/in
+
+_ACEOF
+
+# Transform confdefs.h into two sed scripts, `conftest.defines' and
+# `conftest.undefs', that substitutes the proper values into
+# config.h.in to produce config.h.  The first handles `#define'
+# templates, and the second `#undef' templates.
+# And first: Protect against being on the right side of a sed subst in
+# config.status.  Protect against being in an unquoted here document
+# in config.status.
+rm -f conftest.defines conftest.undefs
+# Using a here document instead of a string reduces the quoting nightmare.
+# Putting comments in sed scripts is not portable.
+#
+# `end' is used to avoid that the second main sed command (meant for
+# 0-ary CPP macros) applies to n-ary macro definitions.
+# See the Autoconf documentation for `clear'.
+cat >confdef2sed.sed <<\_ACEOF
+s/[\\&,]/\\&/g
+s,[\\$`],\\&,g
+t clear
+: clear
+s,^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 (][^	 (]*\)\(([^)]*)\)[	 ]*\(.*\)$,${ac_dA}\1${ac_dB}\1\2${ac_dC}\3${ac_dD},gp
+t end
+s,^[	 ]*#[	 ]*define[	 ][	 ]*\([^	 ][^	 ]*\)[	 ]*\(.*\)$,${ac_dA}\1${ac_dB}\1${ac_dC}\2${ac_dD},gp
+: end
+_ACEOF
+# If some macros were called several times there might be several times
+# the same #defines, which is useless.  Nevertheless, we may not want to
+# sort them, since we want the *last* AC-DEFINE to be honored.
+uniq confdefs.h | sed -n -f confdef2sed.sed >conftest.defines
+sed 's/ac_d/ac_u/g' conftest.defines >conftest.undefs
+rm -f confdef2sed.sed
+
+# This sed command replaces #undef with comments.  This is necessary, for
+# example, in the case of _POSIX_SOURCE, which is predefined and required
+# on some systems where configure will not decide to define it.
+cat >>conftest.undefs <<\_ACEOF
+s,^[	 ]*#[	 ]*undef[	 ][	 ]*[a-zA-Z_][a-zA-Z_0-9]*,/* & */,
+_ACEOF
+
+# Break up conftest.defines because some shells have a limit on the size
+# of here documents, and old seds have small limits too (100 cmds).
+echo '  # Handle all the #define templates only if necessary.' >>$CONFIG_STATUS
+echo '  if grep "^[	 ]*#[	 ]*define" $tmp/in >/dev/null; then' >>$CONFIG_STATUS
+echo '  # If there are no defines, we may have an empty if/fi' >>$CONFIG_STATUS
+echo '  :' >>$CONFIG_STATUS
+rm -f conftest.tail
+while grep . conftest.defines >/dev/null
+do
+  # Write a limited-size here document to $tmp/defines.sed.
+  echo '  cat >$tmp/defines.sed <<CEOF' >>$CONFIG_STATUS
+  # Speed up: don't consider the non `#define' lines.
+  echo '/^[	 ]*#[	 ]*define/!b' >>$CONFIG_STATUS
+  # Work around the forget-to-reset-the-flag bug.
+  echo 't clr' >>$CONFIG_STATUS
+  echo ': clr' >>$CONFIG_STATUS
+  sed ${ac_max_here_lines}q conftest.defines >>$CONFIG_STATUS
+  echo 'CEOF
+  sed -f $tmp/defines.sed $tmp/in >$tmp/out
+  rm -f $tmp/in
+  mv $tmp/out $tmp/in
+' >>$CONFIG_STATUS
+  sed 1,${ac_max_here_lines}d conftest.defines >conftest.tail
+  rm -f conftest.defines
+  mv conftest.tail conftest.defines
+done
+rm -f conftest.defines
+echo '  fi # grep' >>$CONFIG_STATUS
+echo >>$CONFIG_STATUS
+
+# Break up conftest.undefs because some shells have a limit on the size
+# of here documents, and old seds have small limits too (100 cmds).
+echo '  # Handle all the #undef templates' >>$CONFIG_STATUS
+rm -f conftest.tail
+while grep . conftest.undefs >/dev/null
+do
+  # Write a limited-size here document to $tmp/undefs.sed.
+  echo '  cat >$tmp/undefs.sed <<CEOF' >>$CONFIG_STATUS
+  # Speed up: don't consider the non `#undef'
+  echo '/^[	 ]*#[	 ]*undef/!b' >>$CONFIG_STATUS
+  # Work around the forget-to-reset-the-flag bug.
+  echo 't clr' >>$CONFIG_STATUS
+  echo ': clr' >>$CONFIG_STATUS
+  sed ${ac_max_here_lines}q conftest.undefs >>$CONFIG_STATUS
+  echo 'CEOF
+  sed -f $tmp/undefs.sed $tmp/in >$tmp/out
+  rm -f $tmp/in
+  mv $tmp/out $tmp/in
+' >>$CONFIG_STATUS
+  sed 1,${ac_max_here_lines}d conftest.undefs >conftest.tail
+  rm -f conftest.undefs
+  mv conftest.tail conftest.undefs
+done
+rm -f conftest.undefs
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+  # Let's still pretend it is `configure' which instantiates (i.e., don't
+  # use $as_me), people would be surprised to read:
+  #    /* config.h.  Generated by config.status.  */
+  if test x"$ac_file" = x-; then
+    echo "/* Generated by configure.  */" >$tmp/config.h
+  else
+    echo "/* $ac_file.  Generated by configure.  */" >$tmp/config.h
+  fi
+  cat $tmp/in >>$tmp/config.h
+  rm -f $tmp/in
+  if test x"$ac_file" != x-; then
+    if diff $ac_file $tmp/config.h >/dev/null 2>&1; then
+      { echo "$as_me:$LINENO: $ac_file is unchanged" >&5
+echo "$as_me: $ac_file is unchanged" >&6;}
+    else
+      ac_dir=`(dirname "$ac_file") 2>/dev/null ||
+$as_expr X"$ac_file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$ac_file" : 'X\(//\)[^/]' \| \
+	 X"$ac_file" : 'X\(//\)$' \| \
+	 X"$ac_file" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$ac_file" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+      { if $as_mkdir_p; then
+    mkdir -p "$ac_dir"
+  else
+    as_dir="$ac_dir"
+    as_dirs=
+    while test ! -d "$as_dir"; do
+      as_dirs="$as_dir $as_dirs"
+      as_dir=`(dirname "$as_dir") 2>/dev/null ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    done
+    test ! -n "$as_dirs" || mkdir $as_dirs
+  fi || { { echo "$as_me:$LINENO: error: cannot create directory \"$ac_dir\"" >&5
+echo "$as_me: error: cannot create directory \"$ac_dir\"" >&2;}
+   { (exit 1); exit 1; }; }; }
+
+      rm -f $ac_file
+      mv $tmp/config.h $ac_file
+    fi
+  else
+    cat $tmp/config.h
+    rm -f $tmp/config.h
+  fi
+done
+_ACEOF
+cat >>$CONFIG_STATUS <<\_ACEOF
+
+#
+# CONFIG_COMMANDS section.
+#
+for ac_file in : $CONFIG_COMMANDS; do test "x$ac_file" = x: && continue
+  ac_dest=`echo "$ac_file" | sed 's,:.*,,'`
+  ac_source=`echo "$ac_file" | sed 's,[^:]*:,,'`
+  ac_dir=`(dirname "$ac_dest") 2>/dev/null ||
+$as_expr X"$ac_dest" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$ac_dest" : 'X\(//\)[^/]' \| \
+	 X"$ac_dest" : 'X\(//\)$' \| \
+	 X"$ac_dest" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$ac_dest" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+  { if $as_mkdir_p; then
+    mkdir -p "$ac_dir"
+  else
+    as_dir="$ac_dir"
+    as_dirs=
+    while test ! -d "$as_dir"; do
+      as_dirs="$as_dir $as_dirs"
+      as_dir=`(dirname "$as_dir") 2>/dev/null ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    done
+    test ! -n "$as_dirs" || mkdir $as_dirs
+  fi || { { echo "$as_me:$LINENO: error: cannot create directory \"$ac_dir\"" >&5
+echo "$as_me: error: cannot create directory \"$ac_dir\"" >&2;}
+   { (exit 1); exit 1; }; }; }
+
+  ac_builddir=.
+
+if test "$ac_dir" != .; then
+  ac_dir_suffix=/`echo "$ac_dir" | sed 's,^\.[\\/],,'`
+  # A "../" for each directory in $ac_dir_suffix.
+  ac_top_builddir=`echo "$ac_dir_suffix" | sed 's,/[^\\/]*,../,g'`
+else
+  ac_dir_suffix= ac_top_builddir=
+fi
+
+case $srcdir in
+  .)  # No --srcdir option.  We are building in place.
+    ac_srcdir=.
+    if test -z "$ac_top_builddir"; then
+       ac_top_srcdir=.
+    else
+       ac_top_srcdir=`echo $ac_top_builddir | sed 's,/$,,'`
+    fi ;;
+  [\\/]* | ?:[\\/]* )  # Absolute path.
+    ac_srcdir=$srcdir$ac_dir_suffix;
+    ac_top_srcdir=$srcdir ;;
+  *) # Relative path.
+    ac_srcdir=$ac_top_builddir$srcdir$ac_dir_suffix
+    ac_top_srcdir=$ac_top_builddir$srcdir ;;
+esac
+
+# Do not use `cd foo && pwd` to compute absolute paths, because
+# the directories may not exist.
+case `pwd` in
+.) ac_abs_builddir="$ac_dir";;
+*)
+  case "$ac_dir" in
+  .) ac_abs_builddir=`pwd`;;
+  [\\/]* | ?:[\\/]* ) ac_abs_builddir="$ac_dir";;
+  *) ac_abs_builddir=`pwd`/"$ac_dir";;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_builddir=${ac_top_builddir}.;;
+*)
+  case ${ac_top_builddir}. in
+  .) ac_abs_top_builddir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_builddir=${ac_top_builddir}.;;
+  *) ac_abs_top_builddir=$ac_abs_builddir/${ac_top_builddir}.;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_srcdir=$ac_srcdir;;
+*)
+  case $ac_srcdir in
+  .) ac_abs_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_srcdir=$ac_srcdir;;
+  *) ac_abs_srcdir=$ac_abs_builddir/$ac_srcdir;;
+  esac;;
+esac
+case $ac_abs_builddir in
+.) ac_abs_top_srcdir=$ac_top_srcdir;;
+*)
+  case $ac_top_srcdir in
+  .) ac_abs_top_srcdir=$ac_abs_builddir;;
+  [\\/]* | ?:[\\/]* ) ac_abs_top_srcdir=$ac_top_srcdir;;
+  *) ac_abs_top_srcdir=$ac_abs_builddir/$ac_top_srcdir;;
+  esac;;
+esac
+
+
+  { echo "$as_me:$LINENO: executing $ac_dest commands" >&5
+echo "$as_me: executing $ac_dest commands" >&6;}
+  case $ac_dest in
+    depfiles ) test x"$AMDEP_TRUE" != x"" || for mf in $CONFIG_FILES; do
+  # Strip MF so we end up with the name of the file.
+  mf=`echo "$mf" | sed -e 's/:.*$//'`
+  # Check whether this is an Automake generated Makefile or not.
+  # We used to match only the files named `Makefile.in', but
+  # some people rename them; so instead we look at the file content.
+  # Grep'ing the first line is not enough: some people post-process
+  # each Makefile.in and add a new line on top of each file to say so.
+  # So let's grep whole file.
+  if grep '^#.*generated by automake' $mf > /dev/null 2>&1; then
+    dirpart=`(dirname "$mf") 2>/dev/null ||
+$as_expr X"$mf" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$mf" : 'X\(//\)[^/]' \| \
+	 X"$mf" : 'X\(//\)$' \| \
+	 X"$mf" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$mf" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+  else
+    continue
+  fi
+  # Extract the definition of DEPDIR, am__include, and am__quote
+  # from the Makefile without running `make'.
+  DEPDIR=`sed -n 's/^DEPDIR = //p' < "$mf"`
+  test -z "$DEPDIR" && continue
+  am__include=`sed -n 's/^am__include = //p' < "$mf"`
+  test -z "am__include" && continue
+  am__quote=`sed -n 's/^am__quote = //p' < "$mf"`
+  # When using ansi2knr, U may be empty or an underscore; expand it
+  U=`sed -n 's/^U = //p' < "$mf"`
+  # Find all dependency output files, they are included files with
+  # $(DEPDIR) in their names.  We invoke sed twice because it is the
+  # simplest approach to changing $(DEPDIR) to its actual value in the
+  # expansion.
+  for file in `sed -n "
+    s/^$am__include $am__quote\(.*(DEPDIR).*\)$am__quote"'$/\1/p' <"$mf" | \
+       sed -e 's/\$(DEPDIR)/'"$DEPDIR"'/g' -e 's/\$U/'"$U"'/g'`; do
+    # Make sure the directory exists.
+    test -f "$dirpart/$file" && continue
+    fdir=`(dirname "$file") 2>/dev/null ||
+$as_expr X"$file" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$file" : 'X\(//\)[^/]' \| \
+	 X"$file" : 'X\(//\)$' \| \
+	 X"$file" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$file" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    { if $as_mkdir_p; then
+    mkdir -p $dirpart/$fdir
+  else
+    as_dir=$dirpart/$fdir
+    as_dirs=
+    while test ! -d "$as_dir"; do
+      as_dirs="$as_dir $as_dirs"
+      as_dir=`(dirname "$as_dir") 2>/dev/null ||
+$as_expr X"$as_dir" : 'X\(.*[^/]\)//*[^/][^/]*/*$' \| \
+	 X"$as_dir" : 'X\(//\)[^/]' \| \
+	 X"$as_dir" : 'X\(//\)$' \| \
+	 X"$as_dir" : 'X\(/\)' \| \
+	 .     : '\(.\)' 2>/dev/null ||
+echo X"$as_dir" |
+    sed '/^X\(.*[^/]\)\/\/*[^/][^/]*\/*$/{ s//\1/; q; }
+  	  /^X\(\/\/\)[^/].*/{ s//\1/; q; }
+  	  /^X\(\/\/\)$/{ s//\1/; q; }
+  	  /^X\(\/\).*/{ s//\1/; q; }
+  	  s/.*/./; q'`
+    done
+    test ! -n "$as_dirs" || mkdir $as_dirs
+  fi || { { echo "$as_me:$LINENO: error: cannot create directory $dirpart/$fdir" >&5
+echo "$as_me: error: cannot create directory $dirpart/$fdir" >&2;}
+   { (exit 1); exit 1; }; }; }
+
+    # echo "creating $dirpart/$file"
+    echo '# dummy' > "$dirpart/$file"
+  done
+done
+ ;;
+  esac
+done
+_ACEOF
+
+cat >>$CONFIG_STATUS <<\_ACEOF
+
+{ (exit 0); exit 0; }
+_ACEOF
+chmod +x $CONFIG_STATUS
+ac_clean_files=$ac_clean_files_save
+
+
+# configure is writing to config.log, and then calls config.status.
+# config.status does its own redirection, appending to config.log.
+# Unfortunately, on DOS this fails, as config.log is still kept open
+# by configure, so config.status won't be able to write to it; its
+# output is simply discarded.  So we exec the FD to /dev/null,
+# effectively closing config.log, so it can be properly (re)opened and
+# appended to by config.status.  When coming back to configure, we
+# need to make the FD available again.
+if test "$no_create" != yes; then
+  ac_cs_success=:
+  ac_config_status_args=
+  test "$silent" = yes &&
+    ac_config_status_args="$ac_config_status_args --quiet"
+  exec 5>/dev/null
+  $SHELL $CONFIG_STATUS $ac_config_status_args || ac_cs_success=false
+  exec 5>>config.log
+  # Use ||, not &&, to avoid exiting from the if with $? = 1, which
+  # would make configure fail if this is the last instruction.
+  $ac_cs_success || { (exit 1); exit 1; }
+fi
+
+
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/configure.in newlib-1.20.0-arm/libgloss/libsysbase/configure.in
--- newlib-1.20.0/libgloss/libsysbase/configure.in	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/configure.in	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,208 @@
+# Copyright (c) 1995, 1996 Cygnus Support
+#
+# The authors hereby grant permission to use, copy, modify, distribute,
+# and license this software and its documentation for any purpose, provided
+# that existing copyright notices are retained in all copies and that this
+# notice is included verbatim in any distributions. No written agreement,
+# license, or royalty fee is required for any of the authorized uses.
+# Modifications to this software may be copyrighted by their authors
+# and need not follow the licensing terms described here, provided that
+# the new terms are clearly indicated on the first page of each file where
+# they apply.
+#
+# Process this file with autoconf to produce a configure script.
+#
+AC_PREREQ(2.59)
+AC_INIT(close.c)
+AC_CONFIG_HEADER(config.h)
+
+if test "${enable_shared}" = "yes" ; then
+    echo "Shared libraries not supported for cross compiling, ignored"
+fi
+
+if test "$srcdir" = "." ; then
+  if test "${with_target_subdir}" != "." ; then
+    libgloss_topdir="${srcdir}/${with_multisrctop}../../.."
+  else
+    libgloss_topdir="${srcdir}/${with_multisrctop}../.."
+  fi
+else
+  libgloss_topdir="${srcdir}/../.."
+fi
+AC_CONFIG_AUX_DIR($libgloss_topdir)
+
+AC_CANONICAL_SYSTEM
+AC_ARG_PROGRAM
+
+AC_PROG_INSTALL
+
+AC_DEFINE(HAVE_GNU_LD)
+dnl Make sure syscall names match those being used by newlib
+case "${target}" in
+  *-*-cygwin*)
+	;;
+  a29k-amd-udi)
+	;;
+  arc-*-*)
+	;;
+  arm-*-pe)
+	;;
+  arm-*-*)
+	;;
+  strongarm-*-*)
+	;;
+  cris-*-* | crisv32-*-*)
+	;;
+  d10v*)
+	;;
+  h8300*-*-*)
+	;;	
+  h8500-*-*)
+	;;	
+  i[3456]86-*-sco*)
+	;;
+  m32r-*-*)
+	;;
+  mn10?00-*-*)
+	;;
+  powerpc-eabi-elf-gekko)
+   AC_DEFINE(MISSING_SYSCALL_NAMES)
+   AC_DEFINE(REENTRANT_SYSCALLS_PROVIDED)
+   ;;
+  powerpcle-*-pe)
+	;;
+  sh*-*-*)
+	;;
+  sparc-sun-sunos*)
+	;;
+  sparc64-*-*)
+	;;
+  thumb-*-pe)
+	;;
+  thumb-*-*)
+	;;
+  v850-*-*)
+	;;
+  v850e-*-*)
+	;;
+  v850ea-*-*)
+	;;
+  w65-*-*)
+	;;	
+  xstormy16-*-*)
+	;;
+  z8k-*-*)
+	;;
+  *)
+	AC_DEFINE(MISSING_SYSCALL_NAMES)
+	;;
+esac
+
+dnl Make sure we know if elf format used
+case "${target}" in
+  *-*-elf)
+        AC_DEFINE(HAVE_ELF)
+
+        AC_CACHE_CHECK([for .previous assembler directive],
+                         libc_cv_asm_previous_directive, [dnl
+        libc_cv_asm_previous_directive=no
+        cat > conftest.s <<EOF
+.section foo_section
+.previous
+EOF
+        if AC_TRY_COMMAND(${CC-cc} -c $CFLAGS conftest.s 1>&AC_FD_CC); then
+          libc_cv_asm_previous_directive=yes
+        fi
+        rm -f conftest*])
+
+	if test "x${libc_cv_asm_previous_directive}" = "xyes"; then
+          AC_DEFINE(HAVE_ASM_PREVIOUS_DIRECTIVE)
+	fi
+
+        AC_CACHE_CHECK([for .popsection assembler directive],
+                         libc_cv_asm_popsection_directive, [dnl
+        libc_cv_asm_popsection_directive=no
+        cat > conftest.s <<EOF
+.pushsection foo_section
+.popsection
+EOF
+        if AC_TRY_COMMAND(${CC-cc} -c $CFLAGS conftest.s 1>&AC_FD_CC); then
+          libc_cv_asm_popsection_directive=yes
+        fi
+        rm -f conftest*])
+
+	if test "x${libc_cv_asm_popsection_directive}" = "xyes"; then
+          AC_DEFINE(HAVE_ASM_POPSECTION_DIRECTIVE)
+	fi
+
+        AC_CACHE_CHECK([for section attributes],
+                         libc_cv_section_attributes, [dnl
+        libc_cv_section_attributes=no
+        cat > conftest.c <<EOF
+int secttest __attribute__ ((section (".gnu.warning.secttest"))) = 10;
+int main() {}
+EOF
+        if AC_TRY_COMMAND(${CC-cc} -c $CFLAGS conftest.c 1>&AC_FD_CC); then
+          libc_cv_section_attributes=yes
+        fi
+        rm -f conftest*])
+	if test "x${libc_cv_section_attributes}" = "xyes"; then
+          AC_DEFINE(HAVE_SECTION_ATTRIBUTES)
+	fi
+        ;;
+esac
+
+AC_CACHE_CHECK([for symbol prefix], libc_symbol_prefix, [dnl
+cat > conftest.c <<\EOF
+foo () { }
+EOF
+dnl
+libc_symbol_prefix=none
+if AC_TRY_COMMAND([${CC-cc} -S conftest.c -o - | fgrep "\$foo" > /dev/null]);
+then
+  libc_symbol_prefix='$'
+else
+  if AC_TRY_COMMAND([${CC-cc} -S conftest.c -o - | fgrep "_foo" > /dev/null]);
+  then
+    libc_symbol_prefix=_
+  fi
+fi
+rm -f conftest* ])
+if test $libc_symbol_prefix != none; then
+  AC_DEFINE_UNQUOTED(__SYMBOL_PREFIX, "$libc_symbol_prefix")
+else
+  AC_DEFINE(__SYMBOL_PREFIX, "")
+fi
+
+LIB_AC_PROG_CC
+AS=${AS-as}
+AC_SUBST(AS)
+AR=${AR-ar}
+AC_SUBST(AR)
+LD=${LD-ld}
+AC_SUBST(LD)
+AC_PROG_RANLIB
+LIB_AM_PROG_AS
+
+host_makefile_frag=${srcdir}/../config/default.mh
+
+dnl We have to assign the same value to other variables because autoconf
+dnl doesn't provide a mechanism to substitute a replacement keyword with
+dnl arbitrary data or pathnames.
+dnl
+host_makefile_frag_path=$host_makefile_frag
+AC_SUBST(host_makefile_frag_path)
+AC_SUBST_FILE(host_makefile_frag)
+
+AC_CONFIG_FILES(Makefile,
+ac_file=Makefile . ${libgloss_topdir}/config-ml.in,
+srcdir=${srcdir}
+target=${target}
+with_multisubdir=${with_multisubdir}
+ac_configure_args="${ac_configure_args} --enable-multilib"
+CONFIG_SHELL=${CONFIG_SHELL-/bin/sh}
+libgloss_topdir=${libgloss_topdir}
+)
+AC_OUTPUT
+
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/dirent.c newlib-1.20.0-arm/libgloss/libsysbase/dirent.c
--- newlib-1.20.0/libgloss/libsysbase/dirent.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/dirent.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,247 @@
+#include <sys/dirent.h>
+#include <sys/iosupport.h>
+#include <malloc.h>
+#include <errno.h>
+#include <string.h>
+#include <unistd.h>
+
+static DIR_ITER * __diropen (const char *path) {
+	struct _reent *r = _REENT;
+	DIR_ITER *handle = NULL;
+	DIR_ITER *dir = NULL;
+	int dev;
+ 
+	dev = FindDevice(path);
+ 
+	if(dev!=-1 && devoptab_list[dev]->diropen_r) {
+ 
+		handle = (DIR_ITER *)malloc( sizeof(DIR_ITER) + devoptab_list[dev]->dirStateSize );
+ 
+		if ( NULL != handle ) {
+			handle->device = dev;
+			handle->dirStruct = ((void *)handle) + sizeof(DIR_ITER);
+ 
+			dir = devoptab_list[dev]->diropen_r(r, handle, path);
+ 
+			if ( dir == NULL ) {
+				free (handle);
+				handle = NULL;
+			}
+		} else {
+			r->_errno = ENOSR;
+			handle = NULL;
+		}
+	} else {
+		r->_errno = ENOSYS;
+	}
+ 
+	return handle;
+}
+
+static int __dirreset (DIR_ITER *dirState) {
+	struct _reent *r = _REENT;
+	int ret = -1;
+	int dev = 0;
+ 
+	if (dirState != NULL) {
+		dev = dirState->device;
+ 
+		if(devoptab_list[dev]->dirreset_r) {
+			ret = devoptab_list[dev]->dirreset_r(r, dirState);
+		} else {
+			r->_errno = ENOSYS;
+		}
+	}
+	return ret;
+}
+ 
+static int __dirnext (DIR_ITER *dirState, char *filename, struct stat *filestat) {
+	struct _reent *r = _REENT;
+	int ret = -1;
+	int dev = 0;
+ 
+	if (dirState != NULL) {
+		dev = dirState->device;
+ 
+		if(devoptab_list[dev]->dirnext_r) {
+			ret = devoptab_list[dev]->dirnext_r(r, dirState, filename, filestat);
+		} else {
+			r->_errno = ENOSYS;
+		}
+	}
+	return ret;
+}
+ 
+static int __dirclose (DIR_ITER *dirState) {
+	struct _reent *r = _REENT;
+	int ret = -1;
+	int dev = 0;
+ 
+	if (dirState != NULL) {
+		dev = dirState->device;
+ 
+		if (devoptab_list[dev]->dirclose_r) {
+			ret = devoptab_list[dev]->dirclose_r (r, dirState);
+		} else {
+			r->_errno = ENOSYS;
+		}
+ 
+		free (dirState);
+	}
+	return ret;
+}
+
+
+
+
+DIR* opendir (const char *dirname) {
+	DIR* dirp = malloc (sizeof(DIR));
+	if (!dirp) {
+		errno = ENOMEM;
+		return NULL;
+	}
+	
+	dirp->dirData = __diropen (dirname);
+	if (!dirp->dirData) {
+		free (dirp);
+		return NULL;
+	}
+	
+	dirp->position = 0;	// 0th position means no file name has been returned yet
+	dirp->fileData.d_ino = -1;
+	dirp->fileData.d_name[0] = '\0';
+	
+	return dirp;
+}
+
+
+int closedir (DIR *dirp) {
+	int res;
+	
+	if (!dirp) {
+		errno = EBADF;
+		return -1;
+	}
+	
+	res = __dirclose (dirp->dirData);
+	free (dirp);
+	return res;
+}
+
+
+struct dirent* readdir (DIR *dirp) {
+	struct stat st;
+	char filename[MAXPATHLEN];
+	int res;
+	int olderrno = errno;
+	
+	if (!dirp) {
+		errno = EBADF;
+		return NULL;
+	}
+	
+	res = __dirnext (dirp->dirData, filename, &st);
+	
+	if (res < 0) {
+		if (errno == ENOENT) {
+			// errno == ENONENT set by dirnext means it's end of directory
+			// But readdir should not touch errno in case of dir end
+			errno = olderrno;
+		}
+		return NULL;
+	}
+	
+	// We've moved forward in the directory
+	dirp->position += 1;
+	
+	if (strnlen(filename, MAXPATHLEN) >= sizeof(dirp->fileData.d_name)) {
+		errno = EOVERFLOW;
+		return NULL;
+	}
+	
+	strncpy (dirp->fileData.d_name, filename, sizeof(dirp->fileData.d_name));
+	dirp->fileData.d_ino = st.st_ino;
+	dirp->fileData.d_type = S_ISDIR(st.st_mode)?DT_DIR:DT_REG;
+	
+	return &(dirp->fileData);
+}
+
+
+int readdir_r(DIR *dirp, struct dirent *entry, struct dirent **result) {
+	struct stat st;
+	char filename[MAXPATHLEN];
+	int res;
+	
+	if (!dirp) {
+		return EBADF;
+	}
+	
+	res = __dirnext (dirp->dirData, filename, &st);
+	
+	if (res < 0) {
+		res = errno;
+		*result = NULL;
+		if (errno == ENOENT) {
+			// errno == ENONENT set by dirnext means it's end of directory
+			// But readdir should not touch errno in case of dir end
+			res = 0;
+		}
+		return res;
+	}
+	
+	// We've moved forward in the directory
+	dirp->position += 1;
+	
+	if (strnlen(filename, MAXPATHLEN) >= sizeof(entry->d_name)) {
+		errno = EOVERFLOW;
+		return EOVERFLOW;
+	}
+	
+	strncpy (entry->d_name, filename, sizeof(entry->d_name));
+	entry->d_ino = st.st_ino;
+	
+	*result = entry;
+	return 0;
+}
+
+
+void rewinddir (DIR *dirp) {
+	if (!dirp) {
+		return;
+	}
+	
+	__dirreset (dirp->dirData);
+	dirp->position = 0;
+}
+
+
+void seekdir(DIR *dirp, long int loc) {
+	char filename[MAXPATHLEN];
+	
+	if (!dirp || loc < 0) {
+		return;
+	}
+	
+	if (dirp->position > loc) {
+		// The entry we want is before the one we have,
+		// so we have to start again from the begining
+		__dirreset (dirp->dirData);
+		dirp->position = 0;
+	}
+	
+	// Keep reading entries until we reach the one we want
+	while ((dirp->position < loc) && 
+		   (__dirnext (dirp->dirData, filename, NULL) >= 0)) 
+	{
+		dirp->position += 1;
+	}
+}
+
+
+long int telldir(DIR *dirp) {
+	if (!dirp) {
+		return -1;
+	}
+	
+	return dirp->position;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/environ.c newlib-1.20.0-arm/libgloss/libsysbase/environ.c
--- newlib-1.20.0/libgloss/libsysbase/environ.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/environ.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,6 @@
+/*
+ * Version of environ for no OS.
+ */
+
+char *__env[1] = { 0 };
+char **environ = __env;
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/execve.c newlib-1.20.0-arm/libgloss/libsysbase/execve.c
--- newlib-1.20.0/libgloss/libsysbase/execve.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/execve.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,31 @@
+/*
+ * Stub version of execve.
+ */
+
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <errno.h>
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+_DEFUN (_execve_r, (r, name, argv, env),
+		struct _reent * r _AND
+        char  *name  _AND
+        char **argv  _AND
+        char **env) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+int
+_DEFUN (_execve, (name, argv, env),
+        char  *name  _AND
+        char **argv  _AND
+        char **env) {
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+#endif
+	r->_errno = ENOSYS;
+	return -1;
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/_exit.c newlib-1.20.0-arm/libgloss/libsysbase/_exit.c
--- newlib-1.20.0/libgloss/libsysbase/_exit.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/_exit.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,19 @@
+/* Stub version of _exit.  */
+
+#include <limits.h>
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <sys/iosupport.h>
+
+_VOID
+_DEFUN (_exit, (rc),
+	int rc)
+{
+
+	if ( __syscalls.exit ) {
+		__syscalls.exit(rc);
+	}
+
+	while(1);
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/fchmod.c newlib-1.20.0-arm/libgloss/libsysbase/fchmod.c
--- newlib-1.20.0/libgloss/libsysbase/fchmod.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/fchmod.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,30 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <sys/iosupport.h>
+#include <errno.h>
+
+#include "handle_manager.h"
+
+int fchmod(int fd, mode_t mode) {
+	int	ret = -1, dev;
+	struct _reent *r = _REENT;
+
+	if(fd!=-1) {
+
+		__handle *handle = __get_handle(fd);
+
+		if ( handle != NULL) {
+
+			dev = handle->device;
+			fd = (unsigned int)handle->fileStruct;
+
+			if(devoptab_list[dev]->fchmod_r)
+				ret = devoptab_list[dev]->fchmod_r(r,fd,mode);
+
+		}
+	}
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/flock.c newlib-1.20.0-arm/libgloss/libsysbase/flock.c
--- newlib-1.20.0/libgloss/libsysbase/flock.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/flock.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,21 @@
+#include <config.h>
+#include <_ansi.h>
+#include <_syslist.h>
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#ifndef REENTRANT_SYSCALLS_PROVIDED
+#include <reent.h>
+#endif
+#include <errno.h>
+#include <sys/lock.h>
+
+void __flockfile(FILE *fp)
+{
+	__lock_acquire_recursive(*(_LOCK_RECURSIVE_T*)&fp->_lock);
+}
+
+void __funlockfile(FILE *fp)
+{
+	__lock_release_recursive(*(_LOCK_RECURSIVE_T*)&fp->_lock);
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/fork.c newlib-1.20.0-arm/libgloss/libsysbase/fork.c
--- newlib-1.20.0/libgloss/libsysbase/fork.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/fork.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,25 @@
+/*
+ * Stub version of fork.
+ */
+
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <errno.h>
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+int
+_DEFUN(_fork_r,(r),
+	   struct _reent * r) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------	
+int
+_DEFUN (_fork, (),
+        _NOARGS) {
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+#endif
+	r->_errno = ENOSYS;
+	return -1;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/fstat.c newlib-1.20.0-arm/libgloss/libsysbase/fstat.c
--- newlib-1.20.0/libgloss/libsysbase/fstat.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/fstat.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,48 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <errno.h>
+#include <sys/iosupport.h>
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+int _DEFUN (_fstat_r,(r,fileDesc, st),
+			struct _reent * r _AND
+			int fileDesc _AND
+			struct stat *st) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+int _DEFUN (_fstat,(fileDesc, st),
+			int fileDesc _AND
+			struct stat *st) {
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+#endif
+	int ret = -1;
+	unsigned int dev = 0;
+	unsigned int fd = -1;
+
+	__handle * handle = NULL;
+
+	if(fileDesc!=-1) {
+		if ( fileDesc < 3) {
+			dev = fileDesc;
+		} else {
+			handle = __get_handle(fileDesc);
+
+			if ( NULL == handle ) return ret;
+
+			dev = handle->device;
+			fd = (int)handle->fileStruct;
+		}
+		if(devoptab_list[dev]->fstat_r) {
+			ret = devoptab_list[dev]->fstat_r(r,fd,st);
+		} else {
+			r->_errno = ENOSYS;
+		}
+	}
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/fsync.c newlib-1.20.0-arm/libgloss/libsysbase/fsync.c
--- newlib-1.20.0/libgloss/libsysbase/fsync.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/fsync.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,36 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <stdio.h>
+#include <errno.h>
+#include <fcntl.h>
+
+#include "handle_manager.h"
+
+int _DEFUN (fsync,(fileDesc),
+			int   fileDesc ) {
+	int ret = -1;
+	unsigned int dev = 0;
+	unsigned int fd = -1;
+	
+	__handle * handle;
+	
+	if ( fileDesc < 3) {
+		errno = EINVAL;
+	} else {
+		handle = __get_handle(fileDesc);
+	
+		if ( NULL == handle ) {
+			errno = EINVAL;
+			return ret;
+		}
+				
+		dev = handle->device;
+		fd = (int)handle->fileStruct;
+
+		if(devoptab_list[dev]->fsync_r)
+			ret = devoptab_list[dev]->fsync_r( _REENT, fd);
+	}
+		
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/ftruncate.c newlib-1.20.0-arm/libgloss/libsysbase/ftruncate.c
--- newlib-1.20.0/libgloss/libsysbase/ftruncate.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/ftruncate.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,37 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <stdio.h>
+#include <errno.h>
+#include <fcntl.h>
+
+#include "handle_manager.h"
+
+int _DEFUN (ftruncate,(fileDesc, len),
+			int   fileDesc  _AND
+			off_t   len) {
+	int ret = -1;
+	unsigned int dev = 0;
+	unsigned int fd = -1;
+	
+	__handle * handle;
+	
+	if ( fileDesc < 3) {
+		errno = EINVAL;
+	} else {
+		handle = __get_handle(fileDesc);
+	
+		if ( NULL == handle ) {
+			errno = EINVAL;
+			return ret;
+		}
+				
+		dev = handle->device;
+		fd = (int)handle->fileStruct;
+
+		if(devoptab_list[dev]->ftruncate_r)
+			ret = devoptab_list[dev]->ftruncate_r( _REENT, fd, len);
+	}
+		
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/getpid.c newlib-1.20.0-arm/libgloss/libsysbase/getpid.c
--- newlib-1.20.0/libgloss/libsysbase/getpid.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/getpid.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,21 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <errno.h>
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+int _DEFUN(	_getpid_r,(ptr),
+						struct _reent *ptr) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+int _DEFUN (_getpid, (),
+						_NOARGS) {
+//---------------------------------------------------------------------------------
+	struct _reent *ptr = _REENT;
+#endif
+	ptr->_errno = ENOSYS;
+	return -1;
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/gettod.c newlib-1.20.0-arm/libgloss/libsysbase/gettod.c
--- newlib-1.20.0/libgloss/libsysbase/gettod.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/gettod.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,25 @@
+/*
+ * Stub version of gettimeofday.
+ */
+
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <sys/time.h>
+#include <sys/times.h>
+#include <errno.h>
+#include "warning.h"
+
+struct timeval;
+struct timezone;
+
+int
+_DEFUN (_gettimeofday, (ptimeval, ptimezone),
+        struct timeval  *ptimeval  _AND
+        void *ptimezone)
+{
+  errno = ENOSYS;
+  return -1;
+}
+
+stub_warning(_gettimeofday)
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/handle_manager.c newlib-1.20.0-arm/libgloss/libsysbase/handle_manager.c
--- newlib-1.20.0/libgloss/libsysbase/handle_manager.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/handle_manager.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,47 @@
+#include <stdlib.h>
+#include <stdio.h>
+
+#include "handle_manager.h"
+
+#define MAX_HANDLES 1024
+
+static __handle* handles[MAX_HANDLES];
+
+
+void __release_handle(int fd) {
+
+	if ( fd < 3 || fd >= MAX_HANDLES + 3 ) return;
+
+	fd -= 3;
+	__handle* handle = handles[fd];
+	if ( NULL != handle ) {
+		free(handle);
+		handles[fd] = NULL;
+	}
+
+}
+
+int  __alloc_handle(int size) {
+
+	int i;
+
+	for ( i = 0; i < MAX_HANDLES; i++ ) {
+		if ( handles[i] == NULL ) break;
+	}
+	
+	if ( i == MAX_HANDLES ) return -1;
+	
+	handles[i] = malloc(size);
+	
+	if ( NULL == handles[i] ) return -1;
+	
+	return i+3; 
+}
+
+__handle *__get_handle(int fd) {
+
+	if ( fd < 3 || fd > MAX_HANDLES + 3 ) return NULL;
+	
+	return handles[fd-3];
+
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/handle_manager.h newlib-1.20.0-arm/libgloss/libsysbase/handle_manager.h
--- newlib-1.20.0/libgloss/libsysbase/handle_manager.h	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/handle_manager.h	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,10 @@
+#ifndef __HANDLE_MANAGER_H__
+#define __HANDLE_MANAGER_H__
+
+#include <sys/iosupport.h>
+
+void __release_handle(int fd);
+int  __alloc_handle(int size);
+__handle *__get_handle(int fd);
+
+#endif
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/iosupport.c newlib-1.20.0-arm/libgloss/libsysbase/iosupport.c
--- newlib-1.20.0/libgloss/libsysbase/iosupport.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/iosupport.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,122 @@
+#include <stdlib.h>
+#include <string.h>
+#include <sys/iosupport.h>
+
+static int defaultDevice = -1;
+
+//---------------------------------------------------------------------------------
+void setDefaultDevice( int device ) {
+//---------------------------------------------------------------------------------
+
+	if ( device >2 && device <= STD_MAX)
+		defaultDevice = device;
+}
+
+//---------------------------------------------------------------------------------
+const devoptab_t dotab_stdnull = {
+//---------------------------------------------------------------------------------
+	"stdnull",	// device name
+	0,			// size of file structure
+	NULL,		// device open
+	NULL,		// device close
+	NULL,		// device write
+	NULL,		// device read
+	NULL,		// device seek
+	NULL,		// device fstat
+	NULL,		// device stat
+	NULL,		// device link
+	NULL,		// device unlink
+	NULL,		// device chdir
+	NULL,		// device rename
+	NULL,		// device mkdir
+	0,			// dirStateSize
+	NULL,		// device diropen_r
+	NULL,		// device dirreset_r
+	NULL,		// device dirnext_r
+	NULL,		// device dirclose_r
+	NULL,		// device statvfs_r
+	NULL,		// device ftruncate_r
+	NULL,		// device fsync_r
+	NULL		// deviceData
+};
+
+//---------------------------------------------------------------------------------
+const devoptab_t *devoptab_list[STD_MAX] = {
+//---------------------------------------------------------------------------------
+	&dotab_stdnull, &dotab_stdnull, &dotab_stdnull, &dotab_stdnull,
+	&dotab_stdnull, &dotab_stdnull, &dotab_stdnull, &dotab_stdnull,
+	&dotab_stdnull, &dotab_stdnull, &dotab_stdnull, &dotab_stdnull,
+	&dotab_stdnull, &dotab_stdnull, &dotab_stdnull, &dotab_stdnull
+};
+
+//---------------------------------------------------------------------------------
+int FindDevice(const char* name) {
+//---------------------------------------------------------------------------------
+	int i = 0, namelen, dev = -1;
+
+	if (strchr(name, ':') == NULL) return defaultDevice;
+
+	while(i<STD_MAX) {
+		if(devoptab_list[i]) {
+			namelen = strlen(devoptab_list[i]->name);
+			if(strncmp(devoptab_list[i]->name,name,namelen)==0 ) {
+				if ( name[namelen] == ':' || (isdigit(name[namelen]) && name[namelen+1] ==':' )) {
+					dev = i;
+					break;
+				}
+			}
+		}
+		i++;
+	}
+
+	return dev;
+}
+
+//---------------------------------------------------------------------------------
+int RemoveDevice( const char* name) {
+//---------------------------------------------------------------------------------
+	int dev = FindDevice(name);
+
+	if ( -1 != dev ) {
+		devoptab_list[dev] = &dotab_stdnull;
+		return 0;
+	}
+
+	return -1;
+
+}
+
+//---------------------------------------------------------------------------------
+int AddDevice( const devoptab_t* device) {
+//---------------------------------------------------------------------------------
+
+	int devnum;
+
+	for ( devnum = 3;devnum <STD_MAX; devnum++ ) {
+
+		if ( (!strcmp(devoptab_list[devnum]->name, device->name) &&
+					strlen(devoptab_list[devnum]->name) == strlen(device->name) ) ||
+			 		!strcmp(devoptab_list[devnum]->name, "stdnull")
+			 )
+			 break;
+	}
+
+	if ( devnum == STD_MAX ) {
+		devnum = -1;
+	} else {
+		devoptab_list[devnum] = device;
+	}
+	return devnum;
+}
+
+//---------------------------------------------------------------------------------
+const devoptab_t* GetDeviceOpTab (const char *name) {
+//---------------------------------------------------------------------------------
+	int dev = FindDevice(name);
+	if (dev >= 0 && dev < STD_MAX) {
+		return devoptab_list[dev];
+	} else {
+		return NULL;
+	}
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/isatty.c newlib-1.20.0-arm/libgloss/libsysbase/isatty.c
--- newlib-1.20.0/libgloss/libsysbase/isatty.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/isatty.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,20 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <errno.h>
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+int _DEFUN(_isatty_r,(ptr,file),
+		   struct _reent *ptr _AND
+           int file) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+int _DEFUN(_isatty,(file),
+           int file) {
+//---------------------------------------------------------------------------------
+	struct _reent *ptr = _REENT;
+#endif
+	return 0;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/kill.c newlib-1.20.0-arm/libgloss/libsysbase/kill.c
--- newlib-1.20.0/libgloss/libsysbase/kill.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/kill.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,23 @@
+/*
+ * Stub version of kill.
+ */
+
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <errno.h>
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+int _DEFUN(_kill_r,(ptr,pid,sig),
+		   struct _reent *ptr _AND
+           int			 pid  _AND
+           int			 sig) {
+#else
+int _DEFUN(_kill,(pid,sig),
+           int pid  _AND
+           int sig)	{
+	struct _reent *ptr = _REENT;
+#endif
+  ptr->_errno = ENOSYS;
+  return -1;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/link.c newlib-1.20.0-arm/libgloss/libsysbase/link.c
--- newlib-1.20.0/libgloss/libsysbase/link.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/link.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,37 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <reent.h>
+#include <errno.h>
+#include <sys/iosupport.h>
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+int _DEFUN (_link_r, (r, existing, new),
+					struct _reent *r _AND
+					const char *existing _AND
+					const char *new) {
+#else
+int _DEFUN (_link,	(existing, new),
+					const char *existing _AND
+					const char *new) {
+	struct _reent *r = _REENT;
+#endif
+	int ret;
+	int sourceDev = FindDevice(existing);
+	int destDev = FindDevice(new);
+
+	ret = -1;
+
+	if ( sourceDev == destDev) {
+		if (devoptab_list[destDev]->link_r) {
+			ret = devoptab_list[destDev]->link_r( r, existing, new);
+		} else {
+			r->_errno = ENOSYS;
+		}
+	} else {
+		r->_errno = EXDEV;
+	}
+
+	return ret;
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/lseek.c newlib-1.20.0-arm/libgloss/libsysbase/lseek.c
--- newlib-1.20.0/libgloss/libsysbase/lseek.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/lseek.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,55 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <errno.h>
+
+#include <sys/iosupport.h>
+
+#include "handle_manager.h"
+
+//---------------------------------------------------------------------------------
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+_off_t _DEFUN (_lseek_r, (r, fileDesc, pos, dir),
+           struct _reent * r _AND
+           int   fileDesc  _AND
+		   _off_t   pos   _AND
+           int   dir) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+_off_t _DEFUN (_lseek,(fileDesc, pos, dir),
+           int   fileDesc  _AND
+		   _off_t   pos   _AND
+           int   dir) {
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+//---------------------------------------------------------------------------------
+#endif
+//---------------------------------------------------------------------------------
+	_off_t ret = -1;
+	unsigned int dev = 0;
+	unsigned int fd = -1;
+
+	__handle * handle;
+
+	if(fileDesc!=-1) {
+
+		if ( fileDesc < 3) {
+			dev = fileDesc;
+		} else {
+			handle = __get_handle(fileDesc);
+
+			if ( NULL == handle ) return ret;
+
+			dev = handle->device;
+			fd = (int)handle->fileStruct;
+		}
+
+		if(devoptab_list[dev]->seek_r)
+			ret = devoptab_list[dev]->seek_r( r, fd, pos, dir);
+
+	}
+	return ret;
+
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/Makefile.in newlib-1.20.0-arm/libgloss/libsysbase/Makefile.in
--- newlib-1.20.0/libgloss/libsysbase/Makefile.in	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/Makefile.in	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,148 @@
+# Copyright (c) 1998 Cygnus Support
+#
+# The authors hereby grant permission to use, copy, modify, distribute,
+# and license this software and its documentation for any purpose, provided
+# that existing copyright notices are retained in all copies and that this
+# notice is included verbatim in any distributions. No written agreement,
+# license, or royalty fee is required for any of the authorized uses.
+# Modifications to this software may be copyrighted by their authors
+# and need not follow the licensing terms described here, provided that
+# the new terms are clearly indicated on the first page of each file where
+# they apply.
+
+DESTDIR =
+VPATH = @srcdir@
+srcdir = @srcdir@
+objdir = .
+srcroot = $(srcdir)/../..
+objroot = $(objdir)/../..
+
+prefix = @prefix@
+exec_prefix = @exec_prefix@
+
+host_alias = @host_alias@
+target_alias = @target_alias@
+program_transform_name = @program_transform_name@
+
+bindir = @bindir@
+libdir = @libdir@
+tooldir = $(exec_prefix)/$(target_alias)
+
+# Multilib support variables.
+# TOP is used instead of MULTI{BUILD,SRC}TOP.
+MULTIDIRS =
+MULTISUBDIR =
+MULTIDO = true
+MULTICLEAN = true
+
+INSTALL = @INSTALL@
+INSTALL_PROGRAM = @INSTALL_PROGRAM@
+INSTALL_DATA = @INSTALL_DATA@
+
+SHELL =	/bin/sh
+
+CC = @CC@
+
+#AS = @AS@
+AS = `if [ -f ${objroot}/../gas/as.new ] ; \
+	then echo ${objroot}/../gas/as.new ; \
+	else echo as ; fi`
+
+AR = @AR@
+
+#LD = @LD@
+LD = `if [ -f ${objroot}/../ld/ld.new ] ; \
+	then echo ${objroot}/../ld/ld.new ; \
+	else echo ld ; fi`
+
+RANLIB = @RANLIB@
+
+OBJDUMP = `if [ -f ${objroot}/../binutils/objdump ] ; \
+	then echo ${objroot}/../binutils/objdump ; \
+	else t='$(program_transform_name)'; echo objdump | sed -e $$t ; fi`
+OBJCOPY = `if [ -f ${objroot}/../binutils/objcopy ] ; \
+	then echo ${objroot}/../binutils/objcopy ; \
+	else t='$(program_transform_name)'; echo objcopy | sed -e $$t ; fi`
+
+# object files needed
+OBJS = abort.o iosupport.o close.o environ.o execve.o fork.o fstat.o getpid.o gettod.o \
+	isatty.o kill.o link.o lseek.o open.o read.o sbrk.o stat.o times.o \
+	unlink.o wait.o write.o _exit.o malloc_vars.o \
+	chdir.o mkdir.o rename.o build_argv.o statvfs.o \
+	flock.o syscall_support.o handle_manager.o truncate.o ftruncate.o dirent.o fsync.o \
+	fchmod.o chmod.o
+
+# Object files specific to particular targets.
+EVALOBJS = ${OBJS}
+
+GCC_LDFLAGS = `if [ -d ${objroot}/../gcc ] ; \
+	then echo -L${objroot}/../gcc ; fi`
+
+OUTPUTS = libsysbase.a
+
+NEWLIB_CFLAGS = `if [ -d ${objroot}/newlib ]; then echo -I${objroot}/newlib/targ-include -I${srcroot}/newlib/libc/include; fi`
+NEWLIB_LDFLAGS = `if [ -d ${objroot}/newlib ]; then echo -B${objroot}/newlib/ -L${objroot}/newlib/; fi`
+
+INCLUDES = -I. -I$(srcdir)/..
+# Note that when building the library, ${MULTILIB} is not the way multilib
+# options are passed; they're passed in $(CFLAGS).
+CFLAGS_FOR_TARGET = ${MULTILIB} ${INCLUDES} ${NEWLIB_CFLAGS}
+LDFLAGS_FOR_TARGET = ${MULTILIB} ${NEWLIB_LDFLAGS}
+AR_FLAGS = qc
+
+.c.o:
+	$(CC) $(CFLAGS_FOR_TARGET) -O2 $(INCLUDES) -c $(CFLAGS) $<
+
+.C.o:
+	$(CC) $(CFLAGS_FOR_TARGET) -O2 $(INCLUDES) -c $(CFLAGS) $<
+.s.o:
+	$(AS) $(ASFLAGS_FOR_TARGET) $(INCLUDES) $(ASFLAGS) -o $*.o $<
+
+#
+# GCC knows to run the preprocessor on .S files before it assembles them.
+#
+.S.o:
+	$(CC) $(CFLAGS_FOR_TARGET) $(INCLUDES) $(CFLAGS) -c $<
+
+#
+# this is a bogus target that'll produce an assembler from the
+# C source with the right compiler options. this is so we can
+# track down code generation or debug symbol bugs.
+#
+.c.s:
+	$(CC) $(CFLAGS_FOR_TARGET) -S $(INCLUDES) $(CFLAGS) $<
+
+all: ${OUTPUTS}
+
+#
+# here's where we build the library for each target
+#
+
+libsysbase.a: $(EVALOBJS)
+	${AR} ${ARFLAGS} $@ $(EVALOBJS)
+	${RANLIB} $@
+
+doc:
+
+clean mostlyclean:
+	rm -f $(OUTPUTS) *.i *~ *.o *-test *.srec *.dis *.map *.x
+
+distclean maintainer-clean realclean: clean
+	rm -f Makefile config.status $(OUTPUTS)
+
+.PHONY: install info install-info clean-info
+install:
+	@for outputs in ${OUTPUTS}; do\
+	 mkdir -p $(DESTDIR)$(tooldir)/lib${MULTISUBDIR}; \
+	 $(INSTALL_PROGRAM) $${outputs} $(DESTDIR)$(tooldir)/lib${MULTISUBDIR}; \
+	done
+
+info:
+install-info:
+clean-info:
+
+Makefile: Makefile.in config.status @host_makefile_frag_path@
+	$(SHELL) config.status
+
+config.status: configure
+	$(SHELL) config.status --recheck
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/malloc_vars.c newlib-1.20.0-arm/libgloss/libsysbase/malloc_vars.c
--- newlib-1.20.0/libgloss/libsysbase/malloc_vars.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/malloc_vars.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,2 @@
+char *fake_heap_end = (char*)0;
+char *fake_heap_start = (char*)0;
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/mkdir.c newlib-1.20.0-arm/libgloss/libsysbase/mkdir.c
--- newlib-1.20.0/libgloss/libsysbase/mkdir.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/mkdir.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,18 @@
+#include <reent.h>
+#include <sys/iosupport.h>
+#include <errno.h>
+
+int mkdir (const char *path, mode_t mode) {
+	struct _reent *r = _REENT;
+	int ret;
+	int dev = FindDevice(path);
+	ret = -1;
+
+	if (devoptab_list[dev]->mkdir_r) {
+		ret = devoptab_list[dev]->mkdir_r(r, path, mode);
+	} else {
+		r->_errno = ENOSYS;
+	}
+	
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/open.c newlib-1.20.0-arm/libgloss/libsysbase/open.c
--- newlib-1.20.0/libgloss/libsysbase/open.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/open.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,57 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <string.h>
+#include <stdio.h>
+#include <ctype.h>
+#include <errno.h>
+
+#include "handle_manager.h"
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+int _DEFUN (_open_r, (r, file, flags, mode),
+			struct _reent * r _AND
+			const char *file  _AND
+			int   flags _AND
+			int   mode) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+int _DEFUN (_open, (file, flags, mode),
+        const char *file  _AND
+        int   flags _AND
+        int   mode) {
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+#endif
+	__handle *handle;
+	int dev, fd, ret;
+
+	dev = FindDevice(file);
+
+	fd = -1;
+	if(dev!=-1 && devoptab_list[dev]->open_r) {
+
+		fd = __alloc_handle(sizeof(__handle) + devoptab_list[dev]->structSize );
+
+		if ( -1 != fd ) {
+			handle = __get_handle(fd);
+			handle->device = dev;
+			handle->fileStruct = ((void *)handle) + sizeof(__handle);
+
+			ret = devoptab_list[dev]->open_r(r, handle->fileStruct, file, flags, mode);
+
+			if ( ret == -1 ) {
+				__release_handle(fd);
+				fd = -1;
+			}
+		} else {
+			r->_errno = ENOSR;
+		}
+	} else {
+		r->_errno = ENOSYS;
+	}
+
+	return fd;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/read.c newlib-1.20.0-arm/libgloss/libsysbase/read.c
--- newlib-1.20.0/libgloss/libsysbase/read.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/read.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,48 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <stdio.h>
+#include <errno.h>
+
+#include "handle_manager.h"
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+_ssize_t _DEFUN(_read_r,(r, fileDesc, ptr, len),
+			struct _reent * r _AND
+			int   fileDesc  _AND
+			void *ptr   _AND
+			size_t   len) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+_ssize_t _DEFUN(_read,(fileDesc, ptr, len),
+           int   fileDesc  _AND
+           char *ptr   _AND
+           size_t   len) {
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+#endif
+	int ret = -1;
+	unsigned int dev = 0;
+	unsigned int fd = -1;
+
+	__handle * handle = NULL;
+
+	if(fileDesc!=-1) {
+		if ( fileDesc < 3) {
+			dev = fileDesc;
+		} else {
+			handle = __get_handle(fileDesc);
+
+			if ( NULL == handle ) return ret;
+
+			dev = handle->device;
+			fd = (int)handle->fileStruct;
+		}
+		if(devoptab_list[dev]->read_r)
+			ret = devoptab_list[dev]->read_r(r,fd,ptr,len);
+	}
+	return ret;
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/rename.c newlib-1.20.0-arm/libgloss/libsysbase/rename.c
--- newlib-1.20.0/libgloss/libsysbase/rename.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/rename.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,39 @@
+#include <reent.h>
+#include <sys/iosupport.h>
+#include <errno.h>
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+int
+_DEFUN (_rename_r, (ptr, existing, newName),
+     struct _reent *ptr _AND
+     _CONST char *existing _AND
+     _CONST char *newName)
+{
+#else
+int
+_DEFUN(rename, (existing, newName),
+       _CONST char *existing _AND
+       _CONST char *newName)
+{
+	struct _reent *ptr = _REENT;
+#endif
+	struct _reent *r = _REENT;
+
+	int ret;
+	int sourceDev = FindDevice(existing);
+	int destDev = FindDevice(newName);
+
+	ret = -1;
+
+	if ( sourceDev == destDev) {
+		if (devoptab_list[destDev]->rename_r) {
+			ret = devoptab_list[destDev]->rename_r( r, existing, newName);
+		} else {
+			r->_errno = ENOSYS;
+		}
+	} else {
+		r->_errno = EXDEV;
+	}
+	
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/sbrk.c newlib-1.20.0-arm/libgloss/libsysbase/sbrk.c
--- newlib-1.20.0/libgloss/libsysbase/sbrk.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/sbrk.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,59 @@
+#include <_ansi.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <sys/fcntl.h>
+#include <stdio.h>
+#include <time.h>
+#include <sys/time.h>
+#include <sys/times.h>
+#include <errno.h>
+#include <reent.h>
+#include <unistd.h>
+
+
+extern char *fake_heap_end;
+extern char *fake_heap_start;
+
+/* Register name faking - works in collusion with the linker.  */
+register char * stack_ptr asm ("sp");
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+void * _sbrk_r (struct _reent *ptr, ptrdiff_t incr) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+caddr_t _sbrk (int incr) {
+//---------------------------------------------------------------------------------
+	struct _reent *ptr = _REENT;
+#endif
+	extern char   end asm ("__end__");	/* Defined by the linker.  */
+	static char * heap_start;
+
+	char *	prev_heap_start;
+	char *	heap_end;
+
+	if (heap_start == NULL) {
+		if (fake_heap_start == NULL) {
+			heap_start = &end;
+		} else {
+			heap_start = fake_heap_start;
+		}
+	}
+
+	prev_heap_start = heap_start;
+
+	if (fake_heap_end == NULL) {
+		heap_end = stack_ptr;
+	} else {
+		heap_end = fake_heap_end;
+	}
+
+	if (heap_start + incr > heap_end) {
+		ptr->_errno = ENOMEM;
+		return (caddr_t) -1;
+	}
+
+	heap_start += incr;
+	return (caddr_t) prev_heap_start;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/stat.c newlib-1.20.0-arm/libgloss/libsysbase/stat.c
--- newlib-1.20.0/libgloss/libsysbase/stat.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/stat.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,39 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <sys/types.h>
+#include <sys/stat.h>
+#include <sys/iosupport.h>
+#include <errno.h>
+
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+int _DEFUN (_stat_r,(r,file, st),
+			struct _reent * r _AND
+			const char *file _AND
+			struct stat *st) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+int
+_DEFUN (_stat, (file, st),
+        const char  *file _AND
+        struct stat *st)
+{
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+#endif
+	int dev,ret;
+
+	dev = FindDevice(file);
+
+	if(dev!=-1 && devoptab_list[dev]->stat_r) {
+		ret = devoptab_list[dev]->stat_r(r,file,st);
+	} else {
+		ret = -1;
+		r->_errno = ENODEV;
+	}
+	return ret;
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/statvfs.c newlib-1.20.0-arm/libgloss/libsysbase/statvfs.c
--- newlib-1.20.0/libgloss/libsysbase/statvfs.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/statvfs.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,23 @@
+#include <reent.h>
+#include <sys/iosupport.h>
+#include <errno.h>
+
+
+int statvfs(const char *path, struct statvfs *buf) {
+	struct _reent *r = _REENT;
+
+	int ret;
+	int device = FindDevice(path);
+
+	ret = -1;
+
+	if ( device != -1 && devoptab_list[device]->statvfs_r) {
+
+		ret = devoptab_list[device]->statvfs_r(r, path, buf );
+
+	} else {
+		r->_errno = ENOSYS;
+	}
+	
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/syscall_support.c newlib-1.20.0-arm/libgloss/libsysbase/syscall_support.c
--- newlib-1.20.0/libgloss/libsysbase/syscall_support.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/syscall_support.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,9 @@
+#include <sys/iosupport.h>
+
+//---------------------------------------------------------------------------------
+__syscalls_t __syscalls = {
+//---------------------------------------------------------------------------------
+	NULL,	// sbrk
+	NULL	// exit
+};
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/times.c newlib-1.20.0-arm/libgloss/libsysbase/times.c
--- newlib-1.20.0/libgloss/libsysbase/times.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/times.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,47 @@
+#include <_ansi.h>
+#include <_syslist.h>
+#include <sys/times.h>
+#include <errno.h>
+
+//---------------------------------------------------------------------------------
+clock_t _DEFUN (_times, (buf),
+        struct tms *buf) {
+//---------------------------------------------------------------------------------
+  errno = ENOSYS;
+  return -1;
+}
+
+#include <reent.h>
+#include <time.h>
+#include <sys/time.h>
+#include <sys/times.h>
+#include <_syslist.h>
+
+time_t *punixTime;
+
+clock_t
+_DEFUN (_times_r, (ptr, ptms),
+     struct _reent *ptr _AND
+     struct tms *ptms)
+{
+  return (clock_t)-1;
+}
+
+
+int
+_DEFUN (_gettimeofday_r, (ptr, ptimeval, ptimezone),
+     struct _reent *ptr _AND
+     struct timeval *ptimeval _AND
+     void *ptimezone)
+{
+
+	time_t ret = -1;
+	if ( ptimeval && punixTime ) {
+		ret = 0;
+		ptimeval->tv_sec = *punixTime;
+		ptimeval->tv_usec = 0;
+	}
+
+	ptr->_errno = ret;
+	return ret;
+}
\ No newline at end of file
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/truncate.c newlib-1.20.0-arm/libgloss/libsysbase/truncate.c
--- newlib-1.20.0/libgloss/libsysbase/truncate.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/truncate.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,59 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <stdio.h>
+#include <errno.h>
+#include <fcntl.h>
+
+#include "handle_manager.h"
+
+int _DEFUN (truncate, (file, len),
+			const char *file _AND
+			off_t len)
+{
+				
+	__handle *handle;
+	int dev, fd, ret;
+
+	struct _reent * r = _REENT;
+
+	dev = FindDevice(file);
+		
+	fd = -1;
+	if(dev!=-1 && devoptab_list[dev]->open_r && devoptab_list[dev]->close_r && 
+	   devoptab_list[dev]->ftruncate_r) 
+	{
+			
+		fd = __alloc_handle(sizeof(__handle) + devoptab_list[dev]->structSize );
+			
+		if ( -1 != fd ) {
+			handle = __get_handle(fd);
+			handle->device = dev;
+			handle->fileStruct = ((void *)handle) + sizeof(__handle);
+				
+			ret = devoptab_list[dev]->open_r(r, handle->fileStruct, file, O_WRONLY, 0);
+				
+			if ( ret < 0 ) {
+				__release_handle(fd);
+				return ret;
+			}
+				
+			ret = devoptab_list[dev]->ftruncate_r(r, fd, len);
+				
+			devoptab_list[dev]->close_r(r, fd);
+				
+			if (ret >= 0) {
+				ret = devoptab_list[dev]->close_r(r, fd);
+			} else {
+				// Close it anyway, we don't want to leak memory
+				devoptab_list[dev]->close_r(r, fd);
+			}
+		} else {
+			r->_errno = ENOSR;
+		}
+	} else {
+		r->_errno = ENOSYS;
+	}
+
+	return ret;
+}
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/unlink.c newlib-1.20.0-arm/libgloss/libsysbase/unlink.c
--- newlib-1.20.0/libgloss/libsysbase/unlink.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/unlink.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,33 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <reent.h>
+#include <errno.h>
+#include <sys/iosupport.h>
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+int _DEFUN (_unlink_r, (r, name),
+		struct _reent * r _AND
+		const char *name ) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+int _DEFUN (_unlink, (name),
+        const char *name) {
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+#endif
+	int dev,ret;
+
+	dev = FindDevice(name);
+	if(dev!=-1 && devoptab_list[dev]->unlink_r) {
+		ret = devoptab_list[dev]->unlink_r(r,name);
+	} else {
+		ret = -1;
+		r->_errno = ENODEV;
+	}
+
+	return ret;
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/wait.c newlib-1.20.0-arm/libgloss/libsysbase/wait.c
--- newlib-1.20.0/libgloss/libsysbase/wait.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/wait.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,28 @@
+/*
+ * Stub version of wait.
+ */
+
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <errno.h>
+
+//---------------------------------------------------------------------------------	
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------	
+_DEFUN (_wait_r, (r, status),
+		struct _reent *r _AND
+		int  *status) {
+
+#else
+//---------------------------------------------------------------------------------	
+int
+_DEFUN (_wait, (status),
+	int  *status) {
+	struct _reent *r = _REENT;
+#endif
+//---------------------------------------------------------------------------------	
+	r->_errno = ENOSYS;
+	return -1;
+}
+
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/warning.h newlib-1.20.0-arm/libgloss/libsysbase/warning.h
--- newlib-1.20.0/libgloss/libsysbase/warning.h	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/warning.h	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,43 @@
+#ifndef __WARNING_H__
+#define __WARNING_H__
+
+#ifdef HAVE_GNU_LD
+# ifdef HAVE_ELF
+
+/* We want the .gnu.warning.SYMBOL section to be unallocated.  */
+#  ifdef HAVE_ASM_PREVIOUS_DIRECTIVE
+#   define __make_section_unallocated(section_string)   \
+  asm(".section " section_string "; .previous");
+#  elif defined (HAVE_ASM_POPSECTION_DIRECTIVE)
+#   define __make_section_unallocated(section_string)   \
+  asm(".pushsection " section_string "; .popsection");
+#  else
+#   define __make_section_unallocated(section_string)
+#  endif
+
+#  ifdef HAVE_SECTION_ATTRIBUTES
+#   define link_warning(symbol, msg)                     \
+  __make_section_unallocated (".gnu.warning." #symbol)  \
+  static const char __evoke_link_warning_##symbol[]     \
+    __attribute__ ((section (".gnu.warning." #symbol))) = msg;
+#  else
+#   define link_warning(symbol, msg)
+#  endif
+
+#else /* !ELF */
+
+#  define link_warning(symbol, msg)             \
+  asm(".stabs \"" msg "\",30,0,0,0\n"   \
+      ".stabs \"" __SYMBOL_PREFIX #symbol "\",1,0,0,0\n");
+# endif
+#else /* !GNULD */
+/* We will never be heard; they will all die horribly.  */
+# define link_warning(symbol, msg)
+#endif
+
+/* A canned warning for sysdeps/stub functions.  */
+#define stub_warning(name) \
+  link_warning (name, \
+                "warning: " #name " is not implemented and will always fail")
+
+#endif /* __WARNING_H__ */
diff -Nbaur newlib-1.20.0/libgloss/libsysbase/write.c newlib-1.20.0-arm/libgloss/libsysbase/write.c
--- newlib-1.20.0/libgloss/libsysbase/write.c	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/libgloss/libsysbase/write.c	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,49 @@
+#include "config.h"
+#include <_ansi.h>
+#include <_syslist.h>
+#include <stdio.h>
+#include <errno.h>
+
+#include "handle_manager.h"
+
+#ifdef REENTRANT_SYSCALLS_PROVIDED
+//---------------------------------------------------------------------------------
+_ssize_t _DEFUN(_write_r,(r, fileDesc, ptr, len),
+			struct _reent * r _AND
+			int   fileDesc  _AND
+			const void *ptr   _AND
+			size_t   len) {
+//---------------------------------------------------------------------------------
+#else
+//---------------------------------------------------------------------------------
+_ssize_t _DEFUN (_write, (fileDesc, ptr, len),
+        int   fileDesc  _AND
+        const char *ptr   _AND
+        int   len) {
+//---------------------------------------------------------------------------------
+	struct _reent *r = _REENT;
+#endif
+	int ret = -1;
+	unsigned int dev = 0;
+	unsigned int fd = -1;
+
+	__handle * handle = NULL;
+
+
+	if(fileDesc!=-1) {
+		if ( fileDesc < 3) {
+			dev = fileDesc;
+			ret = len;
+		} else {
+			handle = __get_handle(fileDesc);
+
+			if ( NULL == handle ) return ret;
+
+			dev = handle->device;
+			fd = (int)handle->fileStruct;
+		}
+		if(devoptab_list[dev]->write_r)
+			ret = devoptab_list[dev]->write_r(r,fd,ptr,len);
+	}
+	return ret;
+}
diff -Nbaur newlib-1.20.0/newlib/libc/include/pthread.h newlib-1.20.0-arm/newlib/libc/include/pthread.h
--- newlib-1.20.0/newlib/libc/include/pthread.h	2010-12-08 14:44:06.000000000 +0000
+++ newlib-1.20.0-arm/newlib/libc/include/pthread.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,359 +0,0 @@
-/*  pthread.h
- *
- *  Written by Joel Sherrill <joel@OARcorp.com>.
- *
- *  COPYRIGHT (c) 1989-2010.
- *  On-Line Applications Research Corporation (OAR).
- *
- *  Permission to use, copy, modify, and distribute this software for any
- *  purpose without fee is hereby granted, provided that this entire notice
- *  is included in all copies of any software which is or includes a copy
- *  or modification of this software.
- *
- *  THIS SOFTWARE IS BEING PROVIDED "AS IS", WITHOUT ANY EXPRESS OR IMPLIED
- *  WARRANTY.  IN PARTICULAR,  THE AUTHOR MAKES NO REPRESENTATION
- *  OR WARRANTY OF ANY KIND CONCERNING THE MERCHANTABILITY OF THIS
- *  SOFTWARE OR ITS FITNESS FOR ANY PARTICULAR PURPOSE.
- *
- *  $Id: pthread.h,v 1.9 2010/12/08 14:44:06 corinna Exp $
- */
-
-#ifndef __PTHREAD_h
-#define __PTHREAD_h
-
-#ifdef __cplusplus
-extern "C" {
-#endif
-
-#include <unistd.h>
-
-#if defined(_POSIX_THREADS)
-
-#include <sys/types.h>
-#include <time.h>
-#include <sys/sched.h>
-
-/* Register Fork Handlers */
-int	_EXFUN(pthread_atfork,(void (*prepare)(void), void (*parent)(void),
-                   void (*child)(void)));
-          
-/* Mutex Initialization Attributes, P1003.1c/Draft 10, p. 81 */
-
-int	_EXFUN(pthread_mutexattr_init, (pthread_mutexattr_t *__attr));
-int	_EXFUN(pthread_mutexattr_destroy, (pthread_mutexattr_t *__attr));
-int	_EXFUN(pthread_mutexattr_getpshared,
-		(_CONST pthread_mutexattr_t *__attr, int  *__pshared));
-int	_EXFUN(pthread_mutexattr_setpshared,
-		(pthread_mutexattr_t *__attr, int __pshared));
-
-#if defined(_UNIX98_THREAD_MUTEX_ATTRIBUTES)
-
-/* Single UNIX Specification 2 Mutex Attributes types */
-
-int _EXFUN(pthread_mutexattr_gettype,
-		(_CONST pthread_mutexattr_t *__attr, int *__kind));
-int _EXFUN(pthread_mutexattr_settype,
-		(pthread_mutexattr_t *__attr, int __kind));
-
-#endif
-
-/* Initializing and Destroying a Mutex, P1003.1c/Draft 10, p. 87 */
-
-int	_EXFUN(pthread_mutex_init,
-	(pthread_mutex_t *__mutex, _CONST pthread_mutexattr_t *__attr));
-int	_EXFUN(pthread_mutex_destroy, (pthread_mutex_t *__mutex));
-
-/* This is used to statically initialize a pthread_mutex_t. Example:
-  
-    pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;
- */
-
-#define PTHREAD_MUTEX_INITIALIZER  ((pthread_mutex_t) 0xFFFFFFFF)
-
-/*  Locking and Unlocking a Mutex, P1003.1c/Draft 10, p. 93
-    NOTE: P1003.4b/D8 adds pthread_mutex_timedlock(), p. 29 */
-
-int	_EXFUN(pthread_mutex_lock, (pthread_mutex_t *__mutex));
-int	_EXFUN(pthread_mutex_trylock, (pthread_mutex_t *__mutex));
-int	_EXFUN(pthread_mutex_unlock, (pthread_mutex_t *__mutex));
-
-#if defined(_POSIX_TIMEOUTS)
-
-int	_EXFUN(pthread_mutex_timedlock,
-	(pthread_mutex_t *__mutex, _CONST struct timespec *__timeout));
-
-#endif /* _POSIX_TIMEOUTS */
-
-/* Condition Variable Initialization Attributes, P1003.1c/Draft 10, p. 96 */
- 
-int	_EXFUN(pthread_condattr_init, (pthread_condattr_t *__attr));
-int	_EXFUN(pthread_condattr_destroy, (pthread_condattr_t *__attr));
-int	_EXFUN(pthread_condattr_getpshared,
-		(_CONST pthread_condattr_t *__attr, int *__pshared));
-int	_EXFUN(pthread_condattr_setpshared,
-		(pthread_condattr_t *__attr, int __pshared));
- 
-/* Initializing and Destroying a Condition Variable, P1003.1c/Draft 10, p. 87 */
- 
-int	_EXFUN(pthread_cond_init,
-	(pthread_cond_t *__cond, _CONST pthread_condattr_t *__attr));
-int	_EXFUN(pthread_cond_destroy, (pthread_cond_t *__mutex));
- 
-/* This is used to statically initialize a pthread_cond_t. Example:
-  
-    pthread_cond_t cond = PTHREAD_COND_INITIALIZER;
- */
- 
-#define PTHREAD_COND_INITIALIZER  ((pthread_mutex_t) 0xFFFFFFFF)
- 
-/* Broadcasting and Signaling a Condition, P1003.1c/Draft 10, p. 101 */
- 
-int	_EXFUN(pthread_cond_signal, (pthread_cond_t *__cond));
-int	_EXFUN(pthread_cond_broadcast, (pthread_cond_t *__cond));
- 
-/* Waiting on a Condition, P1003.1c/Draft 10, p. 105 */
- 
-int	_EXFUN(pthread_cond_wait,
-	(pthread_cond_t *__cond, pthread_mutex_t *__mutex));
- 
-int	_EXFUN(pthread_cond_timedwait,
-		(pthread_cond_t *__cond, pthread_mutex_t *__mutex,
-		_CONST struct timespec *__abstime));
- 
-#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING)
-
-/* Thread Creation Scheduling Attributes, P1003.1c/Draft 10, p. 120 */
-
-int	_EXFUN(pthread_attr_setscope,
-		(pthread_attr_t *__attr, int __contentionscope));
-int	_EXFUN(pthread_attr_getscope,
-	(_CONST pthread_attr_t *__attr, int *__contentionscope));
-int	_EXFUN(pthread_attr_setinheritsched,
-	(pthread_attr_t *__attr, int __inheritsched));
-int	_EXFUN(pthread_attr_getinheritsched,
-	(_CONST pthread_attr_t *__attr, int *__inheritsched));
-int	_EXFUN(pthread_attr_setschedpolicy,
-	(pthread_attr_t *__attr, int __policy));
-int	_EXFUN(pthread_attr_getschedpolicy,
-	(_CONST pthread_attr_t *__attr, int *__policy));
-
-#endif /* defined(_POSIX_THREAD_PRIORITY_SCHEDULING) */
-
-int	_EXFUN(pthread_attr_setschedparam,
-	(pthread_attr_t *__attr, _CONST struct sched_param *__param));
-int	_EXFUN(pthread_attr_getschedparam,
-	(_CONST pthread_attr_t *__attr, struct sched_param *__param));
-
-#if defined(_POSIX_THREAD_PRIORITY_SCHEDULING)
-
-/* Dynamic Thread Scheduling Parameters Access, P1003.1c/Draft 10, p. 124 */
-
-int	_EXFUN(pthread_getschedparam,
-	(pthread_t __pthread, int *__policy, struct sched_param *__param));
-int	_EXFUN(pthread_setschedparam,
-	(pthread_t __pthread, int __policy, struct sched_param *__param));
-
-#endif /* defined(_POSIX_THREAD_PRIORITY_SCHEDULING) */
-
-#if defined(_POSIX_THREAD_PRIO_INHERIT) || defined(_POSIX_THREAD_PRIO_PROTECT)
-
-/* Mutex Initialization Scheduling Attributes, P1003.1c/Draft 10, p. 128 */
- 
-int	_EXFUN(pthread_mutexattr_setprotocol,
-	(pthread_mutexattr_t *__attr, int __protocol));
-int	_EXFUN(pthread_mutexattr_getprotocol,
-	(_CONST pthread_mutexattr_t *__attr, int *__protocol));
-int	_EXFUN(pthread_mutexattr_setprioceiling,
-	(pthread_mutexattr_t *__attr, int __prioceiling));
-int	_EXFUN(pthread_mutexattr_getprioceiling,
-	(_CONST pthread_mutexattr_t *__attr, int *__prioceiling));
-
-#endif /* _POSIX_THREAD_PRIO_INHERIT || _POSIX_THREAD_PRIO_PROTECT */
-
-#if defined(_POSIX_THREAD_PRIO_PROTECT)
-
-/* Change the Priority Ceiling of a Mutex, P1003.1c/Draft 10, p. 131 */
-
-int	_EXFUN(pthread_mutex_setprioceiling,
-	(pthread_mutex_t *__mutex, int __prioceiling, int *__old_ceiling));
-int	_EXFUN(pthread_mutex_getprioceiling,
-	(pthread_mutex_t *__mutex, int *__prioceiling));
-
-#endif /* _POSIX_THREAD_PRIO_PROTECT */
-
-/* Thread Creation Attributes, P1003.1c/Draft 10, p, 140 */
-
-int	_EXFUN(pthread_attr_init, (pthread_attr_t *__attr));
-int	_EXFUN(pthread_attr_destroy, (pthread_attr_t *__attr));
-int	_EXFUN(pthread_attr_setstack, (pthread_attr_t *attr,
-	void *__stackaddr, size_t __stacksize));
-int	_EXFUN(pthread_attr_getstack, (_CONST pthread_attr_t *attr,
-	void **__stackaddr, size_t *__stacksize));
-int	_EXFUN(pthread_attr_getstacksize,
-	(_CONST pthread_attr_t *__attr, size_t *__stacksize));
-int	_EXFUN(pthread_attr_setstacksize,
-	(pthread_attr_t *__attr, size_t __stacksize));
-int	_EXFUN(pthread_attr_getstackaddr,
-	(_CONST pthread_attr_t *__attr, void **__stackaddr));
-int	_EXFUN(pthread_attr_setstackaddr,
-	(pthread_attr_t  *__attr, void *__stackaddr));
-int	_EXFUN(pthread_attr_getdetachstate,
-	(_CONST pthread_attr_t *__attr, int *__detachstate));
-int	_EXFUN(pthread_attr_setdetachstate,
-	(pthread_attr_t *__attr, int __detachstate));
-int	_EXFUN(pthread_attr_getguardsize,
-	(_CONST pthread_attr_t *__attr, size_t *__guardsize));
-int	_EXFUN(pthread_attr_setguardsize,
-	(pthread_attr_t *__attr, size_t __guardsize));
-
-/* Thread Creation, P1003.1c/Draft 10, p. 144 */
-
-int	_EXFUN(pthread_create,
-	(pthread_t *__pthread, _CONST pthread_attr_t  *__attr,
-	void *(*__start_routine)( void * ), void *__arg));
-
-/* Wait for Thread Termination, P1003.1c/Draft 10, p. 147 */
-
-int	_EXFUN(pthread_join, (pthread_t __pthread, void **__value_ptr));
-
-/* Detaching a Thread, P1003.1c/Draft 10, p. 149 */
-
-int	_EXFUN(pthread_detach, (pthread_t __pthread));
-
-/* Thread Termination, p1003.1c/Draft 10, p. 150 */
-
-void	_EXFUN(pthread_exit, (void *__value_ptr));
-
-/* Get Calling Thread's ID, p1003.1c/Draft 10, p. XXX */
-
-pthread_t	_EXFUN(pthread_self, (void));
-
-/* Compare Thread IDs, p1003.1c/Draft 10, p. 153 */
-
-int	_EXFUN(pthread_equal, (pthread_t __t1, pthread_t __t2));
-
-/* Dynamic Package Initialization */
-
-/* This is used to statically initialize a pthread_once_t. Example:
-  
-    pthread_once_t once = PTHREAD_ONCE_INIT;
-  
-    NOTE:  This is named inconsistently -- it should be INITIALIZER.  */
- 
-#define PTHREAD_ONCE_INIT  { 1, 0 }  /* is initialized and not run */
- 
-int	_EXFUN(pthread_once,
-	(pthread_once_t *__once_control, void (*__init_routine)(void)));
-
-/* Thread-Specific Data Key Create, P1003.1c/Draft 10, p. 163 */
-
-int	_EXFUN(pthread_key_create,
-	(pthread_key_t *__key, void (*__destructor)( void * )));
-
-/* Thread-Specific Data Management, P1003.1c/Draft 10, p. 165 */
-
-int	_EXFUN(pthread_setspecific,
-	(pthread_key_t __key, _CONST void *__value));
-void *	_EXFUN(pthread_getspecific, (pthread_key_t __key));
-
-/* Thread-Specific Data Key Deletion, P1003.1c/Draft 10, p. 167 */
-
-int	_EXFUN(pthread_key_delete, (pthread_key_t __key));
-
-/* Execution of a Thread, P1003.1c/Draft 10, p. 181 */
-
-#define PTHREAD_CANCEL_ENABLE  0
-#define PTHREAD_CANCEL_DISABLE 1
-
-#define PTHREAD_CANCEL_DEFERRED 0
-#define PTHREAD_CANCEL_ASYNCHRONOUS 1
-
-#define PTHREAD_CANCELED ((void *) -1)
-
-int	_EXFUN(pthread_cancel, (pthread_t __pthread));
-
-/* Setting Cancelability State, P1003.1c/Draft 10, p. 183 */
-
-int	_EXFUN(pthread_setcancelstate, (int __state, int *__oldstate));
-int	_EXFUN(pthread_setcanceltype, (int __type, int *__oldtype));
-void 	_EXFUN(pthread_testcancel, (void));
-
-/* Establishing Cancellation Handlers, P1003.1c/Draft 10, p. 184 */
-
-void 	_EXFUN(pthread_cleanup_push,
-	(void (*__routine)( void * ), void *__arg));
-void 	_EXFUN(pthread_cleanup_pop, (int __execute));
-
-#if defined(_POSIX_THREAD_CPUTIME)
- 
-/* Accessing a Thread CPU-time Clock, P1003.4b/D8, p. 58 */
- 
-int	_EXFUN(pthread_getcpuclockid,
-	(pthread_t __pthread_id, clockid_t *__clock_id));
- 
-#endif /* defined(_POSIX_THREAD_CPUTIME) */
-
-
-#endif /* defined(_POSIX_THREADS) */
-
-#if defined(_POSIX_BARRIERS)
-
-int	_EXFUN(pthread_barrierattr_init, (pthread_barrierattr_t *__attr));
-int	_EXFUN(pthread_barrierattr_destroy, (pthread_barrierattr_t *__attr));
-int	_EXFUN(pthread_barrierattr_getpshared,
-	(_CONST pthread_barrierattr_t *__attr, int *__pshared));
-int	_EXFUN(pthread_barrierattr_setpshared,
-	(pthread_barrierattr_t *__attr, int __pshared));
-
-#define PTHREAD_BARRIER_SERIAL_THREAD -1
-
-int	_EXFUN(pthread_barrier_init,
-	(pthread_barrier_t *__barrier,
-	_CONST pthread_barrierattr_t *__attr, unsigned __count));
-int	_EXFUN(pthread_barrier_destroy, (pthread_barrier_t *__barrier));
-int	_EXFUN(pthread_barrier_wait,(pthread_barrier_t *__barrier));
-
-#endif /* defined(_POSIX_BARRIERS) */
-
-#if defined(_POSIX_SPIN_LOCKS)
-
-int	_EXFUN(pthread_spin_init,
-	(pthread_spinlock_t *__spinlock, int __pshared));
-int	_EXFUN(pthread_spin_destroy, (pthread_spinlock_t *__spinlock));
-int	_EXFUN(pthread_spin_lock, (pthread_spinlock_t *__spinlock));
-int	_EXFUN(pthread_spin_trylock, (pthread_spinlock_t *__spinlock));
-int	_EXFUN(pthread_spin_unlock, (pthread_spinlock_t *__spinlock));
-
-#endif /* defined(_POSIX_SPIN_LOCKS) */
-
-#if defined(_POSIX_READER_WRITER_LOCKS)
-
-int	_EXFUN(pthread_rwlockattr_init, (pthread_rwlockattr_t *__attr));
-int	_EXFUN(pthread_rwlockattr_destroy, (pthread_rwlockattr_t *__attr));
-int	_EXFUN(pthread_rwlockattr_getpshared,
-	(_CONST pthread_rwlockattr_t *__attr, int *__pshared));
-int	_EXFUN(pthread_rwlockattr_setpshared,
-	(pthread_rwlockattr_t *__attr, int __pshared));
-
-int	_EXFUN(pthread_rwlock_init,
-	(pthread_rwlock_t *__rwlock, _CONST pthread_rwlockattr_t *__attr));
-int	_EXFUN(pthread_rwlock_destroy, (pthread_rwlock_t *__rwlock));
-int	_EXFUN(pthread_rwlock_rdlock,(pthread_rwlock_t *__rwlock));
-int	_EXFUN(pthread_rwlock_tryrdlock,(pthread_rwlock_t *__rwlock));
-int	_EXFUN(pthread_rwlock_timedrdlock,
-        (pthread_rwlock_t *__rwlock, _CONST struct timespec *__abstime));
-int	_EXFUN(pthread_rwlock_unlock,(pthread_rwlock_t *__rwlock));
-int	_EXFUN(pthread_rwlock_wrlock,(pthread_rwlock_t *__rwlock));
-int	_EXFUN(pthread_rwlock_trywrlock,(pthread_rwlock_t *__rwlock));
-int	_EXFUN(pthread_rwlock_timedwrlock,
-        (pthread_rwlock_t *__rwlock, _CONST struct timespec *__abstime));
-
-#endif /* defined(_POSIX_READER_WRITER_LOCKS) */
-
-
-#ifdef __cplusplus
-}
-#endif
-
-#endif
-/* end of include file */
diff -Nbaur newlib-1.20.0/newlib/libc/include/stdint.h newlib-1.20.0-arm/newlib/libc/include/stdint.h
--- newlib-1.20.0/newlib/libc/include/stdint.h	2009-04-24 22:55:07.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/include/stdint.h	2012-04-05 16:52:10.000000000 +0100
@@ -75,14 +75,14 @@
 #endif
 #endif
 
-#if __have_long32
-typedef signed long int32_t;
-typedef unsigned long uint32_t;
-#define __int32_t_defined 1
-#elif __STDINT_EXP(INT_MAX) == 0x7fffffffL
+#if __STDINT_EXP(INT_MAX) == 0x7fffffffL
 typedef signed int int32_t;
 typedef unsigned int uint32_t;
 #define __int32_t_defined 1
+#elif __have_long32
+typedef signed long int32_t;
+typedef unsigned long uint32_t;
+#define __int32_t_defined 1
 #elif __STDINT_EXP(SHRT_MAX) == 0x7fffffffL
 typedef signed short int32_t;
 typedef unsigned short uint32_t;
diff -Nbaur newlib-1.20.0/newlib/libc/include/sys/dirent.h newlib-1.20.0-arm/newlib/libc/include/sys/dirent.h
--- newlib-1.20.0/newlib/libc/include/sys/dirent.h	2005-10-04 21:47:39.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/include/sys/dirent.h	2012-04-05 16:52:10.000000000 +0100
@@ -4,10 +4,49 @@
    not support <dirent.h>, we will get this file which uses #error to force
    an error.  */
 
+#ifndef _dirent_h_
+#define _dirent_h_
+
+#include <sys/iosupport.h>
+#include <sys/types.h>
+#include <sys/syslimits.h>
+
+#define	DT_UNKNOWN	 0
+#define	DT_FIFO		 1
+#define	DT_CHR		 2
+#define	DT_DIR		 4
+#define	DT_BLK		 6
+#define	DT_REG		 8
+#define	DT_LNK		10
+#define	DT_SOCK		12
+#define	DT_WHT		14
+
 #ifdef __cplusplus
 extern "C" {
 #endif
-#error "<dirent.h> not supported"
+	
+	struct dirent {
+		ino_t	d_ino;
+		unsigned char  d_type;
+		char	d_name[NAME_MAX+1];
+	};
+	
+	typedef struct {
+		long int        position;
+		DIR_ITER*       dirData;
+		struct dirent   fileData;
+	} DIR;
+	
+	int closedir(DIR *dirp);
+	DIR *opendir(const char *dirname);
+	struct dirent *readdir(DIR *dirp);
+	int readdir_r(DIR *dirp, struct dirent *entry, struct dirent **result);
+	void rewinddir(DIR *dirp);
+	void seekdir(DIR *dirp, long int loc);
+	long int telldir(DIR *dirp);
+	
 #ifdef __cplusplus
 }
 #endif
+
+#endif // _dirent_h_
\ No newline at end of file
diff -Nbaur newlib-1.20.0/newlib/libc/include/sys/iosupport.h newlib-1.20.0-arm/newlib/libc/include/sys/iosupport.h
--- newlib-1.20.0/newlib/libc/include/sys/iosupport.h	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/include/sys/iosupport.h	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,88 @@
+//---------------------------------------------------------------------------------
+#ifndef __iosupp_h__
+#define __iosupp_h__
+//---------------------------------------------------------------------------------
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+#include <reent.h>
+#include <sys/stat.h>
+#include <sys/statvfs.h>
+
+enum	{
+	STD_IN,
+	STD_OUT,
+	STD_ERR,
+	STD_MAX = 16
+};
+
+
+typedef struct {
+	int device;
+	void *fileStruct;
+} __handle;
+
+/* Directory iterator for mantaining state between dir* calls */
+typedef struct {
+    int device;
+    void *dirStruct;
+} DIR_ITER;
+
+typedef struct {
+	const char *name;
+	int	structSize;
+	int (*open_r)(struct _reent *r, void *fileStruct, const char *path, int flags, int mode);
+	int (*close_r)(struct _reent *r, int fd);
+	ssize_t (*write_r)(struct _reent *r, int fd, const char *ptr, size_t len);
+	ssize_t (*read_r)(struct _reent *r, int fd, char *ptr, size_t len);
+	off_t (*seek_r)(struct _reent *r, int fd, off_t pos, int dir);
+	int (*fstat_r)(struct _reent *r, int fd, struct stat *st);
+	int (*stat_r)(struct _reent *r, const char *file, struct stat *st);
+	int (*link_r)(struct _reent *r, const char *existing, const char  *newLink);
+	int (*unlink_r)(struct _reent *r, const char *name);
+	int (*chdir_r)(struct _reent *r, const char *name);
+	int (*rename_r) (struct _reent *r, const char *oldName, const char *newName);
+	int (*mkdir_r) (struct _reent *r, const char *path, int mode);
+		
+	int dirStateSize;
+	
+	DIR_ITER* (*diropen_r)(struct _reent *r, DIR_ITER *dirState, const char *path);
+	int (*dirreset_r)(struct _reent *r, DIR_ITER *dirState);
+	int (*dirnext_r)(struct _reent *r, DIR_ITER *dirState, char *filename, struct stat *filestat);
+	int (*dirclose_r)(struct _reent *r, DIR_ITER *dirState);
+	int (*statvfs_r)(struct _reent *r, const char *path, struct statvfs *buf);
+	int (*ftruncate_r)(struct _reent *r, int fd, off_t len);
+	int (*fsync_r)(struct _reent *r, int fd);
+
+	void *deviceData;
+
+	int (*chmod_r)(struct _reent *r, const char *path, mode_t mode);
+	int (*fchmod_r)(struct _reent *r, int fd, mode_t mode);
+
+} devoptab_t;
+	
+extern const devoptab_t *devoptab_list[];
+
+	
+typedef struct {
+	void *(*sbrk_r) (struct _reent *ptr, ptrdiff_t incr);
+	void (*exit) ( int rc );
+} __syscalls_t;
+	
+extern __syscalls_t __syscalls;
+	
+int AddDevice( const devoptab_t* device);
+int FindDevice(const char* name);
+int RemoveDevice(const char* name);
+void setDefaultDevice( int device );
+const devoptab_t* GetDeviceOpTab (const char *name);
+	
+#ifdef __cplusplus
+}
+#endif
+
+//---------------------------------------------------------------------------------
+#endif // __iosupp_h__
+//---------------------------------------------------------------------------------
diff -Nbaur newlib-1.20.0/newlib/libc/include/sys/statvfs.h newlib-1.20.0-arm/newlib/libc/include/sys/statvfs.h
--- newlib-1.20.0/newlib/libc/include/sys/statvfs.h	1970-01-01 01:00:00.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/include/sys/statvfs.h	2012-04-05 16:52:10.000000000 +0100
@@ -0,0 +1,35 @@
+#ifndef _SYS_STATVFS_H
+#define _SYS_STATVFS_H
+
+
+#define ST_RDONLY 0x0001
+#define ST_NOSUID 0x0002
+
+#ifdef __cplusplus
+extern "C" {
+#endif
+
+#include <sys/types.h>
+
+struct statvfs {
+	unsigned long f_bsize;
+	unsigned long f_frsize;
+	fsblkcnt_t f_blocks;
+	fsblkcnt_t f_bfree;
+	fsblkcnt_t f_bavail;
+	fsfilcnt_t f_files;
+	fsfilcnt_t f_ffree;
+	fsfilcnt_t f_favail;
+	unsigned long f_fsid;
+	unsigned long f_flag;
+	unsigned long f_namemax;
+}; 
+
+int statvfs(const char *path, struct statvfs *buf);
+
+#ifdef __cplusplus
+}
+#endif
+
+
+#endif // _SYS_STATVFS_H
\ No newline at end of file
diff -Nbaur newlib-1.20.0/newlib/libc/include/sys/syslimits.h newlib-1.20.0-arm/newlib/libc/include/sys/syslimits.h
--- newlib-1.20.0/newlib/libc/include/sys/syslimits.h	2002-08-23 02:56:03.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/include/sys/syslimits.h	2012-04-05 16:52:10.000000000 +0100
@@ -44,7 +44,7 @@
 #define	LINK_MAX		32767	/* max file link count */
 #define	MAX_CANON		  255	/* max bytes in term canon input line */
 #define	MAX_INPUT		  255	/* max bytes in terminal input */
-#define	NAME_MAX		  255	/* max bytes in a file name */
+#define	NAME_MAX		  767	/* max bytes in a file name */
 #define	NGROUPS_MAX		   16	/* max supplemental group id's */
 #ifndef OPEN_MAX
 #define	OPEN_MAX		   64	/* max open files per process */
diff -Nbaur newlib-1.20.0/newlib/libc/include/sys/_types.h newlib-1.20.0-arm/newlib/libc/include/sys/_types.h
--- newlib-1.20.0/newlib/libc/include/sys/_types.h	2007-09-18 21:05:17.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/include/sys/_types.h	2012-04-05 16:52:10.000000000 +0100
@@ -21,7 +21,7 @@
 typedef unsigned long long __dev_t;
 #else
 #ifndef __dev_t_defined
-typedef short __dev_t;
+typedef int __dev_t;
 #endif
 #endif
 
diff -Nbaur newlib-1.20.0/newlib/libc/include/sys/types.h newlib-1.20.0-arm/newlib/libc/include/sys/types.h
--- newlib-1.20.0/newlib/libc/include/sys/types.h	2011-08-01 18:22:18.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/include/sys/types.h	2012-04-05 16:52:10.000000000 +0100
@@ -131,7 +131,7 @@
     defined(__sparc__) || defined(__SPU__)
 typedef	unsigned long	ino_t;
 #else
-typedef	unsigned short	ino_t;
+typedef	unsigned int	ino_t;
 #endif
 #endif /*__CYGWIN__*/
 
@@ -263,6 +263,9 @@
 typedef unsigned long useconds_t;
 typedef long suseconds_t;
 
+typedef __uint32_t fsblkcnt_t;
+typedef __uint32_t fsfilcnt_t;
+
 #include <sys/features.h>
 
 
diff -Nbaur newlib-1.20.0/newlib/libc/include/sys/unistd.h newlib-1.20.0-arm/newlib/libc/include/sys/unistd.h
--- newlib-1.20.0/newlib/libc/include/sys/unistd.h	2011-08-19 15:29:34.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/include/sys/unistd.h	2012-04-05 16:52:10.000000000 +0100
@@ -219,12 +219,10 @@
 int     _EXFUN(_execve, (const char *__path, char * const __argv[], char * const __envp[] ));
 #endif
 
-#if defined(__CYGWIN__) || defined(__rtems__) || defined(__sh__) || defined(__SPU__)
 #if !defined(__INSIDE_CYGWIN__)
 int     _EXFUN(ftruncate, (int __fd, off_t __length));
 int     _EXFUN(truncate, (const char *, off_t __length));
 #endif
-#endif
 
 #if defined(__CYGWIN__) || defined(__rtems__)
 int	_EXFUN(getdtablesize, (void));
diff -Nbaur newlib-1.20.0/newlib/libc/locale/locale.c newlib-1.20.0-arm/newlib/libc/locale/locale.c
--- newlib-1.20.0/newlib/libc/locale/locale.c	2011-05-04 09:54:34.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/locale/locale.c	2012-04-05 16:52:50.000000000 +0100
@@ -188,7 +188,6 @@
 #define _LC_LAST      7
 #define ENCODING_LEN 31
 
-int __EXPORT __mb_cur_max = 1;
 
 int __nlocale_changed = 0;
 int __mlocale_changed = 0;
@@ -218,6 +217,10 @@
   "LC_MESSAGES",
 };
 
+#ifdef __CYGWIN__
+#define __DEFAULT_UTF8__
+#endif
+
 /*
  * Default locale per POSIX.  Can be overridden on a per-target base.
  */
@@ -236,7 +239,7 @@
 static char current_categories[_LC_LAST][ENCODING_LEN + 1] = {
     "C",
     "C",
-#ifdef __CYGWIN__ /* Cygwin starts with LC_CTYPE set to "C.UTF-8". */
+#ifdef __DEFAULT_UTF8__ /* Cygwin starts with LC_CTYPE set to "C.UTF-8". */
     "C.UTF-8",
 #else
     "C",
@@ -260,10 +263,12 @@
 
 #endif /* _MB_CAPABLE */
 
-#ifdef __CYGWIN__
-static char lc_ctype_charset[ENCODING_LEN + 1] = "UTF-8";
+#ifdef __DEFAULT_UTF8__
+static char lc_ctype_charset[ENCODING_LEN + 1] = "C.UTF-8";
+int __EXPORT __mb_cur_max = 6;
 #else
 static char lc_ctype_charset[ENCODING_LEN + 1] = "ASCII";
+int __EXPORT __mb_cur_max = 1;
 #endif
 static char lc_message_charset[ENCODING_LEN + 1] = "ASCII";
 static int lc_ctype_cjk_lang = 0;
diff -Nbaur newlib-1.20.0/newlib/libc/misc/init.c newlib-1.20.0-arm/newlib/libc/misc/init.c
--- newlib-1.20.0/newlib/libc/misc/init.c	2010-06-04 16:30:40.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/misc/init.c	2012-04-05 16:52:10.000000000 +0100
@@ -40,4 +40,8 @@
   for (i = 0; i < count; i++)
     __init_array_start[i] ();
 }
+#else
+
+#error why am I not defined
+
 #endif
diff -Nbaur newlib-1.20.0/newlib/libc/reent/gettimeofdayr.c newlib-1.20.0-arm/newlib/libc/reent/gettimeofdayr.c
--- newlib-1.20.0/newlib/libc/reent/gettimeofdayr.c	2007-07-06 17:56:30.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/reent/gettimeofdayr.c	2012-04-05 16:52:10.000000000 +0100
@@ -59,7 +59,7 @@
 	Check libc.a to see if its available on yours.
 */
 
-int
+/*int
 _DEFUN (_gettimeofday_r, (ptr, ptimeval, ptimezone),
      struct _reent *ptr _AND
      struct timeval *ptimeval _AND
@@ -72,5 +72,5 @@
     ptr->_errno = errno;
   return ret;
 }
-
+*/
 #endif /* ! defined (REENTRANT_SYSCALLS_PROVIDED) */
diff -Nbaur newlib-1.20.0/newlib/libc/stdio/fopen.c newlib-1.20.0-arm/newlib/libc/stdio/fopen.c
--- newlib-1.20.0/newlib/libc/stdio/fopen.c	2004-06-11 21:37:10.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/stdio/fopen.c	2012-04-05 16:52:10.000000000 +0100
@@ -151,6 +151,9 @@
 
   _flockfile (fp);
 
+  flags &= ~(__SLBF | __SNBF | __SMBF);
+  flags |= __SNBF;
+
   fp->_file = f;
   fp->_flags = flags;
   fp->_cookie = (_PTR) fp;
diff -Nbaur newlib-1.20.0/newlib/libc/stdio/fvwrite.c newlib-1.20.0-arm/newlib/libc/stdio/fvwrite.c
--- newlib-1.20.0/newlib/libc/stdio/fvwrite.c	2011-06-14 04:56:05.000000000 +0100
+++ newlib-1.20.0-arm/newlib/libc/stdio/fvwrite.c	2012-04-05 16:52:10.000000000 +0100
@@ -94,7 +94,8 @@
       do
 	{
 	  GETIOV (;);
-	  w = fp->_write (ptr, fp->_cookie, p, MIN (len, BUFSIZ));
+	  //w = fp->_write (ptr, fp->_cookie, p, MIN (len, BUFSIZ));
+	  w = fp->_write (ptr, fp->_cookie, p, len);
 	  if (w <= 0)
 	    goto err;
 	  p += w;
diff -Nbaur newlib-1.20.0/newlib/libc/stdlib/mbtowc_r.c newlib-1.20.0-arm/newlib/libc/stdlib/mbtowc_r.c
--- newlib-1.20.0/newlib/libc/stdlib/mbtowc_r.c	2010-01-17 09:39:06.000000000 +0000
+++ newlib-1.20.0-arm/newlib/libc/stdlib/mbtowc_r.c	2012-04-05 16:52:10.000000000 +0100
@@ -9,7 +9,7 @@
 
 int (*__mbtowc) (struct _reent *, wchar_t *, const char *, size_t,
 		 const char *, mbstate_t *)
-#ifdef __CYGWIN__
+#ifdef __DEFAULT_UTF8__
    /* Cygwin starts up in UTF-8 mode. */
    = __utf8_mbtowc;
 #else
diff -Nbaur newlib-1.20.0/newlib/libc/stdlib/wctomb_r.c newlib-1.20.0-arm/newlib/libc/stdlib/wctomb_r.c
--- newlib-1.20.0/newlib/libc/stdlib/wctomb_r.c	2010-01-17 09:39:06.000000000 +0000
+++ newlib-1.20.0-arm/newlib/libc/stdlib/wctomb_r.c	2012-04-05 16:52:10.000000000 +0100
@@ -8,7 +8,7 @@
 
 int (*__wctomb) (struct _reent *, char *, wchar_t, const char *charset,
 		 mbstate_t *)
-#ifdef __CYGWIN__
+#ifdef __DEFAULT_UTF8__
    /* Cygwin starts up in UTF-8 mode. */
     = __utf8_wctomb;
 #else
diff -Nbaur newlib-1.20.0/newlib/libc/syscalls/Makefile.am newlib-1.20.0-arm/newlib/libc/syscalls/Makefile.am
--- newlib-1.20.0/newlib/libc/syscalls/Makefile.am	2008-01-03 22:33:37.000000000 +0000
+++ newlib-1.20.0-arm/newlib/libc/syscalls/Makefile.am	2012-04-05 16:52:10.000000000 +0100
@@ -20,8 +20,9 @@
 	sysstat.c	\
 	systimes.c	\
 	sysunlink.c	\
-	syswrite.c
-
+	syswrite.c \
+	sysftruncate.c \
+	systruncate.c
 
 ## Weed out EL/IX level 3 interfaces if necessary
 if ELIX_LEVEL_1
